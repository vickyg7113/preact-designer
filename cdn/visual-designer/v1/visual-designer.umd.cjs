(function(q,ie){typeof exports=="object"&&typeof module<"u"?ie(exports):typeof define=="function"&&define.amd?define(["exports"],ie):(q=typeof globalThis<"u"?globalThis:q||self,ie(q.VisualDesigner={}))})(this,(function(q){"use strict";class ie{static generateSelector(t){if(t.id)return{selector:`#${this.escapeSelector(t.id)}`,confidence:"high",method:"id"};const i=this.generateContainsSelector(t);if(i)return i;const n=this.generatePathFromAnchorToElement(t);if(n)return n;if(t.hasAttribute("data-testid")){const l=t.getAttribute("data-testid");return{selector:`[data-testid="${this.escapeAttribute(l)}"]`,confidence:"high",method:"data-testid"}}const r=this.getSemanticDataAttributes(t);if(r.length>0){const l=r[0],u=t.getAttribute(l);return{selector:`[${l}="${this.escapeAttribute(u)}"]`,confidence:"high",method:"data-attribute"}}const s=this.generateAriaSelector(t);if(s)return{selector:s,confidence:"medium",method:"aria"};const a=this.generatePathSelector(t);return a?{selector:a,confidence:"medium",method:"path"}:{selector:t.tagName.toLowerCase(),confidence:"low",method:"tag"}}static getXPath(t){if(t.id&&document.querySelector(`#${CSS.escape(t.id)}`)===t)return`//*[@id="${t.id.replace(/"/g,'\\"')}"]`;const i=[];let n=t;for(;n&&n!==document.documentElement;){const r=n.tagName.toLowerCase(),s=n.parentElement;if(!s){i.unshift(r);break}const l=Array.from(s.children).filter(u=>u.tagName===n.tagName).indexOf(n)+1;i.unshift(`${r}[${l}]`),n=s}return"/"+i.join("/")}static findElement(t){try{if(t.startsWith("/")||t.startsWith("//"))return this.findElementByXPath(t);const i=this.parseContainsAndDescendant(t);if(i){const r=this.findElementWithContains(i.anchorPart);if(!r)return null;if(i.descendantPart){const s=r.querySelector(i.descendantPart);return s||null}return r}return t.match(/(.*):contains\('((?:[^'\\]|\\.)*)'\)$/)?this.findElementWithContains(t):document.querySelector(t)}catch{return null}}static parseContainsAndDescendant(t){const i=t.match(/:contains\('((?:[^'\\]|\\.)*)'\)/);if(!i)return null;const n=t.indexOf(i[0])+i[0].length,r=t.slice(n),s=r.indexOf(" > ");return s===-1?null:{anchorPart:t.slice(0,n+s).trim(),descendantPart:r.slice(s+3).trim()||null}}static findElementByXPath(t){try{return document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch{return null}}static findElementWithContains(t){const i=t.match(/(.*):contains\('((?:[^'\\]|\\.)*)'\)$/);if(!i)return null;const n=i[1].trim(),r=i[2].replace(/\\'/g,"'"),s=this.normalizeText(r),a=document.querySelectorAll(n);for(let l=0;l<a.length;l++)if(this.normalizeText(a[l].textContent||"").includes(s))return a[l];return null}static validateSelector(t){try{return this.findElement(t)!==null}catch{return!1}}static getSemanticDataAttributes(t){const i=["data-id","data-name","data-role","data-component","data-element"],n=[];for(const r of i)t.hasAttribute(r)&&n.push(r);for(let r=0;r<t.attributes.length;r++){const s=t.attributes[r];s.name.startsWith("data-")&&!n.includes(s.name)&&n.push(s.name)}return n}static generateAriaSelector(t){const i=t.getAttribute("role"),n=t.getAttribute("aria-label");if(i){let r=`[role="${this.escapeAttribute(i)}"]`;return n&&(r+=`[aria-label="${this.escapeAttribute(n)}"]`),r}return null}static generatePathSelector(t){const i=[];let n=t;for(;n&&n!==document.body&&n!==document.documentElement;){let r=n.tagName.toLowerCase();if(n.id){r+=`#${this.escapeSelector(n.id)}`,i.unshift(r);break}if(n.className&&typeof n.className=="string"){const a=n.className.split(/\s+/).filter(l=>l&&!l.startsWith("designer-")).slice(0,2);a.length>0&&(r+="."+a.map(l=>this.escapeSelector(l)).join("."))}const s=n.parentElement;if(s){const a=Array.from(s.children).filter(l=>l.tagName===n.tagName);a.length>1&&(r+=`:nth-of-type(${a.indexOf(n)+1})`)}if(i.unshift(r),n=s,i.length>=5)break}return i.length>0?i.join(" > "):null}static normalizeText(t){return(t||"").trim().replace(/\s+/g," ")}static buildSegment(t){let i=t.tagName.toLowerCase();if(t.className&&typeof t.className=="string"){const r=t.className.split(/\s+/).filter(s=>s&&!s.startsWith("designer-")).slice(0,2);r.length>0&&(i+="."+r.map(s=>this.escapeSelector(s)).join("."))}const n=t.parentElement;if(n){const r=Array.from(n.children).filter(s=>s.tagName===t.tagName);r.length>1&&(i+=`:nth-of-type(${r.indexOf(t)+1})`)}return i}static getPathFromAncestorToElement(t,i){const n=[];let r=i;for(;r&&r!==t;)n.unshift(r),r=r.parentElement;return r===t&&n.unshift(t),n}static generateContainsSelector(t){const n=(t.textContent||"").trim().replace(/\s+/g," ").slice(0,200);if(n.length<2)return null;const r=this.generatePathSelector(t);if(!r)return null;const s=n.replace(/\\/g,"\\\\").replace(/'/g,"\\'");return{selector:`${r}:contains('${s}')`,confidence:"high",method:"contains"}}static findAnchor(t){let i=t.parentElement;for(;i&&i!==document.body&&i!==document.documentElement;){if(i.id)return{anchor:i,hasId:!0};if((i.textContent||"").trim().replace(/\s+/g," ").length>=2)return{anchor:i,hasId:!1};i=i.parentElement}return null}static generatePathFromAnchorToElement(t){const i=this.findAnchor(t);if(!i)return null;const{anchor:n,hasId:r}=i,s=this.getPathFromAncestorToElement(n,t);if(s.length<2||s.length>12)return null;const l=[];if(r){l.push(`#${this.escapeSelector(n.id)}`);for(let u=1;u<s.length;u++)l.push(this.buildSegment(s[u]))}else{const u=(n.textContent||"").trim().replace(/\s+/g," ").slice(0,200);if(u.length<2)return null;const d=this.generatePathSelector(n);if(!d)return null;const h=u.replace(/\\/g,"\\\\").replace(/'/g,"\\'");l.push(`${d}:contains('${h}')`);for(let c=1;c<s.length;c++)l.push(this.buildSegment(s[c]))}return{selector:l.join(" > "),confidence:"high",method:"path-from-anchor"}}static escapeSelector(t){return typeof CSS<"u"&&CSS.escape?CSS.escape(t):t.replace(/([!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~])/g,"\\$1")}static escapeAttribute(t){return t.replace(/"/g,'\\"').replace(/'/g,"\\'")}}function Yi(e){const t=e.getBoundingClientRect(),i={};for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n];i[r.name]=r.value}return{tagName:e.tagName.toLowerCase(),id:e.id||void 0,className:e.className?.toString()||void 0,textContent:e.textContent?.trim().substring(0,50)||void 0,attributes:i,boundingRect:t}}function zt(e){const t=window.getComputedStyle(e);return t.display!=="none"&&t.visibility!=="hidden"&&t.opacity!=="0"&&e.getBoundingClientRect().height>0&&e.getBoundingClientRect().width>0}function Ae(){return window.location.pathname||"/"}function Xi(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Ji(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function Zi(e){Ji(e)||e.scrollIntoView({behavior:"smooth",block:"center"})}const Ut="#designer-editor-frame, #designer-highlight-overlay, #designer-exit-editor-btn, #designer-red-border-overlay, #designer-studio-badge";class en{isActive=!1;highlightOverlay=null;messageCallback=null;activate(t){this.isActive||(this.isActive=!0,this.messageCallback=t,this.createHighlightOverlay(),this.attachEventListeners(),this.addEditorStyles())}deactivate(){this.isActive&&(this.isActive=!1,this.removeEventListeners(),this.removeHighlightOverlay(),this.removeEditorStyles(),this.messageCallback=null)}getActive(){return this.isActive}createHighlightOverlay(){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.createHighlightOverlay());return}setTimeout(()=>this.createHighlightOverlay(),100);return}this.highlightOverlay=document.createElement("div"),this.highlightOverlay.id="designer-highlight-overlay",this.highlightOverlay.style.cssText=`
      position: absolute;
      pointer-events: none;
      border: 2px solid #3b82f6;
      background-color: rgba(59, 130, 246, 0.1);
      z-index: 999998;
      transition: all 0.1s ease;
      box-sizing: border-box;
      display: none;
    `,document.body.appendChild(this.highlightOverlay)}removeHighlightOverlay(){this.highlightOverlay?.remove(),this.highlightOverlay=null}attachEventListeners(){document.addEventListener("mouseover",this.handleMouseOver,!0),document.addEventListener("click",this.handleClick,!0),document.addEventListener("keydown",this.handleKeyDown,!0)}removeEventListeners(){document.removeEventListener("mouseover",this.handleMouseOver,!0),document.removeEventListener("click",this.handleClick,!0),document.removeEventListener("keydown",this.handleKeyDown,!0)}handleMouseOver=t=>{if(!this.isActive||!this.highlightOverlay)return;const i=t.target;if(!(!i||i===this.highlightOverlay)){if(i.closest(Ut)){this.hideHighlight();return}if(!zt(i)){this.hideHighlight();return}this.highlightElement(i)}};handleClick=t=>{if(!this.isActive)return;const i=t.target;i&&(i.closest(Ut)||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),zt(i)&&this.selectElement(i)))};handleKeyDown=t=>{this.isActive&&t.key==="Escape"&&(this.messageCallback?.({type:"CANCEL"}),this.hideHighlight())};highlightElement(t){if(!this.highlightOverlay)return;const i=t.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;this.highlightOverlay.style.display="block",this.highlightOverlay.style.left=`${i.left+n}px`,this.highlightOverlay.style.top=`${i.top+r}px`,this.highlightOverlay.style.width=`${i.width}px`,this.highlightOverlay.style.height=`${i.height}px`}hideHighlight(){this.highlightOverlay&&(this.highlightOverlay.style.display="none")}selectElement(t){this.highlightElement(t);const i=ie.generateSelector(t),n=Yi(t),r=ie.getXPath(t);this.messageCallback?.({type:"ELEMENT_SELECTED",selector:i.selector,elementInfo:n,xpath:r})}addEditorStyles(){const t=document.createElement("style");t.id="designer-editor-styles",t.textContent=`
      * { user-select: none !important; -webkit-user-select: none !important; -moz-user-select: none !important; -ms-user-select: none !important; }
      a, button, input, textarea, select { pointer-events: auto !important; }
    `,document.head.appendChild(t)}removeEditorStyles(){document.getElementById("designer-editor-styles")?.remove()}}var Le,w,$t,de,Bt,Nt,Wt,Qt,tt,it,nt,jt,Ce={},Gt=[],tn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ke=Array.isArray;function X(e,t){for(var i in t)e[i]=t[i];return e}function rt(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function st(e,t,i){var n,r,s,a={};for(s in t)s=="key"?n=t[s]:s=="ref"?r=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?Le.call(arguments,2):i),typeof e=="function"&&e.defaultProps!=null)for(s in e.defaultProps)a[s]===void 0&&(a[s]=e.defaultProps[s]);return He(e,a,n,r,null)}function He(e,t,i,n,r){var s={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++$t,__i:-1,__u:0};return r==null&&w.vnode!=null&&w.vnode(s),s}function V(e){return e.children}function J(e,t){this.props=e,this.context=t}function ye(e,t){if(t==null)return e.__?ye(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if((i=e.__k[t])!=null&&i.__e!=null)return i.__e;return typeof e.type=="function"?ye(e):null}function Kt(e){var t,i;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((i=e.__k[t])!=null&&i.__e!=null){e.__e=e.__c.base=i.__e;break}return Kt(e)}}function ot(e){(!e.__d&&(e.__d=!0)&&de.push(e)&&!ze.__r++||Bt!=w.debounceRendering)&&((Bt=w.debounceRendering)||Nt)(ze)}function ze(){for(var e,t,i,n,r,s,a,l=1;de.length;)de.length>l&&de.sort(Wt),e=de.shift(),l=de.length,e.__d&&(i=void 0,n=void 0,r=(n=(t=e).__v).__e,s=[],a=[],t.__P&&((i=X({},n)).__v=n.__v+1,w.vnode&&w.vnode(i),at(t.__P,i,n,t.__n,t.__P.namespaceURI,32&n.__u?[r]:null,s,r??ye(n),!!(32&n.__u),a),i.__v=n.__v,i.__.__k[i.__i]=i,Jt(s,i,a),n.__e=n.__=null,i.__e!=r&&Kt(i)));ze.__r=0}function qt(e,t,i,n,r,s,a,l,u,d,h){var c,p,m,v,b,S,g,_=n&&n.__k||Gt,I=t.length;for(u=nn(i,t,_,u,I),c=0;c<I;c++)(m=i.__k[c])!=null&&(p=m.__i==-1?Ce:_[m.__i]||Ce,m.__i=c,S=at(e,m,p,r,s,a,l,u,d,h),v=m.__e,m.ref&&p.ref!=m.ref&&(p.ref&&ct(p.ref,null,m),h.push(m.ref,m.__c||v,m)),b==null&&v!=null&&(b=v),(g=!!(4&m.__u))||p.__k===m.__k?u=Vt(m,u,e,g):typeof m.type=="function"&&S!==void 0?u=S:v&&(u=v.nextSibling),m.__u&=-7);return i.__e=b,u}function nn(e,t,i,n,r){var s,a,l,u,d,h=i.length,c=h,p=0;for(e.__k=new Array(r),s=0;s<r;s++)(a=t[s])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[s]=He(null,a,null,null,null):ke(a)?a=e.__k[s]=He(V,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[s]=He(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[s]=a,u=s+p,a.__=e,a.__b=e.__b+1,l=null,(d=a.__i=rn(a,i,u,c))!=-1&&(c--,(l=i[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(r>h?p--:r<h&&p++),typeof a.type!="function"&&(a.__u|=4)):d!=u&&(d==u-1?p--:d==u+1?p++:(d>u?p--:p++,a.__u|=4))):e.__k[s]=null;if(c)for(s=0;s<h;s++)(l=i[s])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=ye(l)),ei(l,l));return n}function Vt(e,t,i,n){var r,s;if(typeof e.type=="function"){for(r=e.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=e,t=Vt(r[s],t,i,n));return t}e.__e!=t&&(n&&(t&&e.type&&!t.parentNode&&(t=ye(e)),i.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ue(e,t){return t=t||[],e==null||typeof e=="boolean"||(ke(e)?e.some(function(i){Ue(i,t)}):t.push(e)),t}function rn(e,t,i,n){var r,s,a,l=e.key,u=e.type,d=t[i],h=d!=null&&(2&d.__u)==0;if(d===null&&l==null||h&&l==d.key&&u==d.type)return i;if(n>(h?1:0)){for(r=i-1,s=i+1;r>=0||s<t.length;)if((d=t[a=r>=0?r--:s++])!=null&&(2&d.__u)==0&&l==d.key&&u==d.type)return a}return-1}function Yt(e,t,i){t[0]=="-"?e.setProperty(t,i??""):e[t]=i==null?"":typeof i!="number"||tn.test(t)?i:i+"px"}function $e(e,t,i,n,r){var s,a;e:if(t=="style")if(typeof i=="string")e.style.cssText=i;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||Yt(e.style,t,"");if(i)for(t in i)n&&i[t]==n[t]||Yt(e.style,t,i[t])}else if(t[0]=="o"&&t[1]=="n")s=t!=(t=t.replace(Qt,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=i,i?n?i.u=n.u:(i.u=tt,e.addEventListener(t,s?nt:it,s)):e.removeEventListener(t,s?nt:it,s);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&i==1?"":i))}}function Xt(e){return function(t){if(this.l){var i=this.l[t.type+e];if(t.t==null)t.t=tt++;else if(t.t<i.u)return;return i(w.event?w.event(t):t)}}}function at(e,t,i,n,r,s,a,l,u,d){var h,c,p,m,v,b,S,g,_,I,F,U,L,O,k,M,N,P=t.type;if(t.constructor!==void 0)return null;128&i.__u&&(u=!!(32&i.__u),s=[l=t.__e=i.__e]),(h=w.__b)&&h(t);e:if(typeof P=="function")try{if(g=t.props,_="prototype"in P&&P.prototype.render,I=(h=P.contextType)&&n[h.__c],F=h?I?I.props.value:h.__:n,i.__c?S=(c=t.__c=i.__c).__=c.__E:(_?t.__c=c=new P(g,F):(t.__c=c=new J(g,F),c.constructor=P,c.render=on),I&&I.sub(c),c.state||(c.state={}),c.__n=n,p=c.__d=!0,c.__h=[],c._sb=[]),_&&c.__s==null&&(c.__s=c.state),_&&P.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=X({},c.__s)),X(c.__s,P.getDerivedStateFromProps(g,c.__s))),m=c.props,v=c.state,c.__v=t,p)_&&P.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),_&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(_&&P.getDerivedStateFromProps==null&&g!==m&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(g,F),t.__v==i.__v||!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(g,c.__s,F)===!1){for(t.__v!=i.__v&&(c.props=g,c.state=c.__s,c.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.some(function(H){H&&(H.__=t)}),U=0;U<c._sb.length;U++)c.__h.push(c._sb[U]);c._sb=[],c.__h.length&&a.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(g,c.__s,F),_&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(m,v,b)})}if(c.context=F,c.props=g,c.__P=e,c.__e=!1,L=w.__r,O=0,_){for(c.state=c.__s,c.__d=!1,L&&L(t),h=c.render(c.props,c.state,c.context),k=0;k<c._sb.length;k++)c.__h.push(c._sb[k]);c._sb=[]}else do c.__d=!1,L&&L(t),h=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++O<25);c.state=c.__s,c.getChildContext!=null&&(n=X(X({},n),c.getChildContext())),_&&!p&&c.getSnapshotBeforeUpdate!=null&&(b=c.getSnapshotBeforeUpdate(m,v)),M=h,h!=null&&h.type===V&&h.key==null&&(M=Zt(h.props.children)),l=qt(e,ke(M)?M:[M],t,i,n,r,s,a,l,u,d),c.base=t.__e,t.__u&=-161,c.__h.length&&a.push(c),S&&(c.__E=c.__=null)}catch(H){if(t.__v=null,u||s!=null)if(H.then){for(t.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,t.__e=l}else{for(N=s.length;N--;)rt(s[N]);lt(t)}else t.__e=i.__e,t.__k=i.__k,H.then||lt(t);w.__e(H,t,i)}else s==null&&t.__v==i.__v?(t.__k=i.__k,t.__e=i.__e):l=t.__e=sn(i.__e,t,i,n,r,s,a,u,d);return(h=w.diffed)&&h(t),128&t.__u?void 0:l}function lt(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(lt)}function Jt(e,t,i){for(var n=0;n<i.length;n++)ct(i[n],i[++n],i[++n]);w.__c&&w.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(s){s.call(r)})}catch(s){w.__e(s,r.__v)}})}function Zt(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:ke(e)?e.map(Zt):X({},e)}function sn(e,t,i,n,r,s,a,l,u){var d,h,c,p,m,v,b,S=i.props||Ce,g=t.props,_=t.type;if(_=="svg"?r="http://www.w3.org/2000/svg":_=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(d=0;d<s.length;d++)if((m=s[d])&&"setAttribute"in m==!!_&&(_?m.localName==_:m.nodeType==3)){e=m,s[d]=null;break}}if(e==null){if(_==null)return document.createTextNode(g);e=document.createElementNS(r,_,g.is&&g),l&&(w.__m&&w.__m(t,s),l=!1),s=null}if(_==null)S===g||l&&e.data==g||(e.data=g);else{if(s=s&&Le.call(e.childNodes),!l&&s!=null)for(S={},d=0;d<e.attributes.length;d++)S[(m=e.attributes[d]).name]=m.value;for(d in S)if(m=S[d],d!="children"){if(d=="dangerouslySetInnerHTML")c=m;else if(!(d in g)){if(d=="value"&&"defaultValue"in g||d=="checked"&&"defaultChecked"in g)continue;$e(e,d,null,m,r)}}for(d in g)m=g[d],d=="children"?p=m:d=="dangerouslySetInnerHTML"?h=m:d=="value"?v=m:d=="checked"?b=m:l&&typeof m!="function"||S[d]===m||$e(e,d,m,S[d],r);if(h)l||c&&(h.__html==c.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(c&&(e.innerHTML=""),qt(t.type=="template"?e.content:e,ke(p)?p:[p],t,i,n,_=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,a,s?s[0]:i.__k&&ye(i,0),l,u),s!=null)for(d=s.length;d--;)rt(s[d]);l||(d="value",_=="progress"&&v==null?e.removeAttribute("value"):v!=null&&(v!==e[d]||_=="progress"&&!v||_=="option"&&v!=S[d])&&$e(e,d,v,S[d],r),d="checked",b!=null&&b!=e[d]&&$e(e,d,b,S[d],r))}return e}function ct(e,t,i){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(r){w.__e(r,i)}}function ei(e,t,i){var n,r;if(w.unmount&&w.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||ct(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(s){w.__e(s,t)}n.base=n.__P=null}if(n=e.__k)for(r=0;r<n.length;r++)n[r]&&ei(n[r],t,i||typeof e.type!="function");i||rt(e.__e),e.__c=e.__=e.__e=void 0}function on(e,t,i){return this.constructor(e,i)}function _e(e,t,i){var n,r,s,a;t==document&&(t=document.documentElement),w.__&&w.__(e,t),r=(n=!1)?null:t.__k,s=[],a=[],at(t,e=t.__k=st(V,null,[e]),r||Ce,Ce,t.namespaceURI,r?null:t.firstChild?Le.call(t.childNodes):null,s,r?r.__e:t.firstChild,n,a),Jt(s,e,a)}function dt(e){function t(i){var n,r;return this.getChildContext||(n=new Set,(r={})[t.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&n.forEach(function(a){a.__e=!0,ot(a)})},this.sub=function(s){n.add(s);var a=s.componentWillUnmount;s.componentWillUnmount=function(){n&&n.delete(s),a&&a.call(s)}}),i.children}return t.__c="__cC"+jt++,t.__=e,t.Provider=t.__l=(t.Consumer=function(i,n){return i.children(n)}).contextType=t,t}Le=Gt.slice,w={__e:function(e,t,i,n){for(var r,s,a;t=t.__;)if((r=t.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(e)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,n||{}),a=r.__d),a)return r.__E=r}catch(l){e=l}throw e}},$t=0,J.prototype.setState=function(e,t){var i;i=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=X({},this.state),typeof e=="function"&&(e=e(X({},i),this.props)),e&&X(i,e),e!=null&&this.__v&&(t&&this._sb.push(t),ot(this))},J.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ot(this))},J.prototype.render=V,de=[],Nt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Wt=function(e,t){return e.__v.__b-t.__v.__b},ze.__r=0,Qt=/(PointerCapture)$|Capture$/i,tt=0,it=Xt(!1),nt=Xt(!0),jt=0;var an=0;function o(e,t,i,n,r,s){t||(t={});var a,l,u=t;if("ref"in u)for(l in u={},t)l=="ref"?a=t[l]:u[l]=t[l];var d={type:e,props:u,key:i,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--an,__i:-1,__u:0,__source:r,__self:s};if(typeof e=="function"&&(a=e.defaultProps))for(l in a)u[l]===void 0&&(u[l]=a[l]);return w.vnode&&w.vnode(d),d}const E={fontFamily:"'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif",primary:"#3b82f6",text:"#111827",bg:"#ffffff",shadow:"0 4px 12px rgba(0, 0, 0, 0.15)",shadowHover:"0 6px 16px rgba(0, 0, 0, 0.2)",borderRadius:"8px",zIndex:{overlay:999995,guides:999996,tooltip:999997,highlight:999998,controls:1e6,badge:1000001,loading:1000002}};function ln({guide:e,top:t,left:i,arrowStyle:n,onDismiss:r}){return o("div",{className:"designer-guide-tooltip","data-guide-id":e.id,style:{position:"absolute",background:E.bg,border:`2px solid ${E.primary}`,borderRadius:E.borderRadius,padding:"12px 16px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.15)",zIndex:E.zIndex.tooltip,maxWidth:300,fontFamily:E.fontFamily,fontSize:14,lineHeight:1.5,color:E.text,top:`${t}px`,left:`${i}px`,pointerEvents:"auto"},children:[o("div",{style:{marginBottom:8},children:e.content}),o("button",{type:"button",onClick:r,style:{background:E.primary,color:E.bg,border:"none",borderRadius:4,padding:"6px 12px",fontSize:12,fontWeight:500,cursor:"pointer",transition:"background 0.2s"},children:"Got it"}),o("div",{className:"designer-guide-arrow",style:{position:"absolute",width:0,height:0,borderStyle:"solid",...n}})]})}function cn(e){const t={position:"absolute"};switch(e){case"top":return{...t,bottom:"-8px",left:"50%",transform:"translateX(-50%)",borderWidth:"8px 8px 0 8px",borderColor:`${E.primary} transparent transparent transparent`};case"bottom":return{...t,top:"-8px",left:"50%",transform:"translateX(-50%)",borderWidth:"0 8px 8px 8px",borderColor:`transparent transparent ${E.primary} transparent`};case"left":return{...t,right:"-8px",top:"50%",transform:"translateY(-50%)",borderWidth:"8px 0 8px 8px",borderColor:`transparent transparent transparent ${E.primary}`};default:return{...t,left:"-8px",top:"50%",transform:"translateY(-50%)",borderWidth:"8px 8px 8px 0",borderColor:`transparent ${E.primary} transparent transparent`}}}function dn(e,t,i,n){const r=e.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,l=window.innerWidth,u=window.innerHeight;let d=0,h=0;switch(t){case"top":d=r.top+a-n-12,h=r.left+s+r.width/2-i/2;break;case"bottom":d=r.bottom+a+12,h=r.left+s+r.width/2-i/2;break;case"left":d=r.top+a+r.height/2-n/2,h=r.left+s-i-12;break;default:d=r.top+a+r.height/2-n/2,h=r.right+s+12;break}return h<s?h=s+10:h+i>s+l&&(h=s+l-i-10),d<a?d=a+10:d+n>a+u&&(d=a+u-n-10),{top:d,left:h,arrowStyle:cn(t)}}class un{container=null;onDismiss=()=>{};lastGuides=[];dismissedThisSession=new Set;setOnDismiss(t){this.onDismiss=t}renderGuides(t){this.lastGuides=t;const i=Ae(),n=t.filter(s=>s.page===i&&s.status==="active"&&!this.dismissedThisSession.has(s.id));if(n.length===0||(this.ensureContainer(),!this.container))return;const r=[];for(const s of n){const a=ie.findElement(s.selector);if(!a)continue;Zi(a);const l=dn(a,s.placement,280,80);r.push({guide:s,target:a,pos:l})}_e(o("div",{id:"designer-guides-container",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:E.zIndex.guides},children:r.map(({guide:s,pos:a})=>o(ln,{guide:s,top:a.top,left:a.left,arrowStyle:a.arrowStyle,onDismiss:()=>this.dismissGuide(s.id)},s.id))}),this.container)}updatePositions(t){this.renderGuides(t)}dismissGuide(t){this.dismissedThisSession.add(t),this.onDismiss(t),this.renderGuides(this.lastGuides)}clear(){this.dismissedThisSession.clear(),this.container&&_e(null,this.container)}ensureContainer(){if(!this.container){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.ensureContainer());return}setTimeout(()=>this.ensureContainer(),100);return}this.container=document.createElement("div"),this.container.id="designer-guides-root",document.body.appendChild(this.container)}}}const ti=["rgba(251, 191, 36, 0.35)","rgba(34, 197, 94, 0.35)","rgba(249, 115, 22, 0.35)"];function hn({feature:e,color:t,rect:i}){return o("div",{className:"designer-feature-heatmap-overlay",title:e.featureName,style:{position:"fixed",left:i.left,top:i.top,width:i.width,height:i.height,backgroundColor:t,pointerEvents:"none",zIndex:E.zIndex.overlay,boxSizing:"border-box",borderRadius:4,border:`2px solid ${t}`}})}class fn{container=null;lastEnabled=!1;render(t,i){if(this.lastEnabled=i,this.clear(),!i||t.length===0)return;const n=t.filter(s=>(s.selector||"").trim()!=="");if(this.ensureContainer(),!this.container)return;const r=n.map((s,a)=>{const l=ie.findElement(s.selector);if(!l)return null;const u=l.getBoundingClientRect(),d=ti[a%ti.length];return{feature:s,rect:u,color:d}}).filter(Boolean);r.length!==0&&_e(o("div",{id:"designer-feature-heatmap-container",style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:E.zIndex.overlay-1},children:r.map(({feature:s,rect:a,color:l})=>o(hn,{feature:s,color:l,rect:{left:a.left,top:a.top,width:a.width,height:a.height}},s.id))}),this.container)}updatePositions(t){this.render(t,this.lastEnabled)}clear(){this.container&&_e(null,this.container)}destroy(){this.clear(),this.container?.remove(),this.container=null}ensureContainer(){if(!this.container){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.ensureContainer());return}setTimeout(()=>this.ensureContainer(),100);return}this.container=document.createElement("div"),this.container.id="designer-feature-heatmap-root",document.body.appendChild(this.container)}}}var ve=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},pn={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},mn=class{#e=pn;#t=!1;setTimeoutProvider(e){this.#e=e}setTimeout(e,t){return this.#e.setTimeout(e,t)}clearTimeout(e){this.#e.clearTimeout(e)}setInterval(e,t){return this.#e.setInterval(e,t)}clearInterval(e){this.#e.clearInterval(e)}},ue=new mn;function gn(e){setTimeout(e,0)}var he=typeof window>"u"||"Deno"in globalThis;function $(){}function yn(e,t){return typeof e=="function"?e(t):e}function ut(e){return typeof e=="number"&&e>=0&&e!==1/0}function ii(e,t){return Math.max(e+(t||0)-Date.now(),0)}function ne(e,t){return typeof e=="function"?e(t):e}function Q(e,t){return typeof e=="function"?e(t):e}function ni(e,t){const{type:i="all",exact:n,fetchStatus:r,predicate:s,queryKey:a,stale:l}=e;if(a){if(n){if(t.queryHash!==ht(a,t.options))return!1}else if(!Te(t.queryKey,a))return!1}if(i!=="all"){const u=t.isActive();if(i==="active"&&!u||i==="inactive"&&u)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||r&&r!==t.state.fetchStatus||s&&!s(t))}function ri(e,t){const{exact:i,status:n,predicate:r,mutationKey:s}=e;if(s){if(!t.options.mutationKey)return!1;if(i){if(fe(t.options.mutationKey)!==fe(s))return!1}else if(!Te(t.options.mutationKey,s))return!1}return!(n&&t.state.status!==n||r&&!r(t))}function ht(e,t){return(t?.queryKeyHashFn||fe)(e)}function fe(e){return JSON.stringify(e,(t,i)=>ft(i)?Object.keys(i).sort().reduce((n,r)=>(n[r]=i[r],n),{}):i)}function Te(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(i=>Te(e[i],t[i])):!1}var _n=Object.prototype.hasOwnProperty;function si(e,t,i=0){if(e===t)return e;if(i>500)return t;const n=oi(e)&&oi(t);if(!n&&!(ft(e)&&ft(t)))return t;const s=(n?e:Object.keys(e)).length,a=n?t:Object.keys(t),l=a.length,u=n?new Array(l):{};let d=0;for(let h=0;h<l;h++){const c=n?h:a[h],p=e[c],m=t[c];if(p===m){u[c]=p,(n?h<s:_n.call(e,c))&&d++;continue}if(p===null||m===null||typeof p!="object"||typeof m!="object"){u[c]=m;continue}const v=si(p,m,i+1);u[c]=v,v===p&&d++}return s===l&&d===s?e:u}function Be(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}function oi(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function ft(e){if(!ai(e))return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(!ai(i)||!i.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function ai(e){return Object.prototype.toString.call(e)==="[object Object]"}function vn(e){return new Promise(t=>{ue.setTimeout(t,e)})}function pt(e,t,i){return typeof i.structuralSharing=="function"?i.structuralSharing(e,t):i.structuralSharing!==!1?si(e,t):t}function bn(e,t,i=0){const n=[...e,t];return i&&n.length>i?n.slice(1):n}function wn(e,t,i=0){const n=[t,...e];return i&&n.length>i?n.slice(0,-1):n}var mt=Symbol();function li(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===mt?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function gt(e,t){return typeof e=="function"?e(...t):!!e}function Sn(e,t,i){let n=!1,r;return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(r??=t(),n||(n=!0,r.aborted?i():r.addEventListener("abort",i,{once:!0})),r)}),e}var xn=class extends ve{#e;#t;#i;constructor(){super(),this.#i=e=>{if(!he&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#i=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},yt=new xn;function _t(){let e,t;const i=new Promise((r,s)=>{e=r,t=s});i.status="pending",i.catch(()=>{});function n(r){Object.assign(i,r),delete i.resolve,delete i.reject}return i.resolve=r=>{n({status:"fulfilled",value:r}),e(r)},i.reject=r=>{n({status:"rejected",reason:r}),t(r)},i}var En=gn;function Cn(){let e=[],t=0,i=l=>{l()},n=l=>{l()},r=En;const s=l=>{t?e.push(l):r(()=>{i(l)})},a=()=>{const l=e;e=[],l.length&&r(()=>{n(()=>{l.forEach(u=>{i(u)})})})};return{batch:l=>{let u;t++;try{u=l()}finally{t--,t||a()}return u},batchCalls:l=>(...u)=>{s(()=>{l(...u)})},schedule:s,setNotifyFunction:l=>{i=l},setBatchNotifyFunction:l=>{n=l},setScheduler:l=>{r=l}}}var A=Cn(),kn=class extends ve{#e=!0;#t;#i;constructor(){super(),this.#i=e=>{if(!he&&window.addEventListener){const t=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#i=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(i=>{i(e)}))}isOnline(){return this.#e}},Ne=new kn;function Tn(e){return Math.min(1e3*2**e,3e4)}function ci(e){return(e??"online")==="online"?Ne.isOnline():!0}var vt=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function di(e){let t=!1,i=0,n;const r=_t(),s=()=>r.status!=="pending",a=b=>{if(!s()){const S=new vt(b);p(S),e.onCancel?.(S)}},l=()=>{t=!0},u=()=>{t=!1},d=()=>yt.isFocused()&&(e.networkMode==="always"||Ne.isOnline())&&e.canRun(),h=()=>ci(e.networkMode)&&e.canRun(),c=b=>{s()||(n?.(),r.resolve(b))},p=b=>{s()||(n?.(),r.reject(b))},m=()=>new Promise(b=>{n=S=>{(s()||d())&&b(S)},e.onPause?.()}).then(()=>{n=void 0,s()||e.onContinue?.()}),v=()=>{if(s())return;let b;const S=i===0?e.initialPromise:void 0;try{b=S??e.fn()}catch(g){b=Promise.reject(g)}Promise.resolve(b).then(c).catch(g=>{if(s())return;const _=e.retry??(he?0:3),I=e.retryDelay??Tn,F=typeof I=="function"?I(i,g):I,U=_===!0||typeof _=="number"&&i<_||typeof _=="function"&&_(i,g);if(t||!U){p(g);return}i++,e.onFail?.(i,g),vn(F).then(()=>d()?void 0:m()).then(()=>{t?p(g):v()})})};return{promise:r,status:()=>r.status,cancel:a,continue:()=>(n?.(),r),cancelRetry:l,continueRetry:u,canStart:h,start:()=>(h()?v():m().then(v),r)}}var ui=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ut(this.gcTime)&&(this.#e=ue.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(he?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ue.clearTimeout(this.#e),this.#e=void 0)}},Pn=class extends ui{#e;#t;#i;#r;#n;#o;#a;constructor(e){super(),this.#a=!1,this.#o=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#r=e.client,this.#i=this.#r.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=pi(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(e){if(this.options={...this.#o,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=pi(this.options);t.data!==void 0&&(this.setState(fi(t.data,t.dataUpdatedAt)),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#i.remove(this)}setData(e,t){const i=pt(this.state.data,e,this.options);return this.#s({data:i,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),i}setState(e,t){this.#s({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#n?.promise;return this.#n?.cancel(e),t?t.then($).catch($):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Q(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===mt||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ne(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!ii(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#i.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(e&&this.setOptions(e),!this.options.queryFn){const l=this.observers.find(u=>u.options.queryFn);l&&this.setOptions(l.options)}const i=new AbortController,n=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#a=!0,i.signal)})},r=()=>{const l=li(this.options,t),d=(()=>{const h={client:this.#r,queryKey:this.queryKey,meta:this.meta};return n(h),h})();return this.#a=!1,this.options.persister?this.options.persister(l,d,this):l(d)},a=(()=>{const l={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:r};return n(l),l})();this.options.behavior?.onFetch(a,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==a.fetchOptions?.meta)&&this.#s({type:"fetch",meta:a.fetchOptions?.meta}),this.#n=di({initialPromise:t?.initialPromise,fn:a.fetchFn,onCancel:l=>{l instanceof vt&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),i.abort()},onFail:(l,u)=>{this.#s({type:"failed",failureCount:l,error:u})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0});try{const l=await this.#n.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#i.config.onSuccess?.(l,this),this.#i.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof vt){if(l.silent)return this.#n.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#s({type:"error",error:l}),this.#i.config.onError?.(l,this),this.#i.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#s(e){const t=i=>{switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...hi(i.data,this.options),fetchMeta:e.meta??null};case"success":const n={...i,...fi(e.data,e.dataUpdatedAt),dataUpdateCount:i.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?n:void 0,n;case"error":const r=e.error;return{...i,error:r,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=t(this.state),A.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),this.#i.notify({query:this,type:"updated",action:e})})}};function hi(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ci(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function fi(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function pi(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,i=t!==void 0,n=i?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}var In=class extends ve{constructor(e,t){super(),this.options=t,this.#e=e,this.#s=null,this.#a=_t(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#i=void 0;#r=void 0;#n;#o;#a;#s;#m;#h;#f;#c;#d;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),mi(this.#t,this.options)?this.#u():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return bt(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return bt(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#w(),this.#t.removeObserver(this)}setOptions(e){const t=this.options,i=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Q(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),t._defaulted&&!Be(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const n=this.hasListeners();n&&gi(this.#t,i,this.options,t)&&this.#u(),this.updateResult(),n&&(this.#t!==i||Q(this.options.enabled,this.#t)!==Q(t.enabled,this.#t)||ne(this.options.staleTime,this.#t)!==ne(t.staleTime,this.#t))&&this.#g();const r=this.#y();n&&(this.#t!==i||Q(this.options.enabled,this.#t)!==Q(t.enabled,this.#t)||r!==this.#l)&&this.#_(r)}getOptimisticResult(e){const t=this.#e.getQueryCache().build(this.#e,e),i=this.createResult(t,e);return Fn(this,i)&&(this.#r=i,this.#o=this.options,this.#n=this.#t.state),i}getCurrentResult(){return this.#r}trackResult(e,t){return new Proxy(e,{get:(i,n)=>(this.trackProp(n),t?.(n),n==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(i,n))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#e.defaultQueryOptions(e),i=this.#e.getQueryCache().build(this.#e,t);return i.fetch().then(()=>this.createResult(i,t))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#u(e){this.#S();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch($)),t}#g(){this.#b();const e=ne(this.options.staleTime,this.#t);if(he||this.#r.isStale||!ut(e))return;const i=ii(this.#r.dataUpdatedAt,e)+1;this.#c=ue.setTimeout(()=>{this.#r.isStale||this.updateResult()},i)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(e){this.#w(),this.#l=e,!(he||Q(this.options.enabled,this.#t)===!1||!ut(this.#l)||this.#l===0)&&(this.#d=ue.setInterval(()=>{(this.options.refetchIntervalInBackground||yt.isFocused())&&this.#u()},this.#l))}#v(){this.#g(),this.#_(this.#y())}#b(){this.#c&&(ue.clearTimeout(this.#c),this.#c=void 0)}#w(){this.#d&&(ue.clearInterval(this.#d),this.#d=void 0)}createResult(e,t){const i=this.#t,n=this.options,r=this.#r,s=this.#n,a=this.#o,u=e!==i?e.state:this.#i,{state:d}=e;let h={...d},c=!1,p;if(t._optimisticResults){const k=this.hasListeners(),M=!k&&mi(e,t),N=k&&gi(e,i,t,n);(M||N)&&(h={...h,...hi(d.data,e.options)}),t._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:m,errorUpdatedAt:v,status:b}=h;p=h.data;let S=!1;if(t.placeholderData!==void 0&&p===void 0&&b==="pending"){let k;r?.isPlaceholderData&&t.placeholderData===a?.placeholderData?(k=r.data,S=!0):k=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,k!==void 0&&(b="success",p=pt(r?.data,k,t),c=!0)}if(t.select&&p!==void 0&&!S)if(r&&p===s?.data&&t.select===this.#m)p=this.#h;else try{this.#m=t.select,p=t.select(p),p=pt(r?.data,p,t),this.#h=p,this.#s=null}catch(k){this.#s=k}this.#s&&(m=this.#s,p=this.#h,v=Date.now(),b="error");const g=h.fetchStatus==="fetching",_=b==="pending",I=b==="error",F=_&&g,U=p!==void 0,O={status:b,fetchStatus:h.fetchStatus,isPending:_,isSuccess:b==="success",isError:I,isInitialLoading:F,isLoading:F,data:p,dataUpdatedAt:h.dataUpdatedAt,error:m,errorUpdatedAt:v,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>u.dataUpdateCount||h.errorUpdateCount>u.errorUpdateCount,isFetching:g,isRefetching:g&&!_,isLoadingError:I&&!U,isPaused:h.fetchStatus==="paused",isPlaceholderData:c,isRefetchError:I&&U,isStale:wt(e,t),refetch:this.refetch,promise:this.#a,isEnabled:Q(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const k=O.data!==void 0,M=O.status==="error"&&!k,N=j=>{M?j.reject(O.error):k&&j.resolve(O.data)},P=()=>{const j=this.#a=O.promise=_t();N(j)},H=this.#a;switch(H.status){case"pending":e.queryHash===i.queryHash&&N(H);break;case"fulfilled":(M||O.data!==H.value)&&P();break;case"rejected":(!M||O.error!==H.reason)&&P();break}}return O}updateResult(){const e=this.#r,t=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#o=this.options,this.#n.data!==void 0&&(this.#f=this.#t),Be(t,e))return;this.#r=t;const i=()=>{if(!e)return!0;const{notifyOnChangeProps:n}=this.options,r=typeof n=="function"?n():n;if(r==="all"||!r&&!this.#p.size)return!0;const s=new Set(r??this.#p);return this.options.throwOnError&&s.add("error"),Object.keys(this.#r).some(a=>{const l=a;return this.#r[l]!==e[l]&&s.has(l)})};this.#x({listeners:i()})}#S(){const e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;const t=this.#t;this.#t=e,this.#i=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#x(e){A.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Rn(e,t){return Q(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function mi(e,t){return Rn(e,t)||e.state.data!==void 0&&bt(e,t,t.refetchOnMount)}function bt(e,t,i){if(Q(t.enabled,e)!==!1&&ne(t.staleTime,e)!=="static"){const n=typeof i=="function"?i(e):i;return n==="always"||n!==!1&&wt(e,t)}return!1}function gi(e,t,i,n){return(e!==t||Q(n.enabled,e)===!1)&&(!i.suspense||e.state.status!=="error")&&wt(e,i)}function wt(e,t){return Q(t.enabled,e)!==!1&&e.isStaleByTime(ne(t.staleTime,e))}function Fn(e,t){return!Be(e.getCurrentResult(),t)}function yi(e){return{onFetch:(t,i)=>{const n=t.options,r=t.fetchOptions?.meta?.fetchMore?.direction,s=t.state.data?.pages||[],a=t.state.data?.pageParams||[];let l={pages:[],pageParams:[]},u=0;const d=async()=>{let h=!1;const c=v=>{Sn(v,()=>t.signal,()=>h=!0)},p=li(t.options,t.fetchOptions),m=async(v,b,S)=>{if(h)return Promise.reject();if(b==null&&v.pages.length)return Promise.resolve(v);const _=(()=>{const L={client:t.client,queryKey:t.queryKey,pageParam:b,direction:S?"backward":"forward",meta:t.options.meta};return c(L),L})(),I=await p(_),{maxPages:F}=t.options,U=S?wn:bn;return{pages:U(v.pages,I,F),pageParams:U(v.pageParams,b,F)}};if(r&&s.length){const v=r==="backward",b=v?On:_i,S={pages:s,pageParams:a},g=b(n,S);l=await m(S,g,v)}else{const v=e??s.length;do{const b=u===0?a[0]??n.initialPageParam:_i(n,l);if(u>0&&b==null)break;l=await m(l,b),u++}while(u<v)}return l};t.options.persister?t.fetchFn=()=>t.options.persister?.(d,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i):t.fetchFn=d}}}function _i(e,{pages:t,pageParams:i}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,i[n],i):void 0}function On(e,{pages:t,pageParams:i}){return t.length>0?e.getPreviousPageParam?.(t[0],t,i[0],i):void 0}var Dn=class extends ui{#e;#t;#i;#r;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#i=e.mutationCache,this.#t=[],this.state=e.state||vi(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(t=>t!==e),this.scheduleGc(),this.#i.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#i.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#n({type:"continue"})},i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=di({fn:()=>this.options.mutationFn?this.options.mutationFn(e,i):Promise.reject(new Error("No mutationFn found")),onFail:(s,a)=>{this.#n({type:"failed",failureCount:s,error:a})},onPause:()=>{this.#n({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#i.canRun(this)});const n=this.state.status==="pending",r=!this.#r.canStart();try{if(n)t();else{this.#n({type:"pending",variables:e,isPaused:r}),this.#i.config.onMutate&&await this.#i.config.onMutate(e,this,i);const a=await this.options.onMutate?.(e,i);a!==this.state.context&&this.#n({type:"pending",context:a,variables:e,isPaused:r})}const s=await this.#r.start();return await this.#i.config.onSuccess?.(s,e,this.state.context,this,i),await this.options.onSuccess?.(s,e,this.state.context,i),await this.#i.config.onSettled?.(s,null,this.state.variables,this.state.context,this,i),await this.options.onSettled?.(s,null,e,this.state.context,i),this.#n({type:"success",data:s}),s}catch(s){try{await this.#i.config.onError?.(s,e,this.state.context,this,i)}catch(a){Promise.reject(a)}try{await this.options.onError?.(s,e,this.state.context,i)}catch(a){Promise.reject(a)}try{await this.#i.config.onSettled?.(void 0,s,this.state.variables,this.state.context,this,i)}catch(a){Promise.reject(a)}try{await this.options.onSettled?.(void 0,s,e,this.state.context,i)}catch(a){Promise.reject(a)}throw this.#n({type:"error",error:s}),s}finally{this.#i.runNext(this)}}#n(e){const t=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),A.batch(()=>{this.#t.forEach(i=>{i.onMutationUpdate(e)}),this.#i.notify({mutation:this,type:"updated",action:e})})}};function vi(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Mn=class extends ve{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#i=0}#e;#t;#i;build(e,t,i){const n=new Dn({client:e,mutationCache:this,mutationId:++this.#i,options:e.defaultMutationOptions(t),state:i});return this.add(n),n}add(e){this.#e.add(e);const t=We(e);if(typeof t=="string"){const i=this.#t.get(t);i?i.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=We(e);if(typeof t=="string"){const i=this.#t.get(t);if(i)if(i.length>1){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}else i[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=We(e);if(typeof t=="string"){const n=this.#t.get(t)?.find(r=>r.state.status==="pending");return!n||n===e}else return!0}runNext(e){const t=We(e);return typeof t=="string"?this.#t.get(t)?.find(n=>n!==e&&n.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){A.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(i=>ri(t,i))}findAll(e={}){return this.getAll().filter(t=>ri(e,t))}notify(e){A.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return A.batch(()=>Promise.all(e.map(t=>t.continue().catch($))))}};function We(e){return e.options.scope?.id}var An=class extends ve{#e;#t=void 0;#i;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#e.defaultMutationOptions(e),Be(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#i,observer:this}),t?.mutationKey&&this.options.mutationKey&&fe(t.mutationKey)!==fe(this.options.mutationKey)?this.reset():this.#i?.state.status==="pending"&&this.#i.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#i?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#o(e)}getCurrentResult(){return this.#t}reset(){this.#i?.removeObserver(this),this.#i=void 0,this.#n(),this.#o()}mutate(e,t){return this.#r=t,this.#i?.removeObserver(this),this.#i=this.#e.getMutationCache().build(this.#e,this.options),this.#i.addObserver(this),this.#i.execute(e)}#n(){const e=this.#i?.state??vi();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#o(e){A.batch(()=>{if(this.#r&&this.hasListeners()){const t=this.#t.variables,i=this.#t.context,n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#r.onSuccess?.(e.data,t,i,n)}catch(r){Promise.reject(r)}try{this.#r.onSettled?.(e.data,null,t,i,n)}catch(r){Promise.reject(r)}}else if(e?.type==="error"){try{this.#r.onError?.(e.error,t,i,n)}catch(r){Promise.reject(r)}try{this.#r.onSettled?.(void 0,e.error,t,i,n)}catch(r){Promise.reject(r)}}}this.listeners.forEach(t=>{t(this.#t)})})}},Ln=class extends ve{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,i){const n=t.queryKey,r=t.queryHash??ht(n,t);let s=this.get(r);return s||(s=new Pn({client:e,queryKey:n,queryHash:r,options:e.defaultQueryOptions(t),state:i,defaultOptions:e.getQueryDefaults(n)}),this.add(s)),s}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){A.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(i=>ni(t,i))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(i=>ni(e,i)):t}notify(e){A.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){A.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){A.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Hn=class{#e;#t;#i;#r;#n;#o;#a;#s;constructor(e={}){this.#e=e.queryCache||new Ln,this.#t=e.mutationCache||new Mn,this.#i=e.defaultOptions||{},this.#r=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=yt.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=Ne.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),i=this.#e.build(this,t),n=i.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&i.isStaleByTime(ne(t.staleTime,i))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:i})=>{const n=i.data;return[t,n]})}setQueryData(e,t,i){const n=this.defaultQueryOptions({queryKey:e}),s=this.#e.get(n.queryHash)?.state.data,a=yn(t,s);if(a!==void 0)return this.#e.build(this,n).setData(a,{...i,manual:!0})}setQueriesData(e,t,i){return A.batch(()=>this.#e.findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,i)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;A.batch(()=>{t.findAll(e).forEach(i=>{t.remove(i)})})}resetQueries(e,t){const i=this.#e;return A.batch(()=>(i.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const i={revert:!0,...t},n=A.batch(()=>this.#e.findAll(e).map(r=>r.cancel(i)));return Promise.all(n).then($).catch($)}invalidateQueries(e,t={}){return A.batch(()=>(this.#e.findAll(e).forEach(i=>{i.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const i={...t,cancelRefetch:t.cancelRefetch??!0},n=A.batch(()=>this.#e.findAll(e).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let s=r.fetch(void 0,i);return i.throwOnError||(s=s.catch($)),r.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(n).then($)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const i=this.#e.build(this,t);return i.isStaleByTime(ne(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then($).catch($)}fetchInfiniteQuery(e){return e.behavior=yi(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then($).catch($)}ensureInfiniteQueryData(e){return e.behavior=yi(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Ne.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#i}setDefaultOptions(e){this.#i=e}setQueryDefaults(e,t){this.#r.set(fe(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#r.values()],i={};return t.forEach(n=>{Te(e,n.queryKey)&&Object.assign(i,n.defaultOptions)}),i}setMutationDefaults(e,t){this.#n.set(fe(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#n.values()],i={};return t.forEach(n=>{Te(e,n.mutationKey)&&Object.assign(i,n.defaultOptions)}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#i.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=ht(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===mt&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#i.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},pe,R,St,bi,Qe=0,wi=[],D=w,Si=D.__b,xi=D.__r,Ei=D.diffed,Ci=D.__c,ki=D.unmount,Ti=D.__;function Pe(e,t){D.__h&&D.__h(R,e,Qe||t),Qe=0;var i=R.__H||(R.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({}),i.__[e]}function x(e){return Qe=1,zn(Ii,e)}function zn(e,t,i){var n=Pe(pe++,2);if(n.t=e,!n.__c&&(n.__=[i?i(t):Ii(void 0,t),function(l){var u=n.__N?n.__N[0]:n.__[0],d=n.t(u,l);u!==d&&(n.__N=[d,n.__[1]],n.__c.setState({}))}],n.__c=R,!R.__f)){var r=function(l,u,d){if(!n.__c.__H)return!0;var h=n.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!s||s.call(this,l,u,d);var c=n.__c.props!==l;return h.forEach(function(p){if(p.__N){var m=p.__[0];p.__=p.__N,p.__N=void 0,m!==p.__[0]&&(c=!0)}}),s&&s.call(this,l,u,d)||c};R.__f=!0;var s=R.shouldComponentUpdate,a=R.componentWillUpdate;R.componentWillUpdate=function(l,u,d){if(this.__e){var h=s;s=void 0,r(l,u,d),s=h}a&&a.call(this,l,u,d)},R.shouldComponentUpdate=r}return n.__N||n.__}function B(e,t){var i=Pe(pe++,3);!D.__s&&Ct(i.__H,t)&&(i.__=e,i.u=t,R.__H.__h.push(i))}function Un(e,t){var i=Pe(pe++,4);!D.__s&&Ct(i.__H,t)&&(i.__=e,i.u=t,R.__h.push(i))}function $n(e,t){var i=Pe(pe++,7);return Ct(i.__H,t)&&(i.__=e(),i.__H=t,i.__h=e),i.__}function G(e,t){return Qe=8,$n(function(){return e},t)}function xt(e){var t=R.context[e.__c],i=Pe(pe++,9);return i.c=e,t?(i.__==null&&(i.__=!0,t.sub(R)),t.props.value):e.__}function Bn(){for(var e;e=wi.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(je),e.__H.__h.forEach(Et),e.__H.__h=[]}catch(t){e.__H.__h=[],D.__e(t,e.__v)}}D.__b=function(e){R=null,Si&&Si(e)},D.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Ti&&Ti(e,t)},D.__r=function(e){xi&&xi(e),pe=0;var t=(R=e.__c).__H;t&&(St===R?(t.__h=[],R.__h=[],t.__.forEach(function(i){i.__N&&(i.__=i.__N),i.u=i.__N=void 0})):(t.__h.forEach(je),t.__h.forEach(Et),t.__h=[],pe=0)),St=R},D.diffed=function(e){Ei&&Ei(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(wi.push(t)!==1&&bi===D.requestAnimationFrame||((bi=D.requestAnimationFrame)||Nn)(Bn)),t.__H.__.forEach(function(i){i.u&&(i.__H=i.u),i.u=void 0})),St=R=null},D.__c=function(e,t){t.some(function(i){try{i.__h.forEach(je),i.__h=i.__h.filter(function(n){return!n.__||Et(n)})}catch(n){t.some(function(r){r.__h&&(r.__h=[])}),t=[],D.__e(n,i.__v)}}),Ci&&Ci(e,t)},D.unmount=function(e){ki&&ki(e);var t,i=e.__c;i&&i.__H&&(i.__H.__.forEach(function(n){try{je(n)}catch(r){t=r}}),i.__H=void 0,t&&D.__e(t,i.__v))};var Pi=typeof requestAnimationFrame=="function";function Nn(e){var t,i=function(){clearTimeout(n),Pi&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(i,35);Pi&&(t=requestAnimationFrame(i))}function je(e){var t=R,i=e.__c;typeof i=="function"&&(e.__c=void 0,i()),R=t}function Et(e){var t=R;e.__c=e.__(),R=t}function Ct(e,t){return!e||e.length!==t.length||t.some(function(i,n){return i!==e[n]})}function Ii(e,t){return typeof t=="function"?t(e):t}function Wn(e,t){for(var i in t)e[i]=t[i];return e}function Ri(e,t){for(var i in e)if(i!=="__source"&&!(i in t))return!0;for(var n in t)if(n!=="__source"&&e[n]!==t[n])return!0;return!1}function Fi(e,t){var i=t(),n=x({t:{__:i,u:t}}),r=n[0].t,s=n[1];return Un(function(){r.__=i,r.u=t,kt(r)&&s({t:r})},[e,i,t]),B(function(){return kt(r)&&s({t:r}),e(function(){kt(r)&&s({t:r})})},[e]),i}function kt(e){var t,i,n=e.u,r=e.__;try{var s=n();return!((t=r)===(i=s)&&(t!==0||1/t==1/i)||t!=t&&i!=i)}catch{return!0}}function Oi(e,t){this.props=e,this.context=t}(Oi.prototype=new J).isPureReactComponent=!0,Oi.prototype.shouldComponentUpdate=function(e,t){return Ri(this.props,e)||Ri(this.state,t)};var Di=w.__b;w.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),Di&&Di(e)};var Qn=w.__e;w.__e=function(e,t,i,n){if(e.then){for(var r,s=t;s=s.__;)if((r=s.__c)&&r.__c)return t.__e==null&&(t.__e=i.__e,t.__k=i.__k),r.__c(e,t)}Qn(e,t,i,n)};var Mi=w.unmount;function Ai(e,t,i){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),e.__c.__H=null),(e=Wn({},e)).__c!=null&&(e.__c.__P===i&&(e.__c.__P=t),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(n){return Ai(n,t,i)})),e}function Li(e,t,i){return e&&i&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(n){return Li(n,t,i)}),e.__c&&e.__c.__P===t&&(e.__e&&i.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=i)),e}function Tt(){this.__u=0,this.o=null,this.__b=null}function Hi(e){if(!e.__)return null;var t=e.__.__c;return t&&t.__a&&t.__a(e)}function Ge(){this.i=null,this.l=null}w.unmount=function(e){var t=e.__c;t&&(t.__z=!0),t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),Mi&&Mi(e)},(Tt.prototype=new J).__c=function(e,t){var i=t.__c,n=this;n.o==null&&(n.o=[]),n.o.push(i);var r=Hi(n.__v),s=!1,a=function(){s||n.__z||(s=!0,i.__R=null,r?r(u):u())};i.__R=a;var l=i.__P;i.__P=null;var u=function(){if(!--n.__u){if(n.state.__a){var d=n.state.__a;n.__v.__k[0]=Li(d,d.__c.__P,d.__c.__O)}var h;for(n.setState({__a:n.__b=null});h=n.o.pop();)h.__P=l,h.forceUpdate()}};n.__u++||32&t.__u||n.setState({__a:n.__b=n.__v.__k[0]}),e.then(a,a)},Tt.prototype.componentWillUnmount=function(){this.o=[]},Tt.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var i=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Ai(this.__b,i,n.__O=n.__P)}this.__b=null}var r=t.__a&&st(V,null,e.fallback);return r&&(r.__u&=-33),[st(V,null,t.__a?null:e.children),r]};var zi=function(e,t,i){if(++i[1]===i[0]&&e.l.delete(t),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(i=e.i;i;){for(;i.length>3;)i.pop()();if(i[1]<i[0])break;e.i=i=i[2]}};(Ge.prototype=new J).__a=function(e){var t=this,i=Hi(t.__v),n=t.l.get(e);return n[0]++,function(r){var s=function(){t.props.revealOrder?(n.push(r),zi(t,e,n)):r()};i?i(s):s()}},Ge.prototype.render=function(e){this.i=null,this.l=new Map;var t=Ue(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&t.reverse();for(var i=t.length;i--;)this.l.set(t[i],this.i=[1,0,this.i]);return e.children},Ge.prototype.componentDidUpdate=Ge.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(t,i){zi(e,i,t)})};var jn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Gn=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Kn=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,qn=/[A-Z0-9]/g,Vn=typeof document<"u",Yn=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};J.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(J.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})});var Ui=w.event;function Xn(){}function Jn(){return this.cancelBubble}function Zn(){return this.defaultPrevented}w.event=function(e){return Ui&&(e=Ui(e)),e.persist=Xn,e.isPropagationStopped=Jn,e.isDefaultPrevented=Zn,e.nativeEvent=e};var er={enumerable:!1,configurable:!0,get:function(){return this.class}},$i=w.vnode;w.vnode=function(e){typeof e.type=="string"&&(function(t){var i=t.props,n=t.type,r={},s=n.indexOf("-")===-1;for(var a in i){var l=i[a];if(!(a==="value"&&"defaultValue"in i&&l==null||Vn&&a==="children"&&n==="noscript"||a==="class"||a==="className")){var u=a.toLowerCase();a==="defaultValue"&&"value"in i&&i.value==null?a="value":a==="download"&&l===!0?l="":u==="translate"&&l==="no"?l=!1:u[0]==="o"&&u[1]==="n"?u==="ondoubleclick"?a="ondblclick":u!=="onchange"||n!=="input"&&n!=="textarea"||Yn(i.type)?u==="onfocus"?a="onfocusin":u==="onblur"?a="onfocusout":Kn.test(a)&&(a=u):u=a="oninput":s&&Gn.test(a)?a=a.replace(qn,"-$&").toLowerCase():l===null&&(l=void 0),u==="oninput"&&r[a=u]&&(a="oninputCapture"),r[a]=l}}n=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Ue(i.children).forEach(function(d){d.props.selected=r.value.indexOf(d.props.value)!=-1})),n=="select"&&r.defaultValue!=null&&(r.value=Ue(i.children).forEach(function(d){d.props.selected=r.multiple?r.defaultValue.indexOf(d.props.value)!=-1:r.defaultValue==d.props.value})),i.class&&!i.className?(r.class=i.class,Object.defineProperty(r,"className",er)):(i.className&&!i.class||i.class&&i.className)&&(r.class=r.className=i.className),t.props=r})(e),e.$$typeof=jn,$i&&$i(e)};var Bi=w.__r;w.__r=function(e){Bi&&Bi(e),e.__c};var Ni=w.diffed;w.diffed=function(e){Ni&&Ni(e);var t=e.props,i=e.__e;i!=null&&e.type==="textarea"&&"value"in t&&t.value!==i.value&&(i.value=t.value==null?"":t.value)};var Wi=dt(void 0),Ke=e=>{const t=xt(Wi);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},tr=({client:e,children:t})=>(B(()=>(e.mount(),()=>{e.unmount()}),[e]),o(Wi.Provider,{value:e,children:t})),Qi=dt(!1),ir=()=>xt(Qi);Qi.Provider;function nr(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var rr=dt(nr()),sr=()=>xt(rr),or=(e,t,i)=>{const n=i?.state.error&&typeof e.throwOnError=="function"?gt(e.throwOnError,[i.state.error,i]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||n)&&(t.isReset()||(e.retryOnMount=!1))},ar=e=>{B(()=>{e.clearReset()},[e])},lr=({result:e,errorResetBoundary:t,throwOnError:i,query:n,suspense:r})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(r&&e.data===void 0||gt(i,[e.error,n])),cr=e=>{if(e.suspense){const i=r=>r==="static"?r:Math.max(r??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...r)=>i(n(...r)):i(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},dr=(e,t)=>e.isLoading&&e.isFetching&&!t,ur=(e,t)=>e?.suspense&&t.isPending,ji=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});function hr(e,t,i){const n=ir(),r=sr(),s=Ke(),a=s.defaultQueryOptions(e);s.getDefaultOptions().queries?._experimental_beforeQuery?.(a);const l=s.getQueryCache().get(a.queryHash);a._optimisticResults=n?"isRestoring":"optimistic",cr(a),or(a,r,l),ar(r);const u=!s.getQueryCache().get(a.queryHash),[d]=x(()=>new t(s,a)),h=d.getOptimisticResult(a),c=!n&&e.subscribed!==!1;if(Fi(G(p=>{const m=c?d.subscribe(A.batchCalls(p)):$;return d.updateResult(),m},[d,c]),()=>d.getCurrentResult()),B(()=>{d.setOptions(a)},[a,d]),ur(a,h))throw ji(a,d,r);if(lr({result:h,errorResetBoundary:r,throwOnError:a.throwOnError,query:l,suspense:a.suspense}))throw h.error;return s.getDefaultOptions().queries?._experimental_afterQuery?.(a,h),a.experimental_prefetchInRender&&!he&&dr(h,n)&&(u?ji(a,d,r):l?.promise)?.catch($).finally(()=>{d.updateResult()}),a.notifyOnChangeProps?h:d.trackResult(h)}function Pt(e,t){return hr(e,In)}function be(e,t){const i=Ke(),[n]=x(()=>new An(i,e));B(()=>{n.setOptions(e)},[n,e]);const r=Fi(G(a=>n.subscribe(A.batchCalls(a)),[n]),()=>n.getCurrentResult()),s=G((a,l)=>{n.mutate(a,l).catch($)},[n]);if(r.error&&gt(n.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:s,mutateAsync:r.mutate}}const Y="'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif",f={root:{display:"flex",flexDirection:"column",gap:"1.5rem",maxWidth:"100%",minHeight:"100%",fontFamily:Y},header:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"1rem",borderBottom:"1px solid rgba(226,232,240,0.8)"},headerTitle:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",letterSpacing:"-0.025em",fontFamily:Y},closeBtn:{width:"2.25rem",height:"2.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"0.75rem",color:"#94a3b8",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s"},emptyState:{textAlign:"center",padding:"3rem 1.5rem",background:"linear-gradient(to bottom right, #f8fafc, rgba(239,246,255,0.5))",border:"2px dashed #e2e8f0",borderRadius:"1rem"},emptyStateIcon:{width:"4rem",height:"4rem",margin:"0 auto 1rem",borderRadius:"1rem",background:"linear-gradient(to bottom right, #dbeafe, #bfdbfe)",display:"flex",alignItems:"center",justifyContent:"center"},emptyStateText:{color:"#475569",fontSize:"0.875rem",marginBottom:"1.25rem",lineHeight:1.625},primaryBtn:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",borderRadius:"0.75rem",fontSize:"0.875rem",fontWeight:600,color:"#fff",background:"linear-gradient(to right, #3b82f6, #2563eb)",border:"none",cursor:"pointer",transition:"all 0.2s"},secondaryBtn:{flex:1,padding:"0.75rem 1.25rem",borderRadius:"0.75rem",fontSize:"0.875rem",fontWeight:600,background:"#f1f5f9",color:"#334155",border:"1px solid #e2e8f0",cursor:"pointer",transition:"all 0.2s"},section:{display:"flex",flexDirection:"column",gap:"0.5rem"},label:{fontSize:"0.875rem",fontWeight:600,color:"#475569",fontFamily:Y},selectorBox:{padding:"0.625rem 1rem",background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontFamily:"ui-monospace, monospace",fontSize:"0.75rem",color:"#334155",wordBreak:"break-all"},elementInfo:{padding:"1rem",background:"rgba(239,246,255,0.9)",border:"1px solid #bfdbfe",borderRadius:"0.75rem"},elementInfoTitle:{display:"block",marginBottom:"0.5rem",fontSize:"0.75rem",fontWeight:700,color:"#1d4ed8",textTransform:"uppercase",letterSpacing:"0.05em"},elementInfoText:{fontSize:"0.875rem",color:"rgba(29,78,216,0.9)"},textarea:{width:"100%",padding:"0.75rem 1rem",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontSize:"0.875rem",color:"#0f172a",background:"#fff",minHeight:"100px",lineHeight:1.625,resize:"vertical",fontFamily:Y},input:{width:"100%",padding:"0.75rem 1rem",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontSize:"0.875rem",color:"#0f172a",background:"#fff",fontFamily:Y},placementGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.5rem"},placementBtn:e=>({padding:"0.75rem 1rem",borderRadius:"0.75rem",fontSize:"0.875rem",fontWeight:500,cursor:"pointer",transition:"all 0.2s",...e?{background:"#3b82f6",color:"#fff",border:"none"}:{background:"#fff",color:"#475569",border:"1px solid #e2e8f0"}}),errorBox:{padding:"0.75rem 1rem",background:"#fef2f2",border:"1px solid #fee2e2",borderRadius:"0.75rem",color:"#b91c1c",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.5rem"},actionRow:{display:"flex",gap:"0.75rem",paddingTop:"1rem",marginTop:"0.5rem",borderTop:"1px solid rgba(226,232,240,0.8)"},panel:{display:"flex",flexDirection:"column",minHeight:"100%",background:"#fff"},panelHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",borderBottom:"1px solid rgba(226,232,240,0.8)",background:"rgba(248,250,252,0.5)"},panelBody:{flex:1,padding:"1.5rem",overflowY:"auto"},iconBtn:{width:"2.25rem",height:"2.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"0.75rem",color:"#94a3b8",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s"},card:{background:"#fff",borderRadius:"1rem",padding:"1.25rem",border:"1px solid rgba(226,232,240,0.8)",transition:"all 0.2s"},badge:{display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:700,padding:"0.125rem 0.625rem",flexShrink:0},sectionLabel:{fontSize:"11px",fontWeight:700,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.1em",marginBottom:"0.75rem"},tabRow:{display:"flex",gap:0,borderBottom:"1px solid rgba(226,232,240,0.8)",padding:"0 1.5rem",background:"#fff"},tab:e=>({padding:"1rem 1.25rem",fontSize:"0.875rem",fontWeight:e?600:500,color:e?"#2563eb":"#64748b",cursor:"pointer",position:"relative",background:"none",border:"none",fontFamily:Y,borderBottom:e?"2px solid #3b82f6":"2px solid transparent"}),heatmapRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.25rem 0",borderTop:"1px solid rgba(226,232,240,0.8)",marginTop:"1.5rem"},toggle:e=>({position:"relative",width:"3rem",height:"1.75rem",borderRadius:"9999px",cursor:"pointer",transition:"all 0.2s",background:e?"#10b981":"#cbd5e1",border:"none"}),toggleThumb:e=>({position:"absolute",top:"0.25rem",left:e?"1.5rem":"0.25rem",width:"1.25rem",height:"1.25rem",background:"#fff",borderRadius:"9999px",transition:"all 0.2s"}),link:{display:"inline-flex",alignItems:"center",gap:"0.375rem",color:"#2563eb",fontSize:"0.875rem",fontWeight:500,textDecoration:"none",cursor:"pointer",background:"none",border:"none",fontFamily:Y},footer:{display:"flex",gap:"0.75rem",padding:"1rem 1.5rem",borderTop:"1px solid rgba(226,232,240,0.8)",background:"rgba(248,250,252,0.5)",marginTop:"auto"},radioLabel:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.75rem",borderRadius:"0.75rem",border:"1px solid #e2e8f0",transition:"all 0.2s"},searchWrap:{position:"relative",marginBottom:"1rem"},searchIcon:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",color:"#94a3b8",fontSize:"1rem"},searchInput:{width:"100%",padding:"0.75rem 1rem 0.75rem 2.75rem",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontSize:"0.875rem",color:"#0f172a",background:"#fff",fontFamily:Y},pageItem:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1.25rem",background:"#fff",borderRadius:"1rem",border:"1px solid rgba(226,232,240,0.8)",marginBottom:"0.5rem",transition:"all 0.2s"},iconBtnSm:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"0.5rem",color:"#94a3b8",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s"},comingSoon:{padding:"2rem 0",textAlign:"center"},comingSoonIcon:{width:"4rem",height:"4rem",margin:"0 auto 1rem",borderRadius:"1rem",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center"}},fr=`
* { font-family: ${Y}; }
iconify-icon { display: inline-block; width: 1em; height: 1em; vertical-align: -0.125em; }
@keyframes editor-spin { to { transform: rotate(360deg); } }
.editor-spinner { display: inline-block; animation: editor-spin 0.8s linear infinite; }
`;function T({variant:e,children:t,onClick:i,type:n="button",title:r,active:s=!1,style:a,class:l,disabled:u,"aria-label":d}){const h=e==="primary"?f.primaryBtn:e==="secondary"?f.secondaryBtn:e==="icon"?f.iconBtn:e==="iconSm"?f.iconBtnSm:e==="placement"?f.placementBtn(s):{background:"none",border:"none",color:"#94a3b8",fontSize:"0.75rem",cursor:"pointer",padding:"0.25rem",fontFamily:Y},c=a?{...h,...a}:h;return o("button",{type:n,style:c,class:l,onClick:i,title:r,disabled:u,"aria-label":d,children:t})}function Ie({type:e="text",value:t,onInput:i,placeholder:n,id:r,style:s,disabled:a,"aria-label":l}){const u=s?{...f.input,...s}:f.input;return o("input",{type:e,value:t,onInput:i,placeholder:n,id:r,style:u,disabled:a,"aria-label":l})}function It({value:e,onInput:t,placeholder:i,id:n,minHeight:r,style:s,disabled:a,"aria-label":l}){const u=s?{...f.textarea,...s,...r!=null&&{minHeight:typeof r=="number"?`${r}px`:r}}:r!=null?{...f.textarea,minHeight:typeof r=="number"?`${r}px`:r}:f.textarea;return o("textarea",{value:e,onInput:t,placeholder:i,id:n,style:u,disabled:a,"aria-label":l})}const pr=["top","right","bottom","left"];function mr({onMessage:e,elementSelected:t}){const[i,n]=x(""),[r,s]=x(null),[a,l]=x(""),[u,d]=x("right"),[h,c]=x(""),[p,m]=x(!1);B(()=>{e({type:"EDITOR_READY"})},[]),B(()=>{t?(n(t.selector),s(t.elementInfo),m(!0),l(""),c("")):(n(""),s(null),m(!1),l(""),c(""))},[t]);const v=()=>{const g=a.trim();if(!g){c("Please enter guide content");return}if(!i){c("No element selected");return}c(""),e({type:"SAVE_GUIDE",guide:{page:Ae(),selector:i,content:g,placement:u,status:"active"}})},b=()=>{n(""),s(null),m(!1),l(""),c(""),e({type:"CLEAR_SELECTION_CLICKED"})},S=g=>{const _=[];return g.tagName&&_.push(`Tag: ${g.tagName}`),g.id&&_.push(`ID: ${g.id}`),g.className&&_.push(`Class: ${g.className}`),g.textContent&&_.push(`Text: ${g.textContent}`),_.join(" | ")};return o("div",{style:f.root,children:[o("div",{style:f.header,children:[o("h2",{style:f.headerTitle,children:"Create Guide"}),o(T,{variant:"icon",onClick:()=>e({type:"CANCEL"}),"aria-label":"Close",children:o("iconify-icon",{icon:"mdi:close",style:{fontSize:"1.25rem"}})})]}),p?o("div",{style:{display:"flex",flexDirection:"column",gap:"1.25rem"},children:[o("div",{style:f.section,children:[o("label",{style:f.label,children:"Selector"}),o("div",{style:f.selectorBox,children:i||"-"})]}),r&&o("div",{style:f.elementInfo,children:[o("strong",{style:f.elementInfoTitle,children:"Element Info"}),o("div",{style:f.elementInfoText,children:S(r)})]}),o("div",{style:f.section,children:[o("label",{for:"guideContent",style:f.label,children:"Guide Content"}),o(It,{id:"guideContent",placeholder:"Enter the guide text that will be shown to users...",value:a,onInput:g=>l(g.target.value)})]}),o("div",{style:f.section,children:[o("label",{style:f.label,children:"Placement"}),o("div",{style:f.placementGrid,children:pr.map(g=>o(T,{variant:"placement",active:u===g,onClick:()=>d(g),children:g.charAt(0).toUpperCase()+g.slice(1)},g))})]}),h&&o("div",{style:f.errorBox,children:[o("iconify-icon",{icon:"mdi:alert-circle"}),h]}),o("div",{style:f.actionRow,children:[o(T,{variant:"secondary",onClick:()=>e({type:"CANCEL"}),children:"Cancel"}),o(T,{variant:"secondary",onClick:b,children:"Clear Selection"}),o(T,{variant:"primary",style:{flex:1},onClick:v,children:"Save Guide"})]})]}):o("div",{style:f.emptyState,children:[o("div",{style:f.emptyStateIcon,children:o("iconify-icon",{icon:"mdi:cursor-default-click",style:{fontSize:"1.875rem",color:"#3b82f6"}})}),o("p",{style:f.emptyStateText,children:"Click on an element in the page to create a guide"}),o(T,{variant:"primary",onClick:()=>e({type:"ACTIVATE_SELECTOR"}),children:[o("iconify-icon",{icon:"mdi:selection-marker"}),"Select element"]})]})]})}const gr="https://devgw.revgain.ai/rg-pex",Gi="designerIud";function yr(){if(typeof window>"u")return null;try{return localStorage.getItem(Gi)}catch{return null}}function qe(e){const t={"Content-Type":"application/json",...e},i=yr();return i&&(t.iud=i),t}const K={baseUrl:gr,async get(e,t){const i=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,n=await fetch(i,{...t,headers:{...qe(),...t?.headers}});if(!n.ok)throw new Error(`API error: ${n.status} ${n.statusText}`);return n.json()},async post(e,t,i){const n=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,r=await fetch(n,{method:"POST",...i,headers:{...qe(),...i?.headers},body:t!==void 0?JSON.stringify(t):void 0});if(!r.ok)throw new Error(`API error: ${r.status} ${r.statusText}`);return r.json()},async put(e,t,i){const n=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,r=await fetch(n,{method:"PUT",...i,headers:{...qe(),...i?.headers},body:t!==void 0?JSON.stringify(t):void 0});if(!r.ok)throw new Error(`API error: ${r.status} ${r.statusText}`);return r.json()},async delete(e,t){const i=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,n=await fetch(i,{method:"DELETE",...t,headers:{...qe(),...t?.headers}});if(!n.ok)throw new Error(`API error: ${n.status} ${n.statusText}`);return n.json()}},_r=["pages","create"];async function vr(e){return K.post("/pages",{name:e.name,slug:e.slug,description:e.description,status:"active"})}function br(){return be({mutationKey:_r,mutationFn:vr})}const wr=["pages","update"];async function Sr({pageId:e,payload:t}){return K.put(`/pages/${e}`,{name:t.name,slug:t.slug,description:t.description,status:t.status??"active"})}function xr(){return be({mutationKey:wr,mutationFn:Sr})}const Er=["pages","delete"];async function Cr(e){return K.delete(`/pages/${e}`)}function kr(){return be({mutationKey:Er,mutationFn:Cr})}const Tr=e=>["pages","check-slug",e];async function Pr(e){return K.get(`/pages/check-slug?slug=${encodeURIComponent(e)}`)}function Ir(e){return Pt({queryKey:Tr(e),queryFn:()=>Pr(e),enabled:!!e,retry:0})}const Rr=["pages","list"];async function Fr(){return K.get("/pages")}function Or(){return Pt({queryKey:Rr,queryFn:Fr,retry:0})}const Dr="designerTaggedPages",Ve=["pages","check-slug"],Rt=["pages","list"];function Ye(){try{const t=(typeof window<"u"&&window.parent!==window?window.parent:window).location;return(t.host||t.hostname||"")+(t.pathname||"/")+(t.search||"")+(t.hash||"")}catch{return typeof window<"u"&&window.parent!==window?window.parent.location.href:window.location.href||""}}function Xe(){try{const t=(typeof window<"u"&&window.parent!==window?window.parent:window).location,i=(t.pathname||"/").replace(/^\//,""),n=t.search||"",r=t.hash||"";return"//*/"+i+n+r}catch{return"//*/"}}function Mr({onMessage:e}){const[t,i]=x("overviewUntagged"),[n,r]=x(""),[s,a]=x(""),[l,u]=x(""),[d,h]=x(!1),[c,p]=x("create"),[m,v]=x(""),[b,S]=x(""),[g,_]=x("suggested"),[I,F]=x(""),[U,L]=x(!1),[O,k]=x(null),[M,N]=x(!1),P=Ke(),H=br(),j=xr(),Fe=kr(),{data:re,isLoading:Mt,isError:Oe}=Ir(n),{data:De,isLoading:me}=Or(),ee=!!n&&Mt,we=H.isPending||j.isPending,Je=(n||"").trim().toLowerCase(),Se=(De?.data??[]).filter(C=>(C.slug||"").trim().toLowerCase()===Je).filter(C=>(C.name||"").toLowerCase().includes(l.toLowerCase().trim())),se=G(()=>{i("overviewUntagged"),a(Ye()||"(current page)"),h(!1),P.invalidateQueries({queryKey:Ve})},[P]),Ze=G(()=>{i("taggedPagesDetailView"),u("")},[]),xe=G(()=>{k(null),i("tagPageFormView"),h(!0),F(Xe()),v(""),S(""),p("create"),_("suggested"),L(!1)},[]),Lt=G(C=>{k(C.page_id),i("tagPageFormView"),h(!0),F(C.slug||Xe()),v(C.name||""),S(C.description||""),p("create"),_("suggested"),L(!1)},[]);B(()=>{e({type:"EDITOR_READY"})},[]),B(()=>{r(Xe()),a(Ye()||"(current page)")},[]),B(()=>{if(!n){i("overviewUntagged");return}if(Oe){(t==="overviewTagged"||t==="overviewUntagged")&&i("overviewUntagged");return}re!==void 0&&(t==="overviewTagged"||t==="overviewUntagged")&&i(re.exists?"overviewTagged":"overviewUntagged")},[n,re,Oe,t]),B(()=>{let C=Ye();const oe=()=>{const le=Ye();le!==C&&(C=le,r(Xe()),a(le||"(current page)"),i("overviewUntagged"))},ae=()=>oe(),Ee=()=>oe();window.addEventListener("hashchange",ae),window.addEventListener("popstate",Ee);const Me=setInterval(oe,1500);return()=>{window.removeEventListener("hashchange",ae),window.removeEventListener("popstate",Ee),clearInterval(Me)}},[]);const et=async()=>{const C=m.trim();if(!C){L(!0);return}L(!1);const oe=typeof window<"u"&&window.parent!==window?window.parent.location.pathname:window.location.pathname,ae=I.trim()||oe||"/";try{if(O)await j.mutateAsync({pageId:O,payload:{name:C,slug:ae,description:b.trim()||void 0,status:"active"}}),k(null),P.invalidateQueries({queryKey:Ve}),P.invalidateQueries({queryKey:Rt}),se();else{const Ee=typeof window<"u"&&window.parent!==window?window.parent.location.href:window.location.href,Me=I.trim()||Ee;await H.mutateAsync({name:C,slug:ae,description:b.trim()||void 0});const le=Dr,Ht=localStorage.getItem(le)||"[]",y=JSON.parse(Ht);y.push({pageName:C,url:Me}),localStorage.setItem(le,JSON.stringify(y)),P.invalidateQueries({queryKey:Ve}),P.invalidateQueries({queryKey:Rt}),i("overviewTagged"),h(!1)}}catch{}},te=async C=>{if(window.confirm("Delete this page?"))try{await Fe.mutateAsync(C),P.invalidateQueries({queryKey:Ve}),P.invalidateQueries({queryKey:Rt})}catch{}},ge={display:"flex",flexDirection:"column",flex:1,gap:"1rem"};return M?o("div",{style:{...f.panel,padding:"0.5rem"},children:o("div",{style:f.panelHeader,children:[o("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:"Tag Page"}),o("div",{style:{display:"flex",gap:"0.25rem"},children:o(T,{variant:"icon",title:"Expand",onClick:()=>N(!1),children:o("iconify-icon",{icon:"mdi:plus",style:{fontSize:"1.25rem",color:"#64748b"}})})})]})}):o("div",{style:f.panel,children:[o("div",{style:f.panelHeader,children:[o("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:"Tag Page"}),o("div",{style:{display:"flex",gap:"0.25rem"},children:o(T,{variant:"icon",title:"Minimize",onClick:()=>N(!0),children:o("iconify-icon",{icon:"mdi:window-minimize",style:{fontSize:"1.125rem"}})})})]}),o("div",{style:f.panelBody,children:[ee&&(t==="overviewTagged"||t==="overviewUntagged")&&o("div",{style:{...ge,alignItems:"center",justifyContent:"center",padding:"2rem",color:"#64748b",fontSize:"0.875rem"},children:[o("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.5rem",marginBottom:"0.5rem"}}),o("span",{children:"Checking page"})]}),!ee&&t==="overviewTagged"&&o("div",{style:ge,children:[o("div",{style:f.sectionLabel,children:"PAGES OVERVIEW"}),o("div",{style:{...f.card,marginBottom:"1rem",cursor:"pointer"},onClick:Ze,children:o("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,minWidth:0},children:[o("div",{style:{display:"flex",gap:"1rem",flex:1,minWidth:0},children:[o("span",{style:{...f.badge,background:"#10b981",color:"#fff"},children:"Tagged"}),o("div",{style:{minWidth:0},children:[o("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1e293b"},children:"Current URL"}),o("div",{style:{fontSize:"0.875rem",color:"#64748b",marginTop:"0.125rem",wordBreak:"break-all"},children:s})]})]}),o("iconify-icon",{icon:"mdi:chevron-right",style:{color:"#94a3b8",fontSize:"1.25rem",flexShrink:0}})]})}),o(T,{variant:"primary",style:{width:"100%"},onClick:xe,children:"Tag Page"})]}),t==="taggedPagesDetailView"&&o("div",{style:ge,children:[o("a",{href:"#",style:f.link,onClick:C=>{C.preventDefault(),se()},children:[o("iconify-icon",{icon:"mdi:arrow-left"})," Back to overview"]}),o("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[o("span",{style:{...f.badge,background:"#3b82f6",color:"#fff",minWidth:"1.5rem",height:"1.5rem"},children:me?"":Se.length}),o("h3",{style:{fontSize:"1rem",fontWeight:700,color:"#1e293b"},children:"Current URL"})]}),o("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1rem"},children:"List of tagged Pages on this URL"}),o("div",{style:f.searchWrap,children:[o("iconify-icon",{icon:"mdi:magnify",style:f.searchIcon}),o(Ie,{type:"text",placeholder:"Search Pages",value:l,onInput:C=>u(C.target.value),style:f.searchInput}),l&&o(T,{variant:"ghost",style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)"},onClick:()=>u(""),children:"Clear"})]}),me?o("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1.5rem",color:"#64748b",fontSize:"0.875rem"},children:[o("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.25rem",marginRight:"0.5rem"}}),o("span",{children:"Loading pages"})]}):Se.map(C=>o("div",{style:{...f.pageItem,marginBottom:"0.5rem",alignItems:"center"},children:[o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#1e293b",flex:1},children:C.name||"Unnamed"}),o("div",{style:{display:"flex",gap:"0.25rem"},children:[o(T,{variant:"iconSm",title:"Edit",onClick:()=>Lt(C),children:o("iconify-icon",{icon:"mdi:pencil"})}),o(T,{variant:"iconSm",title:"Delete",onClick:()=>te(C.page_id),children:o("iconify-icon",{icon:"mdi:delete-outline"})})]})]},C.page_id)),o(T,{variant:"primary",style:{width:"100%",marginTop:"1rem"},onClick:xe,children:"Tag Page"})]}),!ee&&t==="overviewUntagged"&&o("div",{style:{...ge,textAlign:"center",padding:"2.5rem 1.5rem"},children:[o("div",{style:{...f.emptyStateIcon,width:"6rem",height:"6rem",marginBottom:"1.5rem",background:"linear-gradient(to bottom right, #dbeafe, #bfdbfe, #93c5fd)"},children:o("iconify-icon",{icon:"mdi:tag-plus",style:{fontSize:"3rem",color:"#3b82f6"}})}),o("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",marginBottom:"0.5rem"},children:"Let's start tagging!"}),o("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"2rem",lineHeight:1.625,maxWidth:"20rem",margin:"0 auto 2rem"},children:"Start by first tagging this page and then features to get going."}),o(T,{variant:"primary",style:{width:"100%",maxWidth:"20rem",margin:"0 auto"},onClick:xe,children:"Tag Page"})]}),t==="tagPageFormView"&&o("div",{style:{...ge,gap:"1.5rem"},children:[o("a",{href:"#",style:f.link,onClick:C=>{C.preventDefault(),k(null),se(),h(!1)},children:[o("iconify-icon",{icon:"mdi:arrow-left"})," Back"]}),o("div",{children:[o("div",{style:f.sectionLabel,children:O?"EDIT PAGE":"PAGE SETUP"}),!O&&o("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"pageSetup",value:"create",checked:c==="create",onChange:()=>p("create"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Create New Page"})]}),o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"pageSetup",value:"merge",checked:c==="merge",onChange:()=>p("merge"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Merge with Existing"})]})]}),o("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:[o("div",{children:[o("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:["Page Name ",o("span",{style:{color:"#ef4444"},children:"*"})]}),o(Ie,{type:"text",placeholder:"Enter page name",value:m,onInput:C=>v(C.target.value)}),U&&o("p",{style:{fontSize:"0.875rem",color:"#dc2626",marginTop:"0.375rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[o("iconify-icon",{icon:"mdi:alert-circle"})," Please enter a page name."]})]}),o("div",{children:[o("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:"Description"}),o(It,{placeholder:"Click to add description",value:b,onInput:C=>S(C.target.value),minHeight:"5rem"})]})]})]}),o("div",{children:[o("div",{style:{...f.sectionLabel,display:"flex",alignItems:"center",gap:"0.25rem"},children:["INCLUDE PAGE RULES",o("span",{style:{color:"#94a3b8"},title:"Define how this page is identified",children:o("iconify-icon",{icon:"mdi:information-outline"})})]}),o("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[o("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"#334155"},children:"Include Rule 1"}),o(T,{variant:"iconSm",children:o("iconify-icon",{icon:"mdi:delete-outline"})})]}),o("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"ruleType",value:"suggested",checked:g==="suggested",onChange:()=>_("suggested"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Suggested Match"})]}),o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"ruleType",value:"exact",checked:g==="exact",onChange:()=>_("exact"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Exact Match"})]}),o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"ruleType",value:"builder",checked:g==="builder",onChange:()=>_("builder"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Rule Builder"})]})]}),o("div",{children:[o("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:"Selection URL"}),o(Ie,{type:"text",placeholder:"e.g. //*/path/to/page",value:I,onInput:C=>F(C.target.value)})]})]})]})]}),d&&o("div",{style:f.footer,children:[o(T,{variant:"secondary",onClick:()=>{k(null),se()},disabled:we,children:"Cancel"}),o(T,{variant:"primary",style:{flex:1},onClick:et,disabled:we,children:we?o(V,{children:[o("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.125rem",marginRight:"0.375rem"}}),O?"Updating":"Saving"]}):O?"Update":"Save"})]})]})}const Ar=["features","create"];async function Lr(e){return K.post("/features",e)}function Hr(){return be({mutationKey:Ar,mutationFn:Lr})}const zr=["features","update"];async function Ur({featureId:e,payload:t}){return K.put(`/features/${e}`,t)}function $r(){return be({mutationKey:zr,mutationFn:Ur})}const Br=["features","delete"];async function Nr(e){return K.delete(`/features/${e}`)}function Wr(){return be({mutationKey:Br,mutationFn:Nr})}const Re=["features","list"];async function Qr(){const e=await K.get("/features");return Array.isArray(e)?{data:e}:e}function jr(){return Pt({queryKey:Re,queryFn:Qr,retry:0})}const Ki="designerHeatmapEnabled";function Gr({onMessage:e,elementSelected:t}){const[i,n]=x("overview"),[r,s]=x(!1),[a,l]=x(""),[u,d]=x(null),[h,c]=x(""),[p,m]=x(!1),[v,b]=x(!1),[S,g]=x(!1),[_,I]=x(!1),[F,U]=x(!1),[L,O]=x("create"),[k,M]=x("suggested"),[N,P]=x(""),[H,j]=x(""),[Fe,re]=x(null),[Mt,Oe]=x(null),[De,me]=x(""),ee=Ke(),we=Hr(),Je=$r(),At=Wr(),{data:Se,isLoading:se}=jr(),Ze=we.isPending||Je.isPending||At.isPending,xe=Se?.data??[],Lt=xe.length,et=xe.filter(y=>(y.name||"").toLowerCase().includes(De.toLowerCase().trim())).sort((y,W)=>(y.name||"").localeCompare(W.name||"",void 0,{sensitivity:"base"})),te=G(()=>{n("overview"),s(!1),l(""),d(null),j(""),c(""),m(!1),re(null),me(""),ee.invalidateQueries({queryKey:Re})},[ee]),ge=G(()=>{n("taggedList"),me("")},[]),C=G(y=>y.rules?.find(ce=>ce.selector_type==="xpath"&&(ce.selector_value??"").trim()!=="")?.selector_value??"",[]),oe=G(y=>{n("form"),s(!0),y?(re(y.feature_id),c(y.name||""),P(y.description||""),j(C(y)),M("exact")):(re(null),c(""),P(""),j(t?.xpath||""),l(t?.selector||""),d(t?.elementInfo||null)),m(!1)},[t,C]);B(()=>{e({type:"EDITOR_READY"})},[]),B(()=>{e({type:"FEATURES_FOR_HEATMAP",features:Se?.data??[]})},[Se,e]),B(()=>{const y=localStorage.getItem(Ki)==="true";b(y)},[]),B(()=>{t?(l(t.selector),d(t.elementInfo),j(t.xpath||""),s(!0),n("form"),c(""),m(!1),O("create"),P(""),M("exact")):te()},[t]);const ae=()=>{const y=!v;b(y);try{localStorage.setItem(Ki,String(y))}catch{}e({type:"HEATMAP_TOGGLE",enabled:y})},Ee=y=>y.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),Me=async()=>{const y=h.trim();if(!y){m(!0);return}m(!1);const W=H||t?.xpath||"";if(k==="exact"){if(!W)return;const ce={name:y,slug:Ee(y),description:N.trim()||"",status:"active",rules:[{selector_type:"xpath",selector_value:W,match_mode:"exact",priority:10,is_active:!0}]};try{Fe?(await Je.mutateAsync({featureId:Fe,payload:ce}),ee.invalidateQueries({queryKey:Re}),te()):(await we.mutateAsync(ce),ee.invalidateQueries({queryKey:Re}),te())}catch{}return}},le=async y=>{if(window.confirm("Delete this feature?")){Oe(y);try{await At.mutateAsync(y),ee.invalidateQueries({queryKey:Re}),Fe===y&&(re(null),te())}catch{}finally{Oe(null)}}},Ht=y=>{const W=[];y.tagName&&W.push(`Tag: ${y.tagName}`),y.id&&W.push(`ID: ${y.id}`),y.className&&W.push(`Class: ${y.className}`);const ce=(y.textContent||"").slice(0,80);return ce&&W.push(`Text: ${ce}`),W.join(" | ")};return S?o("div",{style:{...f.panel,padding:"0.5rem"},children:o("div",{style:f.panelHeader,children:[o("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:r?"Tag Feature":"Tag Features"}),o("div",{style:{display:"flex",gap:"0.25rem"},children:o(T,{variant:"icon",title:"Expand",onClick:()=>g(!1),children:o("iconify-icon",{icon:"mdi:plus",style:{fontSize:"1.25rem",color:"#64748b"}})})})]})}):o("div",{style:f.panel,children:[o("div",{style:f.panelHeader,children:[o("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:"Tag Features"}),o("div",{style:{display:"flex",gap:"0.25rem"},children:o(T,{variant:"icon",title:"Minimize",onClick:()=>g(!0),children:o("iconify-icon",{icon:"mdi:window-minimize",style:{fontSize:"1.125rem"}})})})]}),o("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem",background:"linear-gradient(to bottom, rgba(248,250,252,0.8), #fff)"},children:r?o("div",{style:{display:"flex",flexDirection:"column",minHeight:"100%"},children:[o("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem"},children:o("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[o("a",{href:"#",style:f.link,onClick:y=>{y.preventDefault(),te()},children:[o("iconify-icon",{icon:"mdi:arrow-left"})," Back"]}),o("div",{children:[o("div",{style:f.sectionLabel,children:"FEATURE SETUP"}),o("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"featureSetup",checked:L==="create",onChange:()=>O("create"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Create new Feature"})]}),o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"featureSetup",checked:L==="merge",onChange:()=>O("merge"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Merge with existing"})]})]}),o("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:[o("div",{children:[o("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:["Feature name ",o("span",{style:{color:"#ef4444"},children:"*"})]}),o(Ie,{type:"text",placeholder:"e.g. report-designer-data-table-grid Link",value:h,onInput:y=>c(y.target.value)}),p&&o("p",{style:{fontSize:"0.875rem",color:"#dc2626",marginTop:"0.375rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[o("iconify-icon",{icon:"mdi:alert-circle"})," Please enter a feature name."]})]}),o("div",{children:[o("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:"Description"}),o(It,{placeholder:"Describe your Feature",value:N,onInput:y=>P(y.target.value),minHeight:"5rem"})]})]})]}),o("div",{children:[o("div",{style:{...f.sectionLabel,display:"flex",alignItems:"center",gap:"0.25rem"},children:["FEATURE ELEMENT MATCHING",o("span",{style:{color:"#94a3b8"},title:"Match the element for this feature",children:o("iconify-icon",{icon:"mdi:information-outline"})})]}),o("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"featureMatch",checked:k==="suggested",onChange:()=>M("suggested"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Suggested match"})]}),o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"featureMatch",checked:k==="ruleBuilder",onChange:()=>M("ruleBuilder"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Rule builder"})]}),o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"featureMatch",checked:k==="customCss",onChange:()=>M("customCss"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Custom CSS"})]}),o("label",{style:f.radioLabel,children:[o("input",{type:"radio",name:"featureMatch",checked:k==="exact",onChange:()=>M("exact"),style:{accentColor:"#3b82f6"}}),o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Exact match"})]})]}),o("div",{children:[o("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:k==="exact"?"XPath":"Selection"}),o("div",{style:f.selectorBox,children:k==="exact"?(t?.xpath??H)||"-":(t?.selector??a)||"-"})]}),u&&o("div",{style:{marginTop:"1rem"},children:[o("button",{type:"button",style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:0,border:"none",background:"none",cursor:"pointer",fontFamily:"inherit",textAlign:"left"},onClick:()=>U(y=>!y),"aria-expanded":F,children:[o("label",{style:{...f.label,marginBottom:0,cursor:"pointer"},children:"Element info"}),o("iconify-icon",{icon:F?"mdi:chevron-up":"mdi:chevron-down",style:{fontSize:"1.125rem",color:"#64748b",flexShrink:0}})]}),F&&o("div",{style:{...f.elementInfo,marginTop:"0.5rem"},children:o("div",{style:f.elementInfoText,children:Ht(u)})})]})]})]})}),o("div",{style:f.footer,children:[o(T,{variant:"secondary",onClick:te,children:"Cancel"}),o(T,{variant:"primary",style:{flex:1},onClick:Me,disabled:Ze,children:Ze?"Saving...":"Save"})]})]}):o("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:i==="taggedList"?o(V,{children:[o("a",{href:"#",style:f.link,onClick:y=>{y.preventDefault(),te()},children:[o("iconify-icon",{icon:"mdi:arrow-left"})," Back to overview"]}),o("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[o("span",{style:{...f.badge,background:"#3b82f6",color:"#fff",minWidth:"1.75rem",height:"1.75rem"},children:se?"":et.length}),o("h3",{style:{fontSize:"1rem",fontWeight:700,color:"#1e293b"},children:"Tagged Features"})]}),o("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1rem"},children:"List of tagged features"}),o("div",{style:f.searchWrap,children:[o("iconify-icon",{icon:"mdi:magnify",style:f.searchIcon}),o(Ie,{type:"text",placeholder:"Search features",value:De,onInput:y=>me(y.target.value),style:f.searchInput}),De&&o(T,{variant:"ghost",style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)"},onClick:()=>me(""),children:"Clear"})]}),se?o("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1.5rem",color:"#64748b",fontSize:"0.875rem"},children:[o("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.25rem",marginRight:"0.5rem"}}),o("span",{children:"Loading features"})]}):et.map(y=>{const W=Mt===y.feature_id;return o("div",{style:{...f.pageItem,marginBottom:"0.5rem",alignItems:"center"},children:[o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#1e293b",flex:1},children:y.name||"Unnamed"}),o("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center"},children:[o(T,{variant:"iconSm",title:"Edit",onClick:()=>oe(y),disabled:W,children:o("iconify-icon",{icon:"mdi:pencil"})}),W?o("span",{style:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center"},children:o("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.25rem",color:"#64748b"}})}):o(T,{variant:"iconSm",title:"Delete",onClick:()=>le(y.feature_id),children:o("iconify-icon",{icon:"mdi:delete-outline"})})]})]},y.feature_id)}),o(T,{variant:"primary",style:{width:"100%",marginTop:"1rem"},onClick:()=>oe(),children:"Tag Feature"})]}):se?o("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",color:"#64748b",fontSize:"0.875rem"},children:[o("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.5rem",marginBottom:"0.75rem"}}),o("span",{children:"Loading features"})]}):o(V,{children:[o("div",{style:f.sectionLabel,children:"FEATURES OVERVIEW"}),o("div",{style:{...f.card,marginBottom:"0.75rem"},children:o("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o("div",{style:{display:"flex",gap:"1rem",flex:1,minWidth:0},children:[o("span",{style:{...f.badge,background:"#14b8a6",color:"#fff",minWidth:"1.75rem",height:"1.75rem"},children:"0"}),o("div",{style:{flex:1,minWidth:0},children:[o("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1e293b",marginBottom:"0.125rem"},children:"Suggested Features"}),o("div",{style:{fontSize:"0.75rem",color:"#64748b",lineHeight:1.375},children:"List of untagged elements on this page"})]})]}),o("iconify-icon",{icon:"mdi:chevron-right",style:{color:"#94a3b8",fontSize:"1.25rem",flexShrink:0}})]})}),o("div",{style:{...f.card,marginBottom:"0.75rem",cursor:"pointer"},onClick:ge,children:o("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o("div",{style:{display:"flex",gap:"1rem",flex:1,minWidth:0},children:[o("span",{style:{...f.badge,background:"#3b82f6",color:"#fff",minWidth:"1.75rem",height:"1.75rem"},children:Lt}),o("div",{style:{flex:1,minWidth:0},children:[o("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1e293b",marginBottom:"0.125rem"},children:"Tagged Features"}),o("div",{style:{fontSize:"0.75rem",color:"#64748b",lineHeight:1.375},children:"List of tagged Features on this page"})]})]}),o("iconify-icon",{icon:"mdi:chevron-right",style:{color:"#94a3b8",fontSize:"1.25rem",flexShrink:0}})]})}),o("div",{style:f.heatmapRow,children:[o("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Heatmap"}),o("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[o("button",{role:"switch",tabIndex:0,style:f.toggle(v),onClick:ae,onKeyDown:y=>y.key==="Enter"&&ae(),children:o("span",{style:f.toggleThumb(v)})}),o(T,{variant:"icon",style:{border:"1px solid #e2e8f0",borderRadius:"0.75rem"},children:o("iconify-icon",{icon:"mdi:plus",style:{fontSize:"1.125rem"}})})]})]}),o("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:[o(T,{variant:_?"primary":"secondary",style:{flex:1},onClick:()=>{I(!0),e({type:"TAG_FEATURE_CLICKED"})},children:"Re-Select"}),o(T,{variant:"secondary",style:_?void 0:{borderWidth:"2px",borderColor:"#3b82f6",background:"rgba(59, 130, 246, 0.08)",color:"#1d4ed8"},onClick:()=>{I(!1),e({type:"CLEAR_SELECTION_CLICKED"})},children:"Hide Selector"})]})]})})})]})}const Kr=new Hn({defaultOptions:{mutations:{retry:0}}});class qr{iframe=null;dragHandle=null;gripButton=null;messageCallback=null;isReady=!1;mode=null;elementSelectedState=null;tagPageSavedAckCounter=0;isDragging=!1;dragStartX=0;dragStartY=0;dragThreshold=3;mouseDownX=0;mouseDownY=0;isMouseDown=!1;create(t,i){if(console.log("[Visual Designer] EditorFrame.create() called with mode:",i),this.iframe){console.warn("[Visual Designer] EditorFrame already created, skipping");return}this.mode=i||null,this.messageCallback=t,console.log("[Visual Designer] Creating editor iframe with mode:",this.mode),this.iframe=document.createElement("iframe"),this.iframe.id="designer-editor-frame",this.iframe.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 600px;
      height: 800px;
      max-height: 90vh;
      border: none;
      border-radius: 16px;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
      z-index: 999999;
      display: none;
      overflow: hidden;
    `,this.createDragHandle(),this.loadEditorHtml(),window.addEventListener("message",this.handleMessage);const n=()=>{document.body?(document.body.appendChild(this.iframe),this.dragHandle&&document.body.appendChild(this.dragHandle),this.iframe&&(this.iframe.onload=()=>{this.isReady=!0,this.renderEditorContent(),this.updateDragHandlePosition()})):document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):setTimeout(n,100)};n()}show(){console.log("[Visual Designer] EditorFrame.show() called"),this.iframe?(console.log("[Visual Designer] Showing iframe"),this.iframe.style.display="block",this.updateDragHandlePosition()):console.warn("[Visual Designer] Cannot show iframe - iframe is null"),this.dragHandle?(console.log("[Visual Designer] Showing drag handle"),this.dragHandle.style.display="block"):console.warn("[Visual Designer] Cannot show drag handle - dragHandle is null")}hide(){this.iframe&&(this.iframe.style.display="none"),this.dragHandle&&(this.dragHandle.style.display="none")}sendElementSelected(t){this.elementSelectedState={selector:t.selector,elementInfo:t.elementInfo,xpath:t.xpath},this.renderEditorContent(),this.show()}sendClearSelectionAck(){this.elementSelectedState=null,this.renderEditorContent()}sendTagPageSavedAck(){this.tagPageSavedAckCounter+=1,this.renderEditorContent()}destroy(){window.removeEventListener("message",this.handleMessage),document.removeEventListener("mousemove",this.handleMouseMove,!0),document.removeEventListener("mouseup",this.handleMouseUp,!0),window.removeEventListener("mousemove",this.handleMouseMove,!0),window.removeEventListener("mouseup",this.handleMouseUp,!0),this.iframe&&(this.iframe.remove(),this.iframe=null),this.dragHandle&&(this.dragHandle.remove(),this.dragHandle=null),this.gripButton=null,this.isReady=!1,this.messageCallback=null,this.isDragging=!1,this.isMouseDown=!1,document.body.style.cursor="",document.documentElement.style.cursor="",document.body.style.userSelect="",document.documentElement.style.userSelect=""}sendMessage(t){if(!this.iframe||!this.isReady){setTimeout(()=>this.sendMessage(t),100);return}const i=this.iframe.contentWindow;i&&i.postMessage(t,"*")}loadEditorHtml(){const t=this.getMinimalEditorHtml(),i=new Blob([t],{type:"text/html"}),n=URL.createObjectURL(i);this.iframe&&(this.iframe.src=n)}renderEditorContent(){if(!this.iframe||!this.isReady)return;const t=this.iframe.contentDocument,i=t?.getElementById("designer-editor-root");if(!t||!i)return;const n=s=>this.messageCallback?.(s),r=this.mode==="tag-page"?o(Mr,{onMessage:n}):this.mode==="tag-feature"?o(Gr,{onMessage:n,elementSelected:this.elementSelectedState}):o(mr,{onMessage:n,elementSelected:this.elementSelectedState});_e(o(tr,{client:Kr,children:r}),i)}getMinimalEditorHtml(){return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Designer Editor</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://code.iconify.design/iconify-icon/3.0.2/iconify-icon.min.js"><\/script>
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Montserrat',-apple-system,BlinkMacSystemFont,sans-serif;padding:20px;color:#0f172a;line-height:1.6;height:100%;overflow-y:auto;-webkit-font-smoothing:antialiased}</style>
  <style>${fr}</style>
</head>
<body>
  <div id="designer-editor-root"></div>
</body>
</html>`}createDragHandle(){if(this.dragHandle)return;this.dragHandle=document.createElement("div"),this.dragHandle.id="designer-editor-drag-handle",this.dragHandle.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 400px;
      height: 70px;
      background: transparent;
      cursor: default;
      z-index: 1000000;
      display: none;
      pointer-events: none;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    `;const t=document.createElement("div");t.style.cssText=`
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: grab;
      pointer-events: auto;
      padding: 6px 8px;
      border-radius: 6px;
      background: transparent;
      border: none;
      z-index: 1;
      transition: background 0.2s, border-color 0.2s;
    `,t.onmouseenter=()=>{t.style.background="transparent",t.style.border="none"},t.onmouseleave=()=>{t.style.background="transparent",t.style.border="none"};const i=document.createElement("iconify-icon");i.setAttribute("icon","pepicons-print:dots-x"),i.style.cssText="font-size: 18px; color: #64748b; pointer-events: none;",t.appendChild(i),this.dragHandle.appendChild(t),this.gripButton=t,t.addEventListener("mousedown",this.handleMouseDown,!0),document.addEventListener("mousemove",this.handleMouseMove,!0),document.addEventListener("mouseup",this.handleMouseUp,!0),window.addEventListener("mousemove",this.handleMouseMove,!0),window.addEventListener("mouseup",this.handleMouseUp,!0)}updateDragHandlePosition(){if(!this.iframe||!this.dragHandle)return;const t=this.iframe.getBoundingClientRect();this.dragHandle.style.top=`${t.top}px`,this.dragHandle.style.left=`${t.left}px`,this.dragHandle.style.width=`${t.width}px`}handleMouseDown=t=>{if(!this.iframe||!this.dragHandle)return;this.mouseDownX=t.clientX,this.mouseDownY=t.clientY,this.isMouseDown=!0,this.isDragging=!1;const i=this.iframe.getBoundingClientRect();this.dragStartX=t.clientX-i.left,this.dragStartY=t.clientY-i.top,t.preventDefault(),t.stopPropagation()};handleMouseMove=t=>{if(!this.isMouseDown||!this.iframe||!this.dragHandle)return;if(!this.isDragging){const d=Math.abs(t.clientX-this.mouseDownX),h=Math.abs(t.clientY-this.mouseDownY);if(Math.sqrt(d*d+h*h)>this.dragThreshold)this.isDragging=!0,document.body.style.cursor="grabbing",document.documentElement.style.cursor="grabbing",document.body.style.userSelect="none",document.documentElement.style.userSelect="none",this.iframe&&(this.iframe.style.pointerEvents="none"),this.gripButton&&(this.gripButton.style.cursor="grabbing");else return}t.preventDefault(),t.stopPropagation();const i=t.clientX-this.dragStartX,n=t.clientY-this.dragStartY,r=window.innerWidth,s=window.innerHeight,a=this.iframe.offsetWidth,l=Math.max(-a+50,Math.min(i,r-50)),u=Math.max(0,Math.min(n,s-100));this.iframe.style.left=`${l}px`,this.iframe.style.top=`${u}px`,this.iframe.style.right="auto",this.iframe.style.bottom="auto",this.dragHandle.style.left=`${l}px`,this.dragHandle.style.top=`${u}px`};handleMouseUp=t=>{this.isMouseDown&&(this.isDragging=!1,this.isMouseDown=!1,document.body.style.cursor="",document.documentElement.style.cursor="",document.body.style.userSelect="",document.documentElement.style.userSelect="",this.iframe&&(this.iframe.style.pointerEvents=""),this.gripButton&&(this.gripButton.style.cursor="grab"),t.preventDefault(),t.stopPropagation())};handleMessage=t=>{const i=t.data;!i||!i.type||(this.messageCallback&&this.messageCallback(i),(i.type==="CANCEL"||i.type==="GUIDE_SAVED")&&this.hide())}}const Vr="visual-designer-guides",qi="1.0.0";class Yr{storageKey;constructor(t=Vr){this.storageKey=t}getGuides(){try{const t=localStorage.getItem(this.storageKey);if(!t)return[];const i=JSON.parse(t);return i.version!==qi?(this.clear(),[]):i.guides||[]}catch{return[]}}getGuidesByPage(t){return this.getGuides().filter(n=>n.page===t&&n.status==="active")}saveGuide(t){const i=this.getGuides(),n=i.findIndex(s=>s.id===t.id),r={...t,updatedAt:new Date().toISOString(),createdAt:t.createdAt||new Date().toISOString()};n>=0?i[n]=r:i.push(r),this.saveGuides(i)}deleteGuide(t){const i=this.getGuides().filter(n=>n.id!==t);this.saveGuides(i)}saveGuides(t){const i={guides:t,version:qi};localStorage.setItem(this.storageKey,JSON.stringify(i))}clear(){localStorage.removeItem(this.storageKey)}getGuide(t){return this.getGuides().find(i=>i.id===t)||null}}function Xr({onExit:e}){const t={position:"fixed",top:"20px",right:"20px",padding:"10px 20px",background:E.bg,border:`2px solid ${E.primary}`,borderRadius:E.borderRadius,color:E.primary,fontSize:"14px",fontWeight:"600",fontFamily:E.fontFamily,cursor:"pointer",zIndex:String(E.zIndex.controls),boxShadow:E.shadow,transition:"all 0.2s ease",pointerEvents:"auto"};return o("button",{id:"designer-exit-editor-btn",style:t,onClick:e,onMouseEnter:i=>{i.currentTarget.style.background=E.primary,i.currentTarget.style.color=E.bg,i.currentTarget.style.transform="translateY(-2px)",i.currentTarget.style.boxShadow=E.shadowHover},onMouseLeave:i=>{i.currentTarget.style.background=E.bg,i.currentTarget.style.color=E.primary,i.currentTarget.style.transform="translateY(0)",i.currentTarget.style.boxShadow=E.shadow},children:[o("iconify-icon",{icon:"mdi:exit-to-app",style:{verticalAlign:"-0.2em",marginRight:"6px"}}),"Exit Editor"]})}function Jr(){return o("div",{id:"designer-red-border-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,border:`5px solid ${E.primary}`,pointerEvents:"none",zIndex:E.zIndex.highlight-1,boxSizing:"border-box"}})}function Zr(){return o("div",{id:"designer-studio-badge",style:{position:"fixed",top:"4px",left:"50%",transform:"translateX(-50%)",padding:"0px 10px 3px",background:E.primary,color:E.bg,fontSize:"14px",fontWeight:"600",fontFamily:E.fontFamily,borderRadius:"0 0 6px 6px",border:`5px solid ${E.primary}`,borderTop:"none",zIndex:E.zIndex.badge,boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)",pointerEvents:"none",whiteSpace:"nowrap"},children:"Revgain Visual Design Studio"})}function es(){return o("div",{id:"designer-loading-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(248, 250, 252, 0.97)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",zIndex:E.zIndex.loading,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:E.fontFamily},children:[o("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2.5rem 3rem",background:"#ffffff",borderRadius:"16px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.04)",minWidth:"220px"},children:[o("div",{style:{width:56,height:56,border:"3px solid #e2e8f0",borderTopColor:E.primary,borderRadius:"50%",animation:"vd-spin 0.8s linear infinite",marginBottom:"1.5rem"}}),o("div",{style:{fontSize:"1rem",fontWeight:600,color:"#1e293b",letterSpacing:"-0.02em",marginBottom:"0.25rem"},children:"Loading editor"}),o("div",{style:{fontSize:"0.8125rem",color:"#64748b",fontWeight:500},children:[o("span",{style:{animation:"vd-dot1 1.4s ease-in-out infinite"},children:"."}),o("span",{style:{animation:"vd-dot2 1.4s ease-in-out infinite"},children:"."}),o("span",{style:{animation:"vd-dot3 1.4s ease-in-out infinite"},children:"."})]})]}),o("style",{children:`
        @keyframes vd-spin {
          to { transform: rotate(360deg); }
        }
        @keyframes vd-dot1 {
          0%, 20% { opacity: 0.2; }
          40%, 100% { opacity: 1; }
        }
        @keyframes vd-dot2 {
          0%, 20%, 40% { opacity: 0.2; }
          60%, 100% { opacity: 1; }
        }
        @keyframes vd-dot3 {
          0%, 20%, 40%, 60% { opacity: 0.2; }
          80%, 100% { opacity: 1; }
        }
      `})]})}function ts(e){return o(V,{children:[e.showExitButton&&o(Xr,{onExit:e.onExitEditor}),e.showRedBorder&&o(Jr,{}),e.showBadge&&o(Zr,{}),e.showLoading&&o(es,{})]})}function is(e,t){_e(o(ts,{...t}),e)}class Ft{config;storage;editorMode;guideRenderer;featureHeatmapRenderer;editorFrame;heatmapEnabled=!1;isInitialized=!1;isEditorMode=!1;sdkRoot=null;showLoading=!1;loadingFallbackTimer=null;featuresForHeatmap=[];constructor(t={}){this.config=t,this.storage=new Yr(t.storageKey),this.editorMode=new en,this.guideRenderer=new un,this.featureHeatmapRenderer=new fn,this.editorFrame=new qr}init(){if(this.isInitialized)return;this.isInitialized=!0,this.injectMontserratFont(),this.injectIconifyScript(),this.guideRenderer.setOnDismiss(i=>this.config.onGuideDismissed?.(i)),this.shouldEnableEditorMode()?(this.showLoading=!0,this.renderOverlays(),this.enableEditor()):this.loadGuides(),this.heatmapEnabled=localStorage.getItem("designerHeatmapEnabled")==="true",this.renderFeatureHeatmap(),this.setupEventListeners()}enableEditor(){if(this.isEditorMode)return;this.isEditorMode=!0;let t=typeof window<"u"&&window.__visualDesignerMode||null;t||(t=localStorage.getItem("designerModeType")||null),this.editorFrame.create(n=>this.handleEditorMessage(n),t);const i=t==="tag-page"||t==="tag-feature";i||this.editorMode.activate(n=>this.handleEditorMessage(n)),this.ensureSDKRoot(),this.renderOverlays(),localStorage.setItem("designerMode","true"),t&&localStorage.setItem("designerModeType",t),setTimeout(()=>{this.editorFrame.show(),this.renderOverlays()},i?100:300),this.loadingFallbackTimer=setTimeout(()=>{this.loadingFallbackTimer=null,this.showLoading&&(this.showLoading=!1,this.renderOverlays())},5e3)}disableEditor(){if(this.isEditorMode){try{window.close()}catch{}this.isEditorMode=!1,this.editorMode.deactivate(),this.editorFrame.destroy(),this.featureHeatmapRenderer.destroy(),this.loadingFallbackTimer&&(clearTimeout(this.loadingFallbackTimer),this.loadingFallbackTimer=null),this.showLoading=!1,localStorage.removeItem("designerMode"),localStorage.removeItem("designerModeType"),this.renderOverlays(),this.loadGuides()}}getGuides(){return this.storage.getGuides()}getGuidesForCurrentPage(){return this.storage.getGuidesByPage(Ae())}saveGuide(t){const i={...t,id:Xi(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.storage.saveGuide(i),this.isEditorMode||this.loadGuides(),this.config.onGuideSaved?.(i),i}deleteGuide(t){this.storage.deleteGuide(t),this.guideRenderer.dismissGuide(t)}loadGuides(){this.guideRenderer.renderGuides(this.storage.getGuides())}isEditorModeActive(){return this.isEditorMode}shouldEnableEditorMode(){return this.config.editorMode!==void 0?this.config.editorMode:typeof window<"u"&&window.__visualDesignerWasLaunched?!0:localStorage.getItem("designerMode")==="true"}handleEditorMessage(t){switch(t.type){case"ELEMENT_SELECTED":this.handleElementSelected(t);break;case"SAVE_GUIDE":this.handleSaveGuide(t);break;case"TAG_FEATURE_CLICKED":this.editorMode.activate(i=>this.handleEditorMessage(i));break;case"ACTIVATE_SELECTOR":this.editorMode.activate(i=>this.handleEditorMessage(i));break;case"CLEAR_SELECTION_CLICKED":this.editorMode.deactivate(),this.editorFrame.sendClearSelectionAck();break;case"HEATMAP_TOGGLE":this.handleHeatmapToggle(t.enabled);break;case"FEATURES_FOR_HEATMAP":this.handleFeaturesForHeatmap(t.features);break;case"CANCEL":this.editorFrame.hide();break;case"EXIT_EDITOR_MODE":this.disableEditor();break;case"EDITOR_READY":this.loadingFallbackTimer&&(clearTimeout(this.loadingFallbackTimer),this.loadingFallbackTimer=null),this.showLoading=!1,this.renderOverlays();break}}handleElementSelected(t){this.editorFrame.sendElementSelected(t)}handleSaveGuide(t){this.saveGuide({...t.guide,page:Ae()})}handleHeatmapToggle(t){this.heatmapEnabled=t;try{localStorage.setItem("designerHeatmapEnabled",String(t))}catch{}this.renderFeatureHeatmap()}handleFeaturesForHeatmap(t){this.featuresForHeatmap=t.map(i=>{let r=(i.rules?.find(s=>s.selector_type==="xpath"&&(s.selector_value??"").trim()!=="")?.selector_value??"").trim();return r&&r.startsWith("/body")&&(r="/html[1]"+r),{id:i.feature_id,featureName:i.name,selector:r,url:""}}),this.renderFeatureHeatmap()}getTaggedFeatures(){return this.featuresForHeatmap}renderFeatureHeatmap(){this.featureHeatmapRenderer.render(this.getTaggedFeatures(),this.heatmapEnabled)}setupEventListeners(){let t,i;const n=()=>{this.guideRenderer.updatePositions(this.storage.getGuides())},r=()=>{this.featureHeatmapRenderer.updatePositions(this.getTaggedFeatures())};window.addEventListener("resize",()=>{clearTimeout(t),t=window.setTimeout(()=>{n(),r()},100)}),window.addEventListener("scroll",()=>{clearTimeout(i),i=window.setTimeout(()=>{n(),r()},50)},!0)}ensureSDKRoot(){if(!this.sdkRoot){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.ensureSDKRoot());return}setTimeout(()=>this.ensureSDKRoot(),100);return}this.sdkRoot=document.createElement("div"),this.sdkRoot.id="designer-sdk-root",document.body.appendChild(this.sdkRoot)}}renderOverlays(){this.ensureSDKRoot(),this.sdkRoot&&is(this.sdkRoot,{showExitButton:this.isEditorMode,showRedBorder:this.isEditorMode,showBadge:this.isEditorMode,showLoading:this.showLoading,onExitEditor:()=>this.disableEditor()})}injectMontserratFont(){if(typeof document>"u"||!document.head||document.getElementById("designer-montserrat-font"))return;const t=document.createElement("link");t.id="designer-montserrat-font",t.rel="stylesheet",t.href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap",document.head.appendChild(t)}injectIconifyScript(){if(typeof document>"u"||!document.head||document.getElementById("designer-iconify-script"))return;const t=document.createElement("script");t.id="designer-iconify-script",t.src="https://code.iconify.design/iconify-icon/3.0.2/iconify-icon.min.js",t.async=!0,document.head.appendChild(t)}}let z=null,Vi=!1;function Z(e){return z||(z=new Ft(e),z.init(),z)}function Ot(){return z}function Dt(e){!e||!Array.isArray(e)||e.forEach(t=>{if(!t||!Array.isArray(t)||t.length===0)return;const i=t[0],n=t.slice(1);try{switch(i){case"initialize":Z(n[0]);break;case"identify":n[0]&&console.log("[Visual Designer] identify (snippet) called with:",n[0]);break;case"enableEditor":(z??Z()).enableEditor();break;case"disableEditor":z?.disableEditor();break;case"loadGuides":z?.loadGuides();break;case"getGuides":return z?.getGuides();default:console.warn("[Visual Designer] Unknown snippet method:",i)}}catch(r){console.error("[Visual Designer] Error processing queued call:",i,r)}})}if(typeof window<"u"){const e=window.visualDesigner;e&&Array.isArray(e._q)&&(Vi=!0,e.initialize=t=>Z(t),e.identify=t=>{t&&console.log("[Visual Designer] identify (snippet) called with:",t)},e.enableEditor=()=>(z??Z()).enableEditor(),e.disableEditor=()=>z?.disableEditor(),e.loadGuides=()=>z?.loadGuides(),e.getGuides=()=>z?.getGuides(),e.getInstance=Ot,e.init=Z,Dt(e._q));try{const t=new URL(window.location.href),i=t.searchParams.get("designer"),n=t.searchParams.get("mode"),r=t.searchParams.get("iud");i==="true"&&(n&&(window.__visualDesignerMode=n,localStorage.setItem("designerModeType",n)),localStorage.setItem("designerMode","true"),r&&localStorage.setItem(Gi,r),t.searchParams.delete("designer"),t.searchParams.delete("mode"),t.searchParams.delete("iud"),window.history.replaceState({},"",t.toString()),window.__visualDesignerWasLaunched=!0)}catch{}}if(typeof window<"u"&&!z&&!Vi){const e=()=>{z||Z()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}typeof window<"u"&&(window.VisualDesigner={init:Z,initialize:Z,getInstance:Ot,DesignerSDK:Ft,apiClient:K,_processQueue:Dt}),q.DesignerSDK=Ft,q._processQueue=Dt,q.apiClient=K,q.getInstance=Ot,q.init=Z,Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})}));
