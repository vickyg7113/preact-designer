(function(ie,oe){typeof exports=="object"&&typeof module<"u"?oe(exports):typeof define=="function"&&define.amd?define(["exports"],oe):(ie=typeof globalThis<"u"?globalThis:ie||self,oe(ie.VisualDesigner={}))})(this,(function(ie){"use strict";class oe{static generateSelector(t){if(t.id)return{selector:`#${this.escapeSelector(t.id)}`,confidence:"high",method:"id"};const i=this.generateContainsSelector(t);if(i)return i;const n=this.generatePathFromAnchorToElement(t);if(n)return n;if(t.hasAttribute("data-testid")){const l=t.getAttribute("data-testid");return{selector:`[data-testid="${this.escapeAttribute(l)}"]`,confidence:"high",method:"data-testid"}}const r=this.getSemanticDataAttributes(t);if(r.length>0){const l=r[0],u=t.getAttribute(l);return{selector:`[${l}="${this.escapeAttribute(u)}"]`,confidence:"high",method:"data-attribute"}}const o=this.generateAriaSelector(t);if(o)return{selector:o,confidence:"medium",method:"aria"};const a=this.generatePathSelector(t);return a?{selector:a,confidence:"medium",method:"path"}:{selector:t.tagName.toLowerCase(),confidence:"low",method:"tag"}}static getXPath(t){if(t.id&&document.querySelector(`#${CSS.escape(t.id)}`)===t)return`//*[@id="${t.id.replace(/"/g,'\\"')}"]`;const i=[];let n=t;for(;n&&n!==document.documentElement;){const r=n.tagName.toLowerCase(),o=n.parentElement;if(!o){i.unshift(r);break}const l=Array.from(o.children).filter(u=>u.tagName===n.tagName).indexOf(n)+1;i.unshift(`${r}[${l}]`),n=o}return"/"+i.join("/")}static findElement(t){try{if(t.startsWith("/")||t.startsWith("//"))return this.findElementByXPath(t);const i=this.parseContainsAndDescendant(t);if(i){const r=this.findElementWithContains(i.anchorPart);if(!r)return null;if(i.descendantPart){const o=r.querySelector(i.descendantPart);return o||null}return r}return t.match(/(.*):contains\('((?:[^'\\]|\\.)*)'\)$/)?this.findElementWithContains(t):document.querySelector(t)}catch{return null}}static parseContainsAndDescendant(t){const i=t.match(/:contains\('((?:[^'\\]|\\.)*)'\)/);if(!i)return null;const n=t.indexOf(i[0])+i[0].length,r=t.slice(n),o=r.indexOf(" > ");return o===-1?null:{anchorPart:t.slice(0,n+o).trim(),descendantPart:r.slice(o+3).trim()||null}}static findElementByXPath(t){try{return document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch{return null}}static findElementWithContains(t){const i=t.match(/(.*):contains\('((?:[^'\\]|\\.)*)'\)$/);if(!i)return null;const n=i[1].trim(),r=i[2].replace(/\\'/g,"'"),o=this.normalizeText(r),a=document.querySelectorAll(n);for(let l=0;l<a.length;l++)if(this.normalizeText(a[l].textContent||"").includes(o))return a[l];return null}static validateSelector(t){try{return this.findElement(t)!==null}catch{return!1}}static getSemanticDataAttributes(t){const i=["data-id","data-name","data-role","data-component","data-element"],n=[];for(const r of i)t.hasAttribute(r)&&n.push(r);for(let r=0;r<t.attributes.length;r++){const o=t.attributes[r];o.name.startsWith("data-")&&!n.includes(o.name)&&n.push(o.name)}return n}static generateAriaSelector(t){const i=t.getAttribute("role"),n=t.getAttribute("aria-label");if(i){let r=`[role="${this.escapeAttribute(i)}"]`;return n&&(r+=`[aria-label="${this.escapeAttribute(n)}"]`),r}return null}static generatePathSelector(t){const i=[];let n=t;for(;n&&n!==document.body&&n!==document.documentElement;){let r=n.tagName.toLowerCase();if(n.id){r+=`#${this.escapeSelector(n.id)}`,i.unshift(r);break}if(n.className&&typeof n.className=="string"){const a=n.className.split(/\s+/).filter(l=>l&&!l.startsWith("designer-")).slice(0,2);a.length>0&&(r+="."+a.map(l=>this.escapeSelector(l)).join("."))}const o=n.parentElement;if(o){const a=Array.from(o.children).filter(l=>l.tagName===n.tagName);a.length>1&&(r+=`:nth-of-type(${a.indexOf(n)+1})`)}if(i.unshift(r),n=o,i.length>=5)break}return i.length>0?i.join(" > "):null}static normalizeText(t){return(t||"").trim().replace(/\s+/g," ")}static buildSegment(t){let i=t.tagName.toLowerCase();if(t.className&&typeof t.className=="string"){const r=t.className.split(/\s+/).filter(o=>o&&!o.startsWith("designer-")).slice(0,2);r.length>0&&(i+="."+r.map(o=>this.escapeSelector(o)).join("."))}const n=t.parentElement;if(n){const r=Array.from(n.children).filter(o=>o.tagName===t.tagName);r.length>1&&(i+=`:nth-of-type(${r.indexOf(t)+1})`)}return i}static getPathFromAncestorToElement(t,i){const n=[];let r=i;for(;r&&r!==t;)n.unshift(r),r=r.parentElement;return r===t&&n.unshift(t),n}static generateContainsSelector(t){const n=(t.textContent||"").trim().replace(/\s+/g," ").slice(0,200);if(n.length<2)return null;const r=this.generatePathSelector(t);if(!r)return null;const o=n.replace(/\\/g,"\\\\").replace(/'/g,"\\'");return{selector:`${r}:contains('${o}')`,confidence:"high",method:"contains"}}static findAnchor(t){let i=t.parentElement;for(;i&&i!==document.body&&i!==document.documentElement;){if(i.id)return{anchor:i,hasId:!0};if((i.textContent||"").trim().replace(/\s+/g," ").length>=2)return{anchor:i,hasId:!1};i=i.parentElement}return null}static generatePathFromAnchorToElement(t){const i=this.findAnchor(t);if(!i)return null;const{anchor:n,hasId:r}=i,o=this.getPathFromAncestorToElement(n,t);if(o.length<2||o.length>12)return null;const l=[];if(r){l.push(`#${this.escapeSelector(n.id)}`);for(let u=1;u<o.length;u++)l.push(this.buildSegment(o[u]))}else{const u=(n.textContent||"").trim().replace(/\s+/g," ").slice(0,200);if(u.length<2)return null;const c=this.generatePathSelector(n);if(!c)return null;const h=u.replace(/\\/g,"\\\\").replace(/'/g,"\\'");l.push(`${c}:contains('${h}')`);for(let d=1;d<o.length;d++)l.push(this.buildSegment(o[d]))}return{selector:l.join(" > "),confidence:"high",method:"path-from-anchor"}}static escapeSelector(t){return typeof CSS<"u"&&CSS.escape?CSS.escape(t):t.replace(/([!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~])/g,"\\$1")}static escapeAttribute(t){return t.replace(/"/g,'\\"').replace(/'/g,"\\'")}}function dn(e){const t=e.getBoundingClientRect(),i={};for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n];i[r.name]=r.value}return{tagName:e.tagName.toLowerCase(),id:e.id||void 0,className:e.className?.toString()||void 0,textContent:e.textContent?.trim().substring(0,50)||void 0,attributes:i,boundingRect:t}}function Qt(e){const t=window.getComputedStyle(e);return t.display!=="none"&&t.visibility!=="hidden"&&t.opacity!=="0"&&e.getBoundingClientRect().height>0&&e.getBoundingClientRect().width>0}function De(){return window.location.pathname||"/"}function un(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function hn(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function jt(e){hn(e)||e.scrollIntoView({behavior:"smooth",block:"center"})}const qt="#designer-editor-frame, #designer-highlight-overlay, #designer-exit-editor-btn, #designer-red-border-overlay, #designer-studio-badge";class fn{isActive=!1;highlightOverlay=null;messageCallback=null;activate(t){this.isActive||(this.isActive=!0,this.messageCallback=t,this.createHighlightOverlay(),this.attachEventListeners(),this.addEditorStyles())}deactivate(){this.isActive&&(this.isActive=!1,this.removeEventListeners(),this.removeHighlightOverlay(),this.removeEditorStyles(),this.messageCallback=null)}getActive(){return this.isActive}createHighlightOverlay(){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.createHighlightOverlay());return}setTimeout(()=>this.createHighlightOverlay(),100);return}this.highlightOverlay=document.createElement("div"),this.highlightOverlay.id="designer-highlight-overlay",this.highlightOverlay.style.cssText=`
      position: absolute;
      pointer-events: none;
      border: 2px solid #3b82f6;
      background-color: rgba(59, 130, 246, 0.1);
      z-index: 999998;
      transition: all 0.1s ease;
      box-sizing: border-box;
      display: none;
    `,document.body.appendChild(this.highlightOverlay)}removeHighlightOverlay(){this.highlightOverlay?.remove(),this.highlightOverlay=null}attachEventListeners(){document.addEventListener("mouseover",this.handleMouseOver,!0),document.addEventListener("click",this.handleClick,!0),document.addEventListener("keydown",this.handleKeyDown,!0)}removeEventListeners(){document.removeEventListener("mouseover",this.handleMouseOver,!0),document.removeEventListener("click",this.handleClick,!0),document.removeEventListener("keydown",this.handleKeyDown,!0)}handleMouseOver=t=>{if(!this.isActive||!this.highlightOverlay)return;const i=t.target;if(!(!i||i===this.highlightOverlay)){if(i.closest(qt)){this.hideHighlight();return}if(!Qt(i)){this.hideHighlight();return}this.highlightElement(i)}};handleClick=t=>{if(!this.isActive)return;const i=t.target;i&&(i.closest(qt)||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),Qt(i)&&this.selectElement(i)))};handleKeyDown=t=>{this.isActive&&t.key==="Escape"&&(this.messageCallback?.({type:"CANCEL"}),this.hideHighlight())};highlightElement(t){if(!this.highlightOverlay)return;const i=t.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;this.highlightOverlay.style.display="block",this.highlightOverlay.style.left=`${i.left+n}px`,this.highlightOverlay.style.top=`${i.top+r}px`,this.highlightOverlay.style.width=`${i.width}px`,this.highlightOverlay.style.height=`${i.height}px`}hideHighlight(){this.highlightOverlay&&(this.highlightOverlay.style.display="none")}selectElement(t){this.highlightElement(t);const i=oe.generateSelector(t),n=dn(t),r=oe.getXPath(t);this.messageCallback?.({type:"ELEMENT_SELECTED",selector:i.selector,elementInfo:n,xpath:r})}addEditorStyles(){const t=document.createElement("style");t.id="designer-editor-styles",t.textContent=`
      * { user-select: none !important; -webkit-user-select: none !important; -moz-user-select: none !important; -ms-user-select: none !important; }
      a, button, input, textarea, select { pointer-events: auto !important; }
    `,document.head.appendChild(t)}removeEditorStyles(){document.getElementById("designer-editor-styles")?.remove()}}var Ne,E,Vt,ye,Yt,Xt,Jt,Zt,st,ot,at,ei,Me={},ti=[],pn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ae=Array.isArray;function ae(e,t){for(var i in t)e[i]=t[i];return e}function lt(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function ct(e,t,i){var n,r,o,a={};for(o in t)o=="key"?n=t[o]:o=="ref"?r=t[o]:a[o]=t[o];if(arguments.length>2&&(a.children=arguments.length>3?Ne.call(arguments,2):i),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)a[o]===void 0&&(a[o]=e.defaultProps[o]);return We(e,a,n,r,null)}function We(e,t,i,n,r){var o={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++Vt,__i:-1,__u:0};return r==null&&E.vnode!=null&&E.vnode(o),o}function Q(e){return e.children}function le(e,t){this.props=e,this.context=t}function Pe(e,t){if(t==null)return e.__?Pe(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if((i=e.__k[t])!=null&&i.__e!=null)return i.__e;return typeof e.type=="function"?Pe(e):null}function ii(e){var t,i;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((i=e.__k[t])!=null&&i.__e!=null){e.__e=e.__c.base=i.__e;break}return ii(e)}}function dt(e){(!e.__d&&(e.__d=!0)&&ye.push(e)&&!Ge.__r++||Yt!=E.debounceRendering)&&((Yt=E.debounceRendering)||Xt)(Ge)}function Ge(){for(var e,t,i,n,r,o,a,l=1;ye.length;)ye.length>l&&ye.sort(Jt),e=ye.shift(),l=ye.length,e.__d&&(i=void 0,n=void 0,r=(n=(t=e).__v).__e,o=[],a=[],t.__P&&((i=ae({},n)).__v=n.__v+1,E.vnode&&E.vnode(i),ut(t.__P,i,n,t.__n,t.__P.namespaceURI,32&n.__u?[r]:null,o,r??Pe(n),!!(32&n.__u),a),i.__v=n.__v,i.__.__k[i.__i]=i,ai(o,i,a),n.__e=n.__=null,i.__e!=r&&ii(i)));Ge.__r=0}function ni(e,t,i,n,r,o,a,l,u,c,h){var d,p,m,_,y,S,b,v=n&&n.__k||ti,M=t.length;for(u=mn(i,t,v,u,M),d=0;d<M;d++)(m=i.__k[d])!=null&&(p=m.__i==-1?Me:v[m.__i]||Me,m.__i=d,S=ut(e,m,p,r,o,a,l,u,c,h),_=m.__e,m.ref&&p.ref!=m.ref&&(p.ref&&ft(p.ref,null,m),h.push(m.ref,m.__c||_,m)),y==null&&_!=null&&(y=_),(b=!!(4&m.__u))||p.__k===m.__k?u=ri(m,u,e,b):typeof m.type=="function"&&S!==void 0?u=S:_&&(u=_.nextSibling),m.__u&=-7);return i.__e=y,u}function mn(e,t,i,n,r){var o,a,l,u,c,h=i.length,d=h,p=0;for(e.__k=new Array(r),o=0;o<r;o++)(a=t[o])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[o]=We(null,a,null,null,null):Ae(a)?a=e.__k[o]=We(Q,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[o]=We(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[o]=a,u=o+p,a.__=e,a.__b=e.__b+1,l=null,(c=a.__i=gn(a,i,u,d))!=-1&&(d--,(l=i[c])&&(l.__u|=2)),l==null||l.__v==null?(c==-1&&(r>h?p--:r<h&&p++),typeof a.type!="function"&&(a.__u|=4)):c!=u&&(c==u-1?p--:c==u+1?p++:(c>u?p--:p++,a.__u|=4))):e.__k[o]=null;if(d)for(o=0;o<h;o++)(l=i[o])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=Pe(l)),ci(l,l));return n}function ri(e,t,i,n){var r,o;if(typeof e.type=="function"){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=ri(r[o],t,i,n));return t}e.__e!=t&&(n&&(t&&e.type&&!t.parentNode&&(t=Pe(e)),i.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ke(e,t){return t=t||[],e==null||typeof e=="boolean"||(Ae(e)?e.some(function(i){Ke(i,t)}):t.push(e)),t}function gn(e,t,i,n){var r,o,a,l=e.key,u=e.type,c=t[i],h=c!=null&&(2&c.__u)==0;if(c===null&&l==null||h&&l==c.key&&u==c.type)return i;if(n>(h?1:0)){for(r=i-1,o=i+1;r>=0||o<t.length;)if((c=t[a=r>=0?r--:o++])!=null&&(2&c.__u)==0&&l==c.key&&u==c.type)return a}return-1}function si(e,t,i){t[0]=="-"?e.setProperty(t,i??""):e[t]=i==null?"":typeof i!="number"||pn.test(t)?i:i+"px"}function Qe(e,t,i,n,r){var o,a;e:if(t=="style")if(typeof i=="string")e.style.cssText=i;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||si(e.style,t,"");if(i)for(t in i)n&&i[t]==n[t]||si(e.style,t,i[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(Zt,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=i,i?n?i.u=n.u:(i.u=st,e.addEventListener(t,o?at:ot,o)):e.removeEventListener(t,o?at:ot,o);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&i==1?"":i))}}function oi(e){return function(t){if(this.l){var i=this.l[t.type+e];if(t.t==null)t.t=st++;else if(t.t<i.u)return;return i(E.event?E.event(t):t)}}}function ut(e,t,i,n,r,o,a,l,u,c){var h,d,p,m,_,y,S,b,v,M,L,B,F,A,C,R,G,D=t.type;if(t.constructor!==void 0)return null;128&i.__u&&(u=!!(32&i.__u),o=[l=t.__e=i.__e]),(h=E.__b)&&h(t);e:if(typeof D=="function")try{if(b=t.props,v="prototype"in D&&D.prototype.render,M=(h=D.contextType)&&n[h.__c],L=h?M?M.props.value:h.__:n,i.__c?S=(d=t.__c=i.__c).__=d.__E:(v?t.__c=d=new D(b,L):(t.__c=d=new le(b,L),d.constructor=D,d.render=_n),M&&M.sub(d),d.state||(d.state={}),d.__n=n,p=d.__d=!0,d.__h=[],d._sb=[]),v&&d.__s==null&&(d.__s=d.state),v&&D.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=ae({},d.__s)),ae(d.__s,D.getDerivedStateFromProps(b,d.__s))),m=d.props,_=d.state,d.__v=t,p)v&&D.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),v&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(v&&D.getDerivedStateFromProps==null&&b!==m&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(b,L),t.__v==i.__v||!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(b,d.__s,L)===!1){for(t.__v!=i.__v&&(d.props=b,d.state=d.__s,d.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.some(function(w){w&&(w.__=t)}),B=0;B<d._sb.length;B++)d.__h.push(d._sb[B]);d._sb=[],d.__h.length&&a.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(b,d.__s,L),v&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(m,_,y)})}if(d.context=L,d.props=b,d.__P=e,d.__e=!1,F=E.__r,A=0,v){for(d.state=d.__s,d.__d=!1,F&&F(t),h=d.render(d.props,d.state,d.context),C=0;C<d._sb.length;C++)d.__h.push(d._sb[C]);d._sb=[]}else do d.__d=!1,F&&F(t),h=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++A<25);d.state=d.__s,d.getChildContext!=null&&(n=ae(ae({},n),d.getChildContext())),v&&!p&&d.getSnapshotBeforeUpdate!=null&&(y=d.getSnapshotBeforeUpdate(m,_)),R=h,h!=null&&h.type===Q&&h.key==null&&(R=li(h.props.children)),l=ni(e,Ae(R)?R:[R],t,i,n,r,o,a,l,u,c),d.base=t.__e,t.__u&=-161,d.__h.length&&a.push(d),S&&(d.__E=d.__=null)}catch(w){if(t.__v=null,u||o!=null)if(w.then){for(t.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,t.__e=l}else{for(G=o.length;G--;)lt(o[G]);ht(t)}else t.__e=i.__e,t.__k=i.__k,w.then||ht(t);E.__e(w,t,i)}else o==null&&t.__v==i.__v?(t.__k=i.__k,t.__e=i.__e):l=t.__e=yn(i.__e,t,i,n,r,o,a,u,c);return(h=E.diffed)&&h(t),128&t.__u?void 0:l}function ht(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(ht)}function ai(e,t,i){for(var n=0;n<i.length;n++)ft(i[n],i[++n],i[++n]);E.__c&&E.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(o){o.call(r)})}catch(o){E.__e(o,r.__v)}})}function li(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Ae(e)?e.map(li):ae({},e)}function yn(e,t,i,n,r,o,a,l,u){var c,h,d,p,m,_,y,S=i.props||Me,b=t.props,v=t.type;if(v=="svg"?r="http://www.w3.org/2000/svg":v=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((m=o[c])&&"setAttribute"in m==!!v&&(v?m.localName==v:m.nodeType==3)){e=m,o[c]=null;break}}if(e==null){if(v==null)return document.createTextNode(b);e=document.createElementNS(r,v,b.is&&b),l&&(E.__m&&E.__m(t,o),l=!1),o=null}if(v==null)S===b||l&&e.data==b||(e.data=b);else{if(o=o&&Ne.call(e.childNodes),!l&&o!=null)for(S={},c=0;c<e.attributes.length;c++)S[(m=e.attributes[c]).name]=m.value;for(c in S)if(m=S[c],c!="children"){if(c=="dangerouslySetInnerHTML")d=m;else if(!(c in b)){if(c=="value"&&"defaultValue"in b||c=="checked"&&"defaultChecked"in b)continue;Qe(e,c,null,m,r)}}for(c in b)m=b[c],c=="children"?p=m:c=="dangerouslySetInnerHTML"?h=m:c=="value"?_=m:c=="checked"?y=m:l&&typeof m!="function"||S[c]===m||Qe(e,c,m,S[c],r);if(h)l||d&&(h.__html==d.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(d&&(e.innerHTML=""),ni(t.type=="template"?e.content:e,Ae(p)?p:[p],t,i,n,v=="foreignObject"?"http://www.w3.org/1999/xhtml":r,o,a,o?o[0]:i.__k&&Pe(i,0),l,u),o!=null)for(c=o.length;c--;)lt(o[c]);l||(c="value",v=="progress"&&_==null?e.removeAttribute("value"):_!=null&&(_!==e[c]||v=="progress"&&!_||v=="option"&&_!=S[c])&&Qe(e,c,_,S[c],r),c="checked",y!=null&&y!=e[c]&&Qe(e,c,y,S[c],r))}return e}function ft(e,t,i){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(r){E.__e(r,i)}}function ci(e,t,i){var n,r;if(E.unmount&&E.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||ft(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(o){E.__e(o,t)}n.base=n.__P=null}if(n=e.__k)for(r=0;r<n.length;r++)n[r]&&ci(n[r],t,i||typeof e.type!="function");i||lt(e.__e),e.__c=e.__=e.__e=void 0}function _n(e,t,i){return this.constructor(e,i)}function _e(e,t,i){var n,r,o,a;t==document&&(t=document.documentElement),E.__&&E.__(e,t),r=(n=!1)?null:t.__k,o=[],a=[],ut(t,e=t.__k=ct(Q,null,[e]),r||Me,Me,t.namespaceURI,r?null:t.firstChild?Ne.call(t.childNodes):null,o,r?r.__e:t.firstChild,n,a),ai(o,e,a)}function pt(e){function t(i){var n,r;return this.getChildContext||(n=new Set,(r={})[t.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(o){this.props.value!=o.value&&n.forEach(function(a){a.__e=!0,dt(a)})},this.sub=function(o){n.add(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){n&&n.delete(o),a&&a.call(o)}}),i.children}return t.__c="__cC"+ei++,t.__=e,t.Provider=t.__l=(t.Consumer=function(i,n){return i.children(n)}).contextType=t,t}Ne=ti.slice,E={__e:function(e,t,i,n){for(var r,o,a;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(e)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,n||{}),a=r.__d),a)return r.__E=r}catch(l){e=l}throw e}},Vt=0,le.prototype.setState=function(e,t){var i;i=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ae({},this.state),typeof e=="function"&&(e=e(ae({},i),this.props)),e&&ae(i,e),e!=null&&this.__v&&(t&&this._sb.push(t),dt(this))},le.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),dt(this))},le.prototype.render=Q,ye=[],Xt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Jt=function(e,t){return e.__v.__b-t.__v.__b},Ge.__r=0,Zt=/(PointerCapture)$|Capture$/i,st=0,ot=oi(!1),at=oi(!0),ei=0;var vn=0;function s(e,t,i,n,r,o){t||(t={});var a,l,u=t;if("ref"in u)for(l in u={},t)l=="ref"?a=t[l]:u[l]=t[l];var c={type:e,props:u,key:i,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--vn,__i:-1,__u:0,__source:r,__self:o};if(typeof e=="function"&&(a=e.defaultProps))for(l in a)u[l]===void 0&&(u[l]=a[l]);return E.vnode&&E.vnode(c),c}const T={fontFamily:"'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif",primary:"#3b82f6",text:"#111827",bg:"#ffffff",shadow:"0 4px 12px rgba(0, 0, 0, 0.15)",shadowHover:"0 6px 16px rgba(0, 0, 0, 0.2)",borderRadius:"8px",zIndex:{overlay:999995,guides:999996,tooltip:999997,highlight:999998,controls:1e6,badge:1000001,loading:1000002}};function bn({guide:e,top:t,left:i,arrowStyle:n,onDismiss:r}){return s("div",{className:"designer-guide-tooltip","data-guide-id":e.id,style:{position:"absolute",background:T.bg,border:`2px solid ${T.primary}`,borderRadius:T.borderRadius,padding:"12px 16px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.15)",zIndex:T.zIndex.tooltip,maxWidth:300,fontFamily:T.fontFamily,fontSize:14,lineHeight:1.5,color:T.text,top:`${t}px`,left:`${i}px`,pointerEvents:"auto"},children:[s("div",{style:{marginBottom:8},children:e.content}),s("button",{type:"button",onClick:r,style:{background:T.primary,color:T.bg,border:"none",borderRadius:4,padding:"6px 12px",fontSize:12,fontWeight:500,cursor:"pointer",transition:"background 0.2s"},children:"Got it"}),s("div",{className:"designer-guide-arrow",style:{position:"absolute",width:0,height:0,borderStyle:"solid",...n}})]})}function wn(e){const t={position:"absolute"};switch(e){case"top":return{...t,bottom:"-8px",left:"50%",transform:"translateX(-50%)",borderWidth:"8px 8px 0 8px",borderColor:`${T.primary} transparent transparent transparent`};case"bottom":return{...t,top:"-8px",left:"50%",transform:"translateX(-50%)",borderWidth:"0 8px 8px 8px",borderColor:`transparent transparent ${T.primary} transparent`};case"left":return{...t,right:"-8px",top:"50%",transform:"translateY(-50%)",borderWidth:"8px 0 8px 8px",borderColor:`transparent transparent transparent ${T.primary}`};default:return{...t,left:"-8px",top:"50%",transform:"translateY(-50%)",borderWidth:"8px 8px 8px 0",borderColor:`transparent ${T.primary} transparent transparent`}}}function di(e,t,i,n){const r=e.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,l=window.innerWidth,u=window.innerHeight;let c=0,h=0;switch(t){case"top":c=r.top+a-n-12,h=r.left+o+r.width/2-i/2;break;case"bottom":c=r.bottom+a+12,h=r.left+o+r.width/2-i/2;break;case"left":c=r.top+a+r.height/2-n/2,h=r.left+o-i-12;break;default:c=r.top+a+r.height/2-n/2,h=r.right+o+12;break}return h<o?h=o+10:h+i>o+l&&(h=o+l-i-10),c<a?c=a+10:c+n>a+u&&(c=a+u-n-10),{top:c,left:h,arrowStyle:wn(t)}}class Sn{container=null;onDismiss=()=>{};lastGuides=[];dismissedThisSession=new Set;setOnDismiss(t){this.onDismiss=t}renderGuides(t){this.lastGuides=t;const i=De(),n=t.filter(o=>o.status==="active"&&!this.dismissedThisSession.has(o.id)),r=[];for(const o of n){const a=o.steps||o.templates||[];if(a.length>0){for(const l of a)if(!(!l.is_active||!l.url||!l.x_path)&&(i.includes(l.url)||l.url.includes(i))){const u=oe.findElement(l.x_path);if(u){jt(u);const c=di(u,"right",280,80);r.push({guide:o,target:u,pos:c,stepContent:l.template?.content})}}}else if((o.page===i||o.target_page===i)&&o.selector){const l=oe.findElement(o.selector);if(l){jt(l);const u=di(l,o.placement,280,80);r.push({guide:o,target:l,pos:u})}}}if(r.length===0){this.container&&_e(null,this.container);return}this.ensureContainer(),this.container&&_e(s("div",{id:"designer-guides-container",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:T.zIndex.guides},children:r.map(({guide:o,pos:a,stepContent:l},u)=>s(bn,{guide:{...o,content:l||o.content},top:a.top,left:a.left,arrowStyle:a.arrowStyle,onDismiss:()=>this.dismissGuide(o.id)},`${o.id}-${u}`))}),this.container)}updatePositions(t){this.renderGuides(t)}dismissGuide(t){this.dismissedThisSession.add(t),this.onDismiss(t),this.renderGuides(this.lastGuides)}clear(){this.dismissedThisSession.clear(),this.container&&_e(null,this.container)}ensureContainer(){if(!this.container){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.ensureContainer());return}setTimeout(()=>this.ensureContainer(),100);return}this.container=document.createElement("div"),this.container.id="designer-guides-root",document.body.appendChild(this.container)}}}const ui=["rgba(251, 191, 36, 0.35)","rgba(34, 197, 94, 0.35)","rgba(249, 115, 22, 0.35)"];function xn({feature:e,color:t,rect:i}){return s("div",{className:"designer-feature-heatmap-overlay",title:e.featureName,style:{position:"fixed",left:i.left,top:i.top,width:i.width,height:i.height,backgroundColor:t,pointerEvents:"none",zIndex:T.zIndex.overlay,boxSizing:"border-box",borderRadius:4,border:`2px solid ${t}`}})}class En{container=null;lastEnabled=!1;render(t,i){if(this.lastEnabled=i,this.clear(),!i||t.length===0)return;const n=t.filter(o=>(o.selector||"").trim()!=="");if(this.ensureContainer(),!this.container)return;const r=n.map((o,a)=>{const l=oe.findElement(o.selector);if(!l)return null;const u=l.getBoundingClientRect(),c=ui[a%ui.length];return{feature:o,rect:u,color:c}}).filter(Boolean);r.length!==0&&_e(s("div",{id:"designer-feature-heatmap-container",style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:T.zIndex.overlay-1},children:r.map(({feature:o,rect:a,color:l})=>s(xn,{feature:o,color:l,rect:{left:a.left,top:a.top,width:a.width,height:a.height}},o.id))}),this.container)}updatePositions(t){this.render(t,this.lastEnabled)}clear(){this.container&&_e(null,this.container)}destroy(){this.clear(),this.container?.remove(),this.container=null}ensureContainer(){if(!this.container){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.ensureContainer());return}setTimeout(()=>this.ensureContainer(),100);return}this.container=document.createElement("div"),this.container.id="designer-feature-heatmap-root",document.body.appendChild(this.container)}}}var Re=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Cn={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},Tn=class{#e=Cn;#t=!1;setTimeoutProvider(e){this.#e=e}setTimeout(e,t){return this.#e.setTimeout(e,t)}clearTimeout(e){this.#e.clearTimeout(e)}setInterval(e,t){return this.#e.setInterval(e,t)}clearInterval(e){this.#e.clearInterval(e)}},ve=new Tn;function kn(e){setTimeout(e,0)}var be=typeof window>"u"||"Deno"in globalThis;function j(){}function In(e,t){return typeof e=="function"?e(t):e}function mt(e){return typeof e=="number"&&e>=0&&e!==1/0}function hi(e,t){return Math.max(e+(t||0)-Date.now(),0)}function ue(e,t){return typeof e=="function"?e(t):e}function Z(e,t){return typeof e=="function"?e(t):e}function fi(e,t){const{type:i="all",exact:n,fetchStatus:r,predicate:o,queryKey:a,stale:l}=e;if(a){if(n){if(t.queryHash!==gt(a,t.options))return!1}else if(!Le(t.queryKey,a))return!1}if(i!=="all"){const u=t.isActive();if(i==="active"&&!u||i==="inactive"&&u)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||r&&r!==t.state.fetchStatus||o&&!o(t))}function pi(e,t){const{exact:i,status:n,predicate:r,mutationKey:o}=e;if(o){if(!t.options.mutationKey)return!1;if(i){if(we(t.options.mutationKey)!==we(o))return!1}else if(!Le(t.options.mutationKey,o))return!1}return!(n&&t.state.status!==n||r&&!r(t))}function gt(e,t){return(t?.queryKeyHashFn||we)(e)}function we(e){return JSON.stringify(e,(t,i)=>yt(i)?Object.keys(i).sort().reduce((n,r)=>(n[r]=i[r],n),{}):i)}function Le(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(i=>Le(e[i],t[i])):!1}var Pn=Object.prototype.hasOwnProperty;function mi(e,t,i=0){if(e===t)return e;if(i>500)return t;const n=gi(e)&&gi(t);if(!n&&!(yt(e)&&yt(t)))return t;const o=(n?e:Object.keys(e)).length,a=n?t:Object.keys(t),l=a.length,u=n?new Array(l):{};let c=0;for(let h=0;h<l;h++){const d=n?h:a[h],p=e[d],m=t[d];if(p===m){u[d]=p,(n?h<o:Pn.call(e,d))&&c++;continue}if(p===null||m===null||typeof p!="object"||typeof m!="object"){u[d]=m;continue}const _=mi(p,m,i+1);u[d]=_,_===p&&c++}return o===l&&c===o?e:u}function je(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}function gi(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function yt(e){if(!yi(e))return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(!yi(i)||!i.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function yi(e){return Object.prototype.toString.call(e)==="[object Object]"}function Rn(e){return new Promise(t=>{ve.setTimeout(t,e)})}function _t(e,t,i){return typeof i.structuralSharing=="function"?i.structuralSharing(e,t):i.structuralSharing!==!1?mi(e,t):t}function On(e,t,i=0){const n=[...e,t];return i&&n.length>i?n.slice(1):n}function Fn(e,t,i=0){const n=[t,...e];return i&&n.length>i?n.slice(0,-1):n}var vt=Symbol();function _i(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===vt?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function bt(e,t){return typeof e=="function"?e(...t):!!e}function Dn(e,t,i){let n=!1,r;return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(r??=t(),n||(n=!0,r.aborted?i():r.addEventListener("abort",i,{once:!0})),r)}),e}var Mn=class extends Re{#e;#t;#i;constructor(){super(),this.#i=e=>{if(!be&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#i=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},wt=new Mn;function St(){let e,t;const i=new Promise((r,o)=>{e=r,t=o});i.status="pending",i.catch(()=>{});function n(r){Object.assign(i,r),delete i.resolve,delete i.reject}return i.resolve=r=>{n({status:"fulfilled",value:r}),e(r)},i.reject=r=>{n({status:"rejected",reason:r}),t(r)},i}var An=kn;function Ln(){let e=[],t=0,i=l=>{l()},n=l=>{l()},r=An;const o=l=>{t?e.push(l):r(()=>{i(l)})},a=()=>{const l=e;e=[],l.length&&r(()=>{n(()=>{l.forEach(u=>{i(u)})})})};return{batch:l=>{let u;t++;try{u=l()}finally{t--,t||a()}return u},batchCalls:l=>(...u)=>{o(()=>{l(...u)})},schedule:o,setNotifyFunction:l=>{i=l},setBatchNotifyFunction:l=>{n=l},setScheduler:l=>{r=l}}}var H=Ln(),Un=class extends Re{#e=!0;#t;#i;constructor(){super(),this.#i=e=>{if(!be&&window.addEventListener){const t=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#i=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(i=>{i(e)}))}isOnline(){return this.#e}},qe=new Un;function zn(e){return Math.min(1e3*2**e,3e4)}function vi(e){return(e??"online")==="online"?qe.isOnline():!0}var xt=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function bi(e){let t=!1,i=0,n;const r=St(),o=()=>r.status!=="pending",a=y=>{if(!o()){const S=new xt(y);p(S),e.onCancel?.(S)}},l=()=>{t=!0},u=()=>{t=!1},c=()=>wt.isFocused()&&(e.networkMode==="always"||qe.isOnline())&&e.canRun(),h=()=>vi(e.networkMode)&&e.canRun(),d=y=>{o()||(n?.(),r.resolve(y))},p=y=>{o()||(n?.(),r.reject(y))},m=()=>new Promise(y=>{n=S=>{(o()||c())&&y(S)},e.onPause?.()}).then(()=>{n=void 0,o()||e.onContinue?.()}),_=()=>{if(o())return;let y;const S=i===0?e.initialPromise:void 0;try{y=S??e.fn()}catch(b){y=Promise.reject(b)}Promise.resolve(y).then(d).catch(b=>{if(o())return;const v=e.retry??(be?0:3),M=e.retryDelay??zn,L=typeof M=="function"?M(i,b):M,B=v===!0||typeof v=="number"&&i<v||typeof v=="function"&&v(i,b);if(t||!B){p(b);return}i++,e.onFail?.(i,b),Rn(L).then(()=>c()?void 0:m()).then(()=>{t?p(b):_()})})};return{promise:r,status:()=>r.status,cancel:a,continue:()=>(n?.(),r),cancelRetry:l,continueRetry:u,canStart:h,start:()=>(h()?_():m().then(_),r)}}var wi=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),mt(this.gcTime)&&(this.#e=ve.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(be?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ve.clearTimeout(this.#e),this.#e=void 0)}},Hn=class extends wi{#e;#t;#i;#r;#n;#o;#a;constructor(e){super(),this.#a=!1,this.#o=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#r=e.client,this.#i=this.#r.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Ei(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(e){if(this.options={...this.#o,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=Ei(this.options);t.data!==void 0&&(this.setState(xi(t.data,t.dataUpdatedAt)),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#i.remove(this)}setData(e,t){const i=_t(this.state.data,e,this.options);return this.#s({data:i,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),i}setState(e,t){this.#s({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#n?.promise;return this.#n?.cancel(e),t?t.then(j).catch(j):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Z(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===vt||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ue(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!hi(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#i.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(e&&this.setOptions(e),!this.options.queryFn){const l=this.observers.find(u=>u.options.queryFn);l&&this.setOptions(l.options)}const i=new AbortController,n=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#a=!0,i.signal)})},r=()=>{const l=_i(this.options,t),c=(()=>{const h={client:this.#r,queryKey:this.queryKey,meta:this.meta};return n(h),h})();return this.#a=!1,this.options.persister?this.options.persister(l,c,this):l(c)},a=(()=>{const l={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:r};return n(l),l})();this.options.behavior?.onFetch(a,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==a.fetchOptions?.meta)&&this.#s({type:"fetch",meta:a.fetchOptions?.meta}),this.#n=bi({initialPromise:t?.initialPromise,fn:a.fetchFn,onCancel:l=>{l instanceof xt&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),i.abort()},onFail:(l,u)=>{this.#s({type:"failed",failureCount:l,error:u})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0});try{const l=await this.#n.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#i.config.onSuccess?.(l,this),this.#i.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof xt){if(l.silent)return this.#n.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#s({type:"error",error:l}),this.#i.config.onError?.(l,this),this.#i.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#s(e){const t=i=>{switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...Si(i.data,this.options),fetchMeta:e.meta??null};case"success":const n={...i,...xi(e.data,e.dataUpdatedAt),dataUpdateCount:i.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?n:void 0,n;case"error":const r=e.error;return{...i,error:r,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=t(this.state),H.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),this.#i.notify({query:this,type:"updated",action:e})})}};function Si(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:vi(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function xi(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Ei(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,i=t!==void 0,n=i?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}var Bn=class extends Re{constructor(e,t){super(),this.options=t,this.#e=e,this.#s=null,this.#a=St(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#i=void 0;#r=void 0;#n;#o;#a;#s;#m;#h;#f;#c;#d;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Ci(this.#t,this.options)?this.#u():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Et(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Et(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#w(),this.#t.removeObserver(this)}setOptions(e){const t=this.options,i=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Z(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),t._defaulted&&!je(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const n=this.hasListeners();n&&Ti(this.#t,i,this.options,t)&&this.#u(),this.updateResult(),n&&(this.#t!==i||Z(this.options.enabled,this.#t)!==Z(t.enabled,this.#t)||ue(this.options.staleTime,this.#t)!==ue(t.staleTime,this.#t))&&this.#g();const r=this.#y();n&&(this.#t!==i||Z(this.options.enabled,this.#t)!==Z(t.enabled,this.#t)||r!==this.#l)&&this.#_(r)}getOptimisticResult(e){const t=this.#e.getQueryCache().build(this.#e,e),i=this.createResult(t,e);return Nn(this,i)&&(this.#r=i,this.#o=this.options,this.#n=this.#t.state),i}getCurrentResult(){return this.#r}trackResult(e,t){return new Proxy(e,{get:(i,n)=>(this.trackProp(n),t?.(n),n==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(i,n))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#e.defaultQueryOptions(e),i=this.#e.getQueryCache().build(this.#e,t);return i.fetch().then(()=>this.createResult(i,t))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#u(e){this.#S();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(j)),t}#g(){this.#b();const e=ue(this.options.staleTime,this.#t);if(be||this.#r.isStale||!mt(e))return;const i=hi(this.#r.dataUpdatedAt,e)+1;this.#c=ve.setTimeout(()=>{this.#r.isStale||this.updateResult()},i)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(e){this.#w(),this.#l=e,!(be||Z(this.options.enabled,this.#t)===!1||!mt(this.#l)||this.#l===0)&&(this.#d=ve.setInterval(()=>{(this.options.refetchIntervalInBackground||wt.isFocused())&&this.#u()},this.#l))}#v(){this.#g(),this.#_(this.#y())}#b(){this.#c&&(ve.clearTimeout(this.#c),this.#c=void 0)}#w(){this.#d&&(ve.clearInterval(this.#d),this.#d=void 0)}createResult(e,t){const i=this.#t,n=this.options,r=this.#r,o=this.#n,a=this.#o,u=e!==i?e.state:this.#i,{state:c}=e;let h={...c},d=!1,p;if(t._optimisticResults){const C=this.hasListeners(),R=!C&&Ci(e,t),G=C&&Ti(e,i,t,n);(R||G)&&(h={...h,...Si(c.data,e.options)}),t._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:m,errorUpdatedAt:_,status:y}=h;p=h.data;let S=!1;if(t.placeholderData!==void 0&&p===void 0&&y==="pending"){let C;r?.isPlaceholderData&&t.placeholderData===a?.placeholderData?(C=r.data,S=!0):C=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,C!==void 0&&(y="success",p=_t(r?.data,C,t),d=!0)}if(t.select&&p!==void 0&&!S)if(r&&p===o?.data&&t.select===this.#m)p=this.#h;else try{this.#m=t.select,p=t.select(p),p=_t(r?.data,p,t),this.#h=p,this.#s=null}catch(C){this.#s=C}this.#s&&(m=this.#s,p=this.#h,_=Date.now(),y="error");const b=h.fetchStatus==="fetching",v=y==="pending",M=y==="error",L=v&&b,B=p!==void 0,A={status:y,fetchStatus:h.fetchStatus,isPending:v,isSuccess:y==="success",isError:M,isInitialLoading:L,isLoading:L,data:p,dataUpdatedAt:h.dataUpdatedAt,error:m,errorUpdatedAt:_,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>u.dataUpdateCount||h.errorUpdateCount>u.errorUpdateCount,isFetching:b,isRefetching:b&&!v,isLoadingError:M&&!B,isPaused:h.fetchStatus==="paused",isPlaceholderData:d,isRefetchError:M&&B,isStale:Ct(e,t),refetch:this.refetch,promise:this.#a,isEnabled:Z(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const C=A.data!==void 0,R=A.status==="error"&&!C,G=$=>{R?$.reject(A.error):C&&$.resolve(A.data)},D=()=>{const $=this.#a=A.promise=St();G($)},w=this.#a;switch(w.status){case"pending":e.queryHash===i.queryHash&&G(w);break;case"fulfilled":(R||A.data!==w.value)&&D();break;case"rejected":(!R||A.error!==w.reason)&&D();break}}return A}updateResult(){const e=this.#r,t=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#o=this.options,this.#n.data!==void 0&&(this.#f=this.#t),je(t,e))return;this.#r=t;const i=()=>{if(!e)return!0;const{notifyOnChangeProps:n}=this.options,r=typeof n=="function"?n():n;if(r==="all"||!r&&!this.#p.size)return!0;const o=new Set(r??this.#p);return this.options.throwOnError&&o.add("error"),Object.keys(this.#r).some(a=>{const l=a;return this.#r[l]!==e[l]&&o.has(l)})};this.#x({listeners:i()})}#S(){const e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;const t=this.#t;this.#t=e,this.#i=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#x(e){H.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function $n(e,t){return Z(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Ci(e,t){return $n(e,t)||e.state.data!==void 0&&Et(e,t,t.refetchOnMount)}function Et(e,t,i){if(Z(t.enabled,e)!==!1&&ue(t.staleTime,e)!=="static"){const n=typeof i=="function"?i(e):i;return n==="always"||n!==!1&&Ct(e,t)}return!1}function Ti(e,t,i,n){return(e!==t||Z(n.enabled,e)===!1)&&(!i.suspense||e.state.status!=="error")&&Ct(e,i)}function Ct(e,t){return Z(t.enabled,e)!==!1&&e.isStaleByTime(ue(t.staleTime,e))}function Nn(e,t){return!je(e.getCurrentResult(),t)}function ki(e){return{onFetch:(t,i)=>{const n=t.options,r=t.fetchOptions?.meta?.fetchMore?.direction,o=t.state.data?.pages||[],a=t.state.data?.pageParams||[];let l={pages:[],pageParams:[]},u=0;const c=async()=>{let h=!1;const d=_=>{Dn(_,()=>t.signal,()=>h=!0)},p=_i(t.options,t.fetchOptions),m=async(_,y,S)=>{if(h)return Promise.reject();if(y==null&&_.pages.length)return Promise.resolve(_);const v=(()=>{const F={client:t.client,queryKey:t.queryKey,pageParam:y,direction:S?"backward":"forward",meta:t.options.meta};return d(F),F})(),M=await p(v),{maxPages:L}=t.options,B=S?Fn:On;return{pages:B(_.pages,M,L),pageParams:B(_.pageParams,y,L)}};if(r&&o.length){const _=r==="backward",y=_?Wn:Ii,S={pages:o,pageParams:a},b=y(n,S);l=await m(S,b,_)}else{const _=e??o.length;do{const y=u===0?a[0]??n.initialPageParam:Ii(n,l);if(u>0&&y==null)break;l=await m(l,y),u++}while(u<_)}return l};t.options.persister?t.fetchFn=()=>t.options.persister?.(c,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i):t.fetchFn=c}}}function Ii(e,{pages:t,pageParams:i}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,i[n],i):void 0}function Wn(e,{pages:t,pageParams:i}){return t.length>0?e.getPreviousPageParam?.(t[0],t,i[0],i):void 0}var Gn=class extends wi{#e;#t;#i;#r;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#i=e.mutationCache,this.#t=[],this.state=e.state||Pi(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(t=>t!==e),this.scheduleGc(),this.#i.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#i.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#n({type:"continue"})},i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=bi({fn:()=>this.options.mutationFn?this.options.mutationFn(e,i):Promise.reject(new Error("No mutationFn found")),onFail:(o,a)=>{this.#n({type:"failed",failureCount:o,error:a})},onPause:()=>{this.#n({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#i.canRun(this)});const n=this.state.status==="pending",r=!this.#r.canStart();try{if(n)t();else{this.#n({type:"pending",variables:e,isPaused:r}),this.#i.config.onMutate&&await this.#i.config.onMutate(e,this,i);const a=await this.options.onMutate?.(e,i);a!==this.state.context&&this.#n({type:"pending",context:a,variables:e,isPaused:r})}const o=await this.#r.start();return await this.#i.config.onSuccess?.(o,e,this.state.context,this,i),await this.options.onSuccess?.(o,e,this.state.context,i),await this.#i.config.onSettled?.(o,null,this.state.variables,this.state.context,this,i),await this.options.onSettled?.(o,null,e,this.state.context,i),this.#n({type:"success",data:o}),o}catch(o){try{await this.#i.config.onError?.(o,e,this.state.context,this,i)}catch(a){Promise.reject(a)}try{await this.options.onError?.(o,e,this.state.context,i)}catch(a){Promise.reject(a)}try{await this.#i.config.onSettled?.(void 0,o,this.state.variables,this.state.context,this,i)}catch(a){Promise.reject(a)}try{await this.options.onSettled?.(void 0,o,e,this.state.context,i)}catch(a){Promise.reject(a)}throw this.#n({type:"error",error:o}),o}finally{this.#i.runNext(this)}}#n(e){const t=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),H.batch(()=>{this.#t.forEach(i=>{i.onMutationUpdate(e)}),this.#i.notify({mutation:this,type:"updated",action:e})})}};function Pi(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Kn=class extends Re{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#i=0}#e;#t;#i;build(e,t,i){const n=new Gn({client:e,mutationCache:this,mutationId:++this.#i,options:e.defaultMutationOptions(t),state:i});return this.add(n),n}add(e){this.#e.add(e);const t=Ve(e);if(typeof t=="string"){const i=this.#t.get(t);i?i.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=Ve(e);if(typeof t=="string"){const i=this.#t.get(t);if(i)if(i.length>1){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}else i[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Ve(e);if(typeof t=="string"){const n=this.#t.get(t)?.find(r=>r.state.status==="pending");return!n||n===e}else return!0}runNext(e){const t=Ve(e);return typeof t=="string"?this.#t.get(t)?.find(n=>n!==e&&n.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){H.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(i=>pi(t,i))}findAll(e={}){return this.getAll().filter(t=>pi(e,t))}notify(e){H.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return H.batch(()=>Promise.all(e.map(t=>t.continue().catch(j))))}};function Ve(e){return e.options.scope?.id}var Qn=class extends Re{#e;#t=void 0;#i;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#e.defaultMutationOptions(e),je(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#i,observer:this}),t?.mutationKey&&this.options.mutationKey&&we(t.mutationKey)!==we(this.options.mutationKey)?this.reset():this.#i?.state.status==="pending"&&this.#i.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#i?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#o(e)}getCurrentResult(){return this.#t}reset(){this.#i?.removeObserver(this),this.#i=void 0,this.#n(),this.#o()}mutate(e,t){return this.#r=t,this.#i?.removeObserver(this),this.#i=this.#e.getMutationCache().build(this.#e,this.options),this.#i.addObserver(this),this.#i.execute(e)}#n(){const e=this.#i?.state??Pi();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#o(e){H.batch(()=>{if(this.#r&&this.hasListeners()){const t=this.#t.variables,i=this.#t.context,n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#r.onSuccess?.(e.data,t,i,n)}catch(r){Promise.reject(r)}try{this.#r.onSettled?.(e.data,null,t,i,n)}catch(r){Promise.reject(r)}}else if(e?.type==="error"){try{this.#r.onError?.(e.error,t,i,n)}catch(r){Promise.reject(r)}try{this.#r.onSettled?.(void 0,e.error,t,i,n)}catch(r){Promise.reject(r)}}}this.listeners.forEach(t=>{t(this.#t)})})}},jn=class extends Re{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,i){const n=t.queryKey,r=t.queryHash??gt(n,t);let o=this.get(r);return o||(o=new Hn({client:e,queryKey:n,queryHash:r,options:e.defaultQueryOptions(t),state:i,defaultOptions:e.getQueryDefaults(n)}),this.add(o)),o}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){H.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(i=>fi(t,i))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(i=>fi(e,i)):t}notify(e){H.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){H.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){H.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},qn=class{#e;#t;#i;#r;#n;#o;#a;#s;constructor(e={}){this.#e=e.queryCache||new jn,this.#t=e.mutationCache||new Kn,this.#i=e.defaultOptions||{},this.#r=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=wt.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=qe.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),i=this.#e.build(this,t),n=i.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&i.isStaleByTime(ue(t.staleTime,i))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:i})=>{const n=i.data;return[t,n]})}setQueryData(e,t,i){const n=this.defaultQueryOptions({queryKey:e}),o=this.#e.get(n.queryHash)?.state.data,a=In(t,o);if(a!==void 0)return this.#e.build(this,n).setData(a,{...i,manual:!0})}setQueriesData(e,t,i){return H.batch(()=>this.#e.findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,i)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;H.batch(()=>{t.findAll(e).forEach(i=>{t.remove(i)})})}resetQueries(e,t){const i=this.#e;return H.batch(()=>(i.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const i={revert:!0,...t},n=H.batch(()=>this.#e.findAll(e).map(r=>r.cancel(i)));return Promise.all(n).then(j).catch(j)}invalidateQueries(e,t={}){return H.batch(()=>(this.#e.findAll(e).forEach(i=>{i.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const i={...t,cancelRefetch:t.cancelRefetch??!0},n=H.batch(()=>this.#e.findAll(e).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let o=r.fetch(void 0,i);return i.throwOnError||(o=o.catch(j)),r.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(n).then(j)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const i=this.#e.build(this,t);return i.isStaleByTime(ue(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(j).catch(j)}fetchInfiniteQuery(e){return e.behavior=ki(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(j).catch(j)}ensureInfiniteQueryData(e){return e.behavior=ki(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return qe.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#i}setDefaultOptions(e){this.#i=e}setQueryDefaults(e,t){this.#r.set(we(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#r.values()],i={};return t.forEach(n=>{Le(e,n.queryKey)&&Object.assign(i,n.defaultOptions)}),i}setMutationDefaults(e,t){this.#n.set(we(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#n.values()],i={};return t.forEach(n=>{Le(e,n.mutationKey)&&Object.assign(i,n.defaultOptions)}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#i.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=gt(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===vt&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#i.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},Se,U,Tt,Ri,Ye=0,Oi=[],z=E,Fi=z.__b,Di=z.__r,Mi=z.diffed,Ai=z.__c,Li=z.unmount,Ui=z.__;function Ue(e,t){z.__h&&z.__h(U,e,Ye||t),Ye=0;var i=U.__H||(U.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({}),i.__[e]}function x(e){return Ye=1,Vn(Hi,e)}function Vn(e,t,i){var n=Ue(Se++,2);if(n.t=e,!n.__c&&(n.__=[i?i(t):Hi(void 0,t),function(l){var u=n.__N?n.__N[0]:n.__[0],c=n.t(u,l);u!==c&&(n.__N=[c,n.__[1]],n.__c.setState({}))}],n.__c=U,!U.__f)){var r=function(l,u,c){if(!n.__c.__H)return!0;var h=n.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!o||o.call(this,l,u,c);var d=n.__c.props!==l;return h.forEach(function(p){if(p.__N){var m=p.__[0];p.__=p.__N,p.__N=void 0,m!==p.__[0]&&(d=!0)}}),o&&o.call(this,l,u,c)||d};U.__f=!0;var o=U.shouldComponentUpdate,a=U.componentWillUpdate;U.componentWillUpdate=function(l,u,c){if(this.__e){var h=o;o=void 0,r(l,u,c),o=h}a&&a.call(this,l,u,c)},U.shouldComponentUpdate=r}return n.__N||n.__}function N(e,t){var i=Ue(Se++,3);!z.__s&&Rt(i.__H,t)&&(i.__=e,i.u=t,U.__H.__h.push(i))}function Yn(e,t){var i=Ue(Se++,4);!z.__s&&Rt(i.__H,t)&&(i.__=e,i.u=t,U.__h.push(i))}function kt(e,t){var i=Ue(Se++,7);return Rt(i.__H,t)&&(i.__=e(),i.__H=t,i.__h=e),i.__}function te(e,t){return Ye=8,kt(function(){return e},t)}function It(e){var t=U.context[e.__c],i=Ue(Se++,9);return i.c=e,t?(i.__==null&&(i.__=!0,t.sub(U)),t.props.value):e.__}function Xn(){for(var e;e=Oi.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Xe),e.__H.__h.forEach(Pt),e.__H.__h=[]}catch(t){e.__H.__h=[],z.__e(t,e.__v)}}z.__b=function(e){U=null,Fi&&Fi(e)},z.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Ui&&Ui(e,t)},z.__r=function(e){Di&&Di(e),Se=0;var t=(U=e.__c).__H;t&&(Tt===U?(t.__h=[],U.__h=[],t.__.forEach(function(i){i.__N&&(i.__=i.__N),i.u=i.__N=void 0})):(t.__h.forEach(Xe),t.__h.forEach(Pt),t.__h=[],Se=0)),Tt=U},z.diffed=function(e){Mi&&Mi(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Oi.push(t)!==1&&Ri===z.requestAnimationFrame||((Ri=z.requestAnimationFrame)||Jn)(Xn)),t.__H.__.forEach(function(i){i.u&&(i.__H=i.u),i.u=void 0})),Tt=U=null},z.__c=function(e,t){t.some(function(i){try{i.__h.forEach(Xe),i.__h=i.__h.filter(function(n){return!n.__||Pt(n)})}catch(n){t.some(function(r){r.__h&&(r.__h=[])}),t=[],z.__e(n,i.__v)}}),Ai&&Ai(e,t)},z.unmount=function(e){Li&&Li(e);var t,i=e.__c;i&&i.__H&&(i.__H.__.forEach(function(n){try{Xe(n)}catch(r){t=r}}),i.__H=void 0,t&&z.__e(t,i.__v))};var zi=typeof requestAnimationFrame=="function";function Jn(e){var t,i=function(){clearTimeout(n),zi&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(i,35);zi&&(t=requestAnimationFrame(i))}function Xe(e){var t=U,i=e.__c;typeof i=="function"&&(e.__c=void 0,i()),U=t}function Pt(e){var t=U;e.__c=e.__(),U=t}function Rt(e,t){return!e||e.length!==t.length||t.some(function(i,n){return i!==e[n]})}function Hi(e,t){return typeof t=="function"?t(e):t}function Zn(e,t){for(var i in t)e[i]=t[i];return e}function Bi(e,t){for(var i in e)if(i!=="__source"&&!(i in t))return!0;for(var n in t)if(n!=="__source"&&e[n]!==t[n])return!0;return!1}function $i(e,t){var i=t(),n=x({t:{__:i,u:t}}),r=n[0].t,o=n[1];return Yn(function(){r.__=i,r.u=t,Ot(r)&&o({t:r})},[e,i,t]),N(function(){return Ot(r)&&o({t:r}),e(function(){Ot(r)&&o({t:r})})},[e]),i}function Ot(e){var t,i,n=e.u,r=e.__;try{var o=n();return!((t=r)===(i=o)&&(t!==0||1/t==1/i)||t!=t&&i!=i)}catch{return!0}}function Ni(e,t){this.props=e,this.context=t}(Ni.prototype=new le).isPureReactComponent=!0,Ni.prototype.shouldComponentUpdate=function(e,t){return Bi(this.props,e)||Bi(this.state,t)};var Wi=E.__b;E.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),Wi&&Wi(e)};var er=E.__e;E.__e=function(e,t,i,n){if(e.then){for(var r,o=t;o=o.__;)if((r=o.__c)&&r.__c)return t.__e==null&&(t.__e=i.__e,t.__k=i.__k),r.__c(e,t)}er(e,t,i,n)};var Gi=E.unmount;function Ki(e,t,i){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),e.__c.__H=null),(e=Zn({},e)).__c!=null&&(e.__c.__P===i&&(e.__c.__P=t),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(n){return Ki(n,t,i)})),e}function Qi(e,t,i){return e&&i&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(n){return Qi(n,t,i)}),e.__c&&e.__c.__P===t&&(e.__e&&i.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=i)),e}function Ft(){this.__u=0,this.o=null,this.__b=null}function ji(e){if(!e.__)return null;var t=e.__.__c;return t&&t.__a&&t.__a(e)}function Je(){this.i=null,this.l=null}E.unmount=function(e){var t=e.__c;t&&(t.__z=!0),t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),Gi&&Gi(e)},(Ft.prototype=new le).__c=function(e,t){var i=t.__c,n=this;n.o==null&&(n.o=[]),n.o.push(i);var r=ji(n.__v),o=!1,a=function(){o||n.__z||(o=!0,i.__R=null,r?r(u):u())};i.__R=a;var l=i.__P;i.__P=null;var u=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=Qi(c,c.__c.__P,c.__c.__O)}var h;for(n.setState({__a:n.__b=null});h=n.o.pop();)h.__P=l,h.forceUpdate()}};n.__u++||32&t.__u||n.setState({__a:n.__b=n.__v.__k[0]}),e.then(a,a)},Ft.prototype.componentWillUnmount=function(){this.o=[]},Ft.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var i=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Ki(this.__b,i,n.__O=n.__P)}this.__b=null}var r=t.__a&&ct(Q,null,e.fallback);return r&&(r.__u&=-33),[ct(Q,null,t.__a?null:e.children),r]};var qi=function(e,t,i){if(++i[1]===i[0]&&e.l.delete(t),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(i=e.i;i;){for(;i.length>3;)i.pop()();if(i[1]<i[0])break;e.i=i=i[2]}};(Je.prototype=new le).__a=function(e){var t=this,i=ji(t.__v),n=t.l.get(e);return n[0]++,function(r){var o=function(){t.props.revealOrder?(n.push(r),qi(t,e,n)):r()};i?i(o):o()}},Je.prototype.render=function(e){this.i=null,this.l=new Map;var t=Ke(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&t.reverse();for(var i=t.length;i--;)this.l.set(t[i],this.i=[1,0,this.i]);return e.children},Je.prototype.componentDidUpdate=Je.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(t,i){qi(e,i,t)})};var tr=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,ir=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,nr=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,rr=/[A-Z0-9]/g,sr=typeof document<"u",or=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};le.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(le.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})});var Vi=E.event;function ar(){}function lr(){return this.cancelBubble}function cr(){return this.defaultPrevented}E.event=function(e){return Vi&&(e=Vi(e)),e.persist=ar,e.isPropagationStopped=lr,e.isDefaultPrevented=cr,e.nativeEvent=e};var dr={enumerable:!1,configurable:!0,get:function(){return this.class}},Yi=E.vnode;E.vnode=function(e){typeof e.type=="string"&&(function(t){var i=t.props,n=t.type,r={},o=n.indexOf("-")===-1;for(var a in i){var l=i[a];if(!(a==="value"&&"defaultValue"in i&&l==null||sr&&a==="children"&&n==="noscript"||a==="class"||a==="className")){var u=a.toLowerCase();a==="defaultValue"&&"value"in i&&i.value==null?a="value":a==="download"&&l===!0?l="":u==="translate"&&l==="no"?l=!1:u[0]==="o"&&u[1]==="n"?u==="ondoubleclick"?a="ondblclick":u!=="onchange"||n!=="input"&&n!=="textarea"||or(i.type)?u==="onfocus"?a="onfocusin":u==="onblur"?a="onfocusout":nr.test(a)&&(a=u):u=a="oninput":o&&ir.test(a)?a=a.replace(rr,"-$&").toLowerCase():l===null&&(l=void 0),u==="oninput"&&r[a=u]&&(a="oninputCapture"),r[a]=l}}n=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Ke(i.children).forEach(function(c){c.props.selected=r.value.indexOf(c.props.value)!=-1})),n=="select"&&r.defaultValue!=null&&(r.value=Ke(i.children).forEach(function(c){c.props.selected=r.multiple?r.defaultValue.indexOf(c.props.value)!=-1:r.defaultValue==c.props.value})),i.class&&!i.className?(r.class=i.class,Object.defineProperty(r,"className",dr)):(i.className&&!i.class||i.class&&i.className)&&(r.class=r.className=i.className),t.props=r})(e),e.$$typeof=tr,Yi&&Yi(e)};var Xi=E.__r;E.__r=function(e){Xi&&Xi(e),e.__c};var Ji=E.diffed;E.diffed=function(e){Ji&&Ji(e);var t=e.props,i=e.__e;i!=null&&e.type==="textarea"&&"value"in t&&t.value!==i.value&&(i.value=t.value==null?"":t.value)};var Zi=pt(void 0),ze=e=>{const t=It(Zi);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},ur=({client:e,children:t})=>(N(()=>(e.mount(),()=>{e.unmount()}),[e]),s(Zi.Provider,{value:e,children:t})),en=pt(!1),hr=()=>It(en);en.Provider;function fr(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var pr=pt(fr()),mr=()=>It(pr),gr=(e,t,i)=>{const n=i?.state.error&&typeof e.throwOnError=="function"?bt(e.throwOnError,[i.state.error,i]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||n)&&(t.isReset()||(e.retryOnMount=!1))},yr=e=>{N(()=>{e.clearReset()},[e])},_r=({result:e,errorResetBoundary:t,throwOnError:i,query:n,suspense:r})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(r&&e.data===void 0||bt(i,[e.error,n])),vr=e=>{if(e.suspense){const i=r=>r==="static"?r:Math.max(r??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...r)=>i(n(...r)):i(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},br=(e,t)=>e.isLoading&&e.isFetching&&!t,wr=(e,t)=>e?.suspense&&t.isPending,tn=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});function Sr(e,t,i){const n=hr(),r=mr(),o=ze(),a=o.defaultQueryOptions(e);o.getDefaultOptions().queries?._experimental_beforeQuery?.(a);const l=o.getQueryCache().get(a.queryHash);a._optimisticResults=n?"isRestoring":"optimistic",vr(a),gr(a,r,l),yr(r);const u=!o.getQueryCache().get(a.queryHash),[c]=x(()=>new t(o,a)),h=c.getOptimisticResult(a),d=!n&&e.subscribed!==!1;if($i(te(p=>{const m=d?c.subscribe(H.batchCalls(p)):j;return c.updateResult(),m},[c,d]),()=>c.getCurrentResult()),N(()=>{c.setOptions(a)},[a,c]),wr(a,h))throw tn(a,c,r);if(_r({result:h,errorResetBoundary:r,throwOnError:a.throwOnError,query:l,suspense:a.suspense}))throw h.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(a,h),a.experimental_prefetchInRender&&!be&&br(h,n)&&(u?tn(a,c,r):l?.promise)?.catch(j).finally(()=>{c.updateResult()}),a.notifyOnChangeProps?h:c.trackResult(h)}function Ze(e,t){return Sr(e,Bn)}function xe(e,t){const i=ze(),[n]=x(()=>new Qn(i,e));N(()=>{n.setOptions(e)},[n,e]);const r=$i(te(a=>n.subscribe(H.batchCalls(a)),[n]),()=>n.getCurrentResult()),o=te((a,l)=>{n.mutate(a,l).catch(j)},[n]);if(r.error&&bt(n.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:o,mutateAsync:r.mutate}}const ne="'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif",f={root:{display:"flex",flexDirection:"column",gap:"1.5rem",maxWidth:"100%",minHeight:"100%",fontFamily:ne},header:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"1rem",borderBottom:"1px solid rgba(226,232,240,0.8)"},headerTitle:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",letterSpacing:"-0.025em",fontFamily:ne},closeBtn:{width:"2.25rem",height:"2.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"0.75rem",color:"#94a3b8",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s"},emptyState:{textAlign:"center",padding:"3rem 1.5rem",background:"linear-gradient(to bottom right, #f8fafc, rgba(239,246,255,0.5))",border:"2px dashed #e2e8f0",borderRadius:"1rem"},emptyStateIcon:{width:"4rem",height:"4rem",margin:"0 auto 1rem",borderRadius:"1rem",background:"linear-gradient(to bottom right, #dbeafe, #bfdbfe)",display:"flex",alignItems:"center",justifyContent:"center"},emptyStateText:{color:"#475569",fontSize:"0.875rem",marginBottom:"1.25rem",lineHeight:1.625},primaryBtn:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",borderRadius:"0.75rem",fontSize:"0.875rem",fontWeight:600,color:"#fff",background:"linear-gradient(to right, #3b82f6, #2563eb)",border:"none",cursor:"pointer",transition:"all 0.2s"},secondaryBtn:{flex:1,padding:"0.75rem 1.25rem",borderRadius:"0.75rem",fontSize:"0.875rem",fontWeight:600,background:"#f1f5f9",color:"#334155",border:"1px solid #e2e8f0",cursor:"pointer",transition:"all 0.2s"},section:{display:"flex",flexDirection:"column",gap:"0.5rem"},label:{fontSize:"0.875rem",fontWeight:600,color:"#475569",fontFamily:ne},selectorBox:{padding:"0.625rem 1rem",background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontFamily:"ui-monospace, monospace",fontSize:"0.75rem",color:"#334155",wordBreak:"break-all"},elementInfo:{padding:"1rem",background:"rgba(239,246,255,0.9)",border:"1px solid #bfdbfe",borderRadius:"0.75rem"},elementInfoTitle:{display:"block",marginBottom:"0.5rem",fontSize:"0.75rem",fontWeight:700,color:"#1d4ed8",textTransform:"uppercase",letterSpacing:"0.05em"},elementInfoText:{fontSize:"0.875rem",color:"rgba(29,78,216,0.9)"},textarea:{width:"100%",padding:"0.75rem 1rem",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontSize:"0.875rem",color:"#0f172a",background:"#fff",minHeight:"100px",lineHeight:1.625,resize:"vertical",fontFamily:ne},input:{width:"100%",padding:"0.75rem 1rem",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontSize:"0.875rem",color:"#0f172a",background:"#fff",fontFamily:ne},placementGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.5rem"},placementBtn:e=>({padding:"0.75rem 1rem",borderRadius:"0.75rem",fontSize:"0.875rem",fontWeight:500,cursor:"pointer",transition:"all 0.2s",...e?{background:"#3b82f6",color:"#fff",border:"none"}:{background:"#fff",color:"#475569",border:"1px solid #e2e8f0"}}),errorBox:{padding:"0.75rem 1rem",background:"#fef2f2",border:"1px solid #fee2e2",borderRadius:"0.75rem",color:"#b91c1c",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.5rem"},actionRow:{display:"flex",gap:"0.75rem",paddingTop:"1rem",marginTop:"0.5rem",borderTop:"1px solid rgba(226,232,240,0.8)"},panel:{display:"flex",flexDirection:"column",minHeight:"100%",background:"#fff"},panelHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",borderBottom:"1px solid rgba(226,232,240,0.8)",background:"rgba(248,250,252,0.5)"},panelBody:{flex:1,padding:"1.5rem",overflowY:"auto"},iconBtn:{width:"2.25rem",height:"2.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"0.75rem",color:"#94a3b8",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s"},card:{background:"#fff",borderRadius:"1rem",padding:"1.25rem",border:"1px solid rgba(226,232,240,0.8)",transition:"all 0.2s"},badge:{display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:700,padding:"0.125rem 0.625rem",flexShrink:0},sectionLabel:{fontSize:"11px",fontWeight:700,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.1em",marginBottom:"0.75rem"},tabRow:{display:"flex",gap:0,borderBottom:"1px solid rgba(226,232,240,0.8)",padding:"0 1.5rem",background:"#fff"},tab:e=>({padding:"1rem 1.25rem",fontSize:"0.875rem",fontWeight:e?600:500,color:e?"#2563eb":"#64748b",cursor:"pointer",position:"relative",background:"none",border:"none",fontFamily:ne,borderBottom:e?"2px solid #3b82f6":"2px solid transparent"}),heatmapRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.25rem 0",borderTop:"1px solid rgba(226,232,240,0.8)",marginTop:"1.5rem"},toggle:e=>({position:"relative",width:"3rem",height:"1.75rem",borderRadius:"9999px",cursor:"pointer",transition:"all 0.2s",background:e?"#10b981":"#cbd5e1",border:"none"}),toggleThumb:e=>({position:"absolute",top:"0.25rem",left:e?"1.5rem":"0.25rem",width:"1.25rem",height:"1.25rem",background:"#fff",borderRadius:"9999px",transition:"all 0.2s"}),link:{display:"inline-flex",alignItems:"center",gap:"0.375rem",color:"#2563eb",fontSize:"0.875rem",fontWeight:500,textDecoration:"none",cursor:"pointer",background:"none",border:"none",fontFamily:ne},footer:{display:"flex",gap:"0.75rem",padding:"1rem 1.5rem",borderTop:"1px solid rgba(226,232,240,0.8)",background:"rgba(248,250,252,0.5)",marginTop:"auto"},radioLabel:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.75rem",borderRadius:"0.75rem",border:"1px solid #e2e8f0",transition:"all 0.2s"},searchWrap:{position:"relative",marginBottom:"1rem"},searchIcon:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",color:"#94a3b8",fontSize:"1rem"},searchInput:{width:"100%",padding:"0.75rem 1rem 0.75rem 2.75rem",border:"1px solid #e2e8f0",borderRadius:"0.75rem",fontSize:"0.875rem",color:"#0f172a",background:"#fff",fontFamily:ne},pageItem:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1.25rem",background:"#fff",borderRadius:"1rem",border:"1px solid rgba(226,232,240,0.8)",marginBottom:"0.5rem",transition:"all 0.2s"},iconBtnSm:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"0.5rem",color:"#94a3b8",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s"},comingSoon:{padding:"2rem 0",textAlign:"center"},comingSoonIcon:{width:"4rem",height:"4rem",margin:"0 auto 1rem",borderRadius:"1rem",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center"}},xr=`
* { font-family: ${ne}; }
iconify-icon { display: inline-block; width: 1em; height: 1em; vertical-align: -0.125em; }
@keyframes editor-spin { to { transform: rotate(360deg); } }
.editor-spinner { display: inline-block; animation: editor-spin 0.8s linear infinite; }
`;function k({variant:e,children:t,onClick:i,type:n="button",title:r,active:o=!1,style:a,class:l,disabled:u,"aria-label":c}){const h=e==="primary"?f.primaryBtn:e==="secondary"?f.secondaryBtn:e==="icon"?f.iconBtn:e==="iconSm"?f.iconBtnSm:e==="placement"?f.placementBtn(o):{background:"none",border:"none",color:"#94a3b8",fontSize:"0.75rem",cursor:"pointer",padding:"0.25rem",fontFamily:ne},d=a?{...h,...a}:h;return s("button",{type:n,style:d,class:l,onClick:i,title:r,disabled:u,"aria-label":c,children:t})}const Er="https://devgw.revgain.ai/rg-pex",Dt="designerIud";function Cr(){if(typeof window>"u")return null;try{return localStorage.getItem(Dt)}catch{return null}}function et(e){const t={"Content-Type":"application/json",schema:"customer_1001",...e},i=Cr();return i&&(t.iud=i),t}const V={baseUrl:Er,async get(e,t){const i=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,n=await fetch(i,{...t,headers:{...et(),...t?.headers}});if(!n.ok)throw new Error(`API error: ${n.status} ${n.statusText}`);return n.json()},async post(e,t,i){const n=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,r=await fetch(n,{method:"POST",...i,headers:{...et(),...i?.headers},body:t!==void 0?JSON.stringify(t):void 0});if(!r.ok)throw new Error(`API error: ${r.status} ${r.statusText}`);return r.json()},async put(e,t,i){const n=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,r=await fetch(n,{method:"PUT",...i,headers:{...et(),...i?.headers},body:t!==void 0?JSON.stringify(t):void 0});if(!r.ok)throw new Error(`API error: ${r.status} ${r.statusText}`);return r.json()},async delete(e,t){const i=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?"":"/"}${e}`,n=await fetch(i,{method:"DELETE",...t,headers:{...et(),...t?.headers}});if(!n.ok)throw new Error(`API error: ${n.status} ${n.statusText}`);return n.json()}},Tr=Object.freeze(Object.defineProperty({__proto__:null,IUD_STORAGE_KEY:Dt,apiClient:V},Symbol.toStringTag,{value:"Module"})),nn=e=>["guides","byId",e];async function kr(e){const t=new URLSearchParams({guide_id:e});return V.get(`/guides?${t.toString()}`)}function Ir(e){return Ze({queryKey:nn(e),queryFn:()=>kr(e),enabled:!!e,retry:0})}const Pr=["guides","update"];async function Rr({guideId:e,payload:t}){return V.put(`/guides/${e}`,t)}function Or(){const e=ze();return xe({mutationKey:Pr,mutationFn:Rr,onSuccess:(t,i)=>{e.invalidateQueries({queryKey:nn(i.guideId)})}})}const Mt="Template",At="Description",Lt="Next";function Fr(e){try{const t=JSON.parse(e||"{}");return{title:t.title??Mt,description:t.description??At,buttonContent:t.buttonContent??Lt}}catch{return{title:Mt,description:At,buttonContent:Lt}}}function Dr(e){return e?.template_key??""}const rn={background:"#ffffff",borderRadius:8,border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1)",paddingTop:24,paddingRight:16,paddingBottom:24,paddingLeft:16,fontFamily:f.root.fontFamily};function sn({title:e=Mt,description:t=At,buttonContent:i=Lt}){return s("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:4,position:"relative"},children:[s("h3",{style:{fontSize:14,fontWeight:600,color:"#1855BC",lineHeight:1.3,margin:0},children:e}),s("p",{style:{fontSize:11,color:"#6b7280",lineHeight:1.4,margin:0},children:t}),s("div",{style:{display:"flex",justifyContent:"center",paddingTop:4},children:s("span",{style:{display:"inline-block",background:"#007AFF",color:"#fff",padding:"6px 12px",borderRadius:9999,fontWeight:600,fontSize:10},children:i})})]})}function Mr(e){return s("div",{style:{position:"relative",width:"100%",margin:"0 auto"},children:s("div",{style:{position:"relative",display:"flex",flexDirection:"column",gap:8,...rn},children:[s("div",{style:{position:"absolute",top:8,right:8,width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",color:"#6b7280"},children:s("iconify-icon",{icon:"mdi:close",style:{fontSize:14}})}),s(sn,{...e})]})})}function Ar(e){return s("div",{style:{position:"relative",width:"100%",margin:"0 auto",paddingTop:12},children:[s("div",{style:{position:"absolute",left:16,top:-15,display:"flex",justifyContent:"center"},children:s("iconify-icon",{icon:"iconamoon:arrow-up-2-light",style:{fontSize:44,color:"#1855BC"}})}),s("div",{style:{position:"relative",marginTop:0,display:"flex",flexDirection:"column",gap:8,...rn},children:[s("div",{style:{position:"absolute",top:8,right:8,width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",color:"#6b7280"},children:s("iconify-icon",{icon:"mdi:close",style:{fontSize:14}})}),s(sn,{...e})]})]})}function Lr({item:e,selected:t=!1,onClick:i,disabled:n=!1}){const r=e.template,o=kt(()=>Dr(r),[r]),a=kt(()=>Fr(r.content),[r.content]);return s("button",{type:"button",onClick:i,disabled:n,style:{width:"100%",padding:"12px",margin:0,border:t?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:12,background:t?"rgba(59, 130, 246, 0.06)":"#fff",cursor:n?"not-allowed":"pointer",opacity:n?.7:1,textAlign:"left",overflow:"hidden"},children:[s(o==="tooltip-scratch"?Ar:Mr,{title:a.title,description:a.description,buttonContent:a.buttonContent}),r.title&&s("div",{style:{padding:"8px 12px",fontSize:12,fontWeight:500,color:"#475569",borderTop:"1px solid #f1f5f9"},children:r.title})]})}function Ur({onMessage:e,elementSelected:t,guideId:i=null,templateId:n=null}){const[r,o]=x(""),[a,l]=x(void 0),[u,c]=x(null),[h,d]=x(""),[p,m]=x("right"),[_,y]=x(""),[S,b]=x(n??null),[v,M]=x(!1),[L,B]=x("on_click"),[F,A]=x(null),[C,R]=x(!1),{data:G,isLoading:D}=Ir(i),w=G?.data,$=w?.templates??[],Y=Or(),q=S?$.find(P=>P.template_id===S):null;N(()=>{w&&n&&$.some(P=>P.template_id===n)&&b(n)},[w,n,$]),N(()=>{e({type:"EDITOR_READY"})},[]),N(()=>{t?v?A({selector:t.selector,xpath:t.xpath,elementInfo:t.elementInfo}):(o(t.selector),l(t.xpath),c(t.elementInfo),d(""),y("")):v&&A(null)},[t,v]);const Ce=()=>{R(!1),o(""),l(void 0),c(null),d(""),y(""),e({type:"CLEAR_SELECTION_CLICKED"})},he=async()=>{if(!w||!i)return;const P=De(),K=a??(r&&(r.startsWith("/")||r.startsWith("//"))?r:null),ke=(w.steps??w.templates??[]).slice().sort((O,ee)=>O.step_order-ee.step_order).map(O=>({template_id:O.template_id,step_order:O.step_order,url:O.template_id===S?P:O.url??P,x_path:O.template_id===S?K:O.x_path})),se={guide_name:w.guide_name??"",description:w.description??"",target_segment:w.target_segment??null,guide_category:w.guide_category??null,target_page:w.target_page??P,type:w.type??"modal",status:w.status??"draft",priority:w.priority??0,templates:ke};y("");try{await Y.mutateAsync({guideId:i,payload:se}),Ce()}catch(O){const ee=O instanceof Error?O.message:"Failed to update guide";y(ee)}},Te=async()=>{if(!w||!i)return;const P=De(),K=F?.xpath??(F?.selector?.startsWith("/")||F?.selector?.startsWith("//")?F?.selector:null)??null,ke=(w.steps??w.templates??[]).slice().sort((O,ee)=>O.step_order-ee.step_order).map(O=>({template_id:O.template_id,step_order:O.step_order,url:O.url??P,x_path:O.x_path})),se={guide_name:w.guide_name??"",description:w.description??"",target_segment:K,guide_category:w.guide_category??null,target_page:P,type:w.type??"modal",status:w.status??"draft",priority:w.priority??0,templates:ke};y("");try{await Y.mutateAsync({guideId:i,payload:se}),Ce()}catch(O){const ee=O instanceof Error?O.message:"Failed to update guide";y(ee)}},re=P=>{const K=[];return P.tagName&&K.push(`Tag: ${P.tagName}`),P.id&&K.push(`ID: ${P.id}`),P.className&&K.push(`Class: ${P.className}`),P.textContent&&K.push(`Text: ${P.textContent}`),K.join(" | ")},J=!!i&&!!w;return s("div",{style:f.root,children:[s("div",{style:f.header,children:[s("h2",{style:f.headerTitle,children:J?w?.guide_name??"Guide":"Create Guide"}),s(k,{variant:"icon",onClick:()=>e({type:"CANCEL"}),"aria-label":"Close",children:s("iconify-icon",{icon:"mdi:close",style:{fontSize:"1.25rem"}})})]}),v?s("div",{style:{...f.section,paddingTop:"1rem",display:"flex",flexDirection:"column",gap:"1.25rem"},children:[s(k,{variant:"secondary",style:{alignSelf:"flex-start"},onClick:()=>{R(!1),M(!1),A(null),e({type:"CLEAR_SELECTION_CLICKED"})},children:[s("iconify-icon",{icon:"mdi:arrow-left",style:{marginRight:"0.5rem"}}),"Back"]}),w?.target_segment&&s("div",{style:f.section,children:[s("label",{style:f.label,children:"Current target segment"}),s("div",{style:{...f.selectorBox,marginTop:"0.5rem"},title:w.target_segment,children:w.target_segment.length>60?w.target_segment.slice(0,60)+"":w.target_segment})]}),s("div",{style:f.section,children:[s("label",{style:f.label,children:"Action"}),s("select",{value:L,onChange:P=>B(P.target.value),style:{width:"100%",marginTop:"0.5rem",padding:"0.625rem 1rem",fontFamily:f.root.fontFamily,fontSize:"0.875rem",color:"#334155",border:"1px solid #e2e8f0",borderRadius:"0.75rem",background:"#fff",cursor:"pointer"},children:[s("option",{value:"automatic",children:"Automatic"}),s("option",{value:"on_click",children:"On click"})]})]}),s("div",{style:f.section,children:[s("label",{style:f.label,children:"Trigger Element"}),F?s(Q,{children:[s("div",{style:{...f.selectorBox,marginTop:"0.5rem"},title:F.xpath??F.selector,children:(F.xpath??F.selector)||"-"}),F.elementInfo&&s("div",{style:{...f.elementInfo,marginTop:"0.5rem"},children:[s("strong",{style:f.elementInfoTitle,children:"Element Info"}),s("div",{style:f.elementInfoText,children:re(F.elementInfo)})]}),s("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:[s(k,{variant:C?"primary":"secondary",style:{flex:1},onClick:()=>{R(!0),e({type:"ACTIVATE_SELECTOR"})},children:"Re-Select"}),s(k,{variant:"secondary",style:C?void 0:{borderWidth:"2px",borderColor:"#3b82f6",background:"rgba(59, 130, 246, 0.08)",color:"#1d4ed8"},onClick:()=>{R(!1),e({type:"CLEAR_SELECTION_CLICKED"})},children:"Hide Selector"}),w?.target_segment&&s(k,{variant:"secondary",style:{flex:1,borderColor:"#ef4444",color:"#dc2626"},onClick:()=>{R(!1),A(null),e({type:"CLEAR_SELECTION_CLICKED"})},children:[s("iconify-icon",{icon:"mdi:undo",style:{marginRight:"0.25rem"}}),"Clear Trigger"]})]})]}):s(k,{variant:C?"primary":"secondary",style:{marginTop:"0.5rem"},onClick:()=>{R(!0),e({type:"ACTIVATE_SELECTOR"})},children:[s("iconify-icon",{icon:"mdi:selection-marker"}),"Select element"]})]}),s("div",{style:{...f.actionRow,marginTop:"0.5rem"},children:s(k,{variant:"primary",style:{flex:1},onClick:Te,disabled:Y.isPending,children:Y.isPending?"Updating":"Update Action"})}),_&&s("div",{style:f.errorBox,children:[s("iconify-icon",{icon:"mdi:alert-circle"}),_]})]}):s(Q,{children:i&&D?s("div",{style:{...f.emptyState,padding:"2rem"},children:[s("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"2rem",color:"#3b82f6"}}),s("p",{style:f.emptyStateText,children:"Loading guide"})]}):i&&!w?s("div",{style:{...f.emptyState,padding:"2rem"},children:[s("iconify-icon",{icon:"mdi:alert-circle",style:{fontSize:"2rem",color:"#94a3b8"}}),s("p",{style:f.emptyStateText,children:"Guide not found."})]}):J&&$.length>0?s(Q,{children:[s("div",{style:f.section,children:[s("label",{style:f.label,children:"Templates"}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"1rem"},children:$.sort((P,K)=>P.step_order-K.step_order).map(P=>s(Lr,{item:P,selected:S===P.template_id,onClick:()=>b(P.template_id)},`${P.template_id}-${P.step_order}`))})]}),s("div",{style:f.section,children:[s("label",{style:f.label,children:"Element for selected template"}),r?s(Q,{children:[s("div",{style:f.selectorBox,title:a??r,children:(a??r).length>60?(a??r).slice(0,60)+"":a??r}),u&&s("div",{style:{...f.elementInfo,marginTop:"0.5rem"},children:[s("strong",{style:f.elementInfoTitle,children:"Element Info"}),s("div",{style:f.elementInfoText,children:re(u)})]}),s("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:[s(k,{variant:C?"primary":"secondary",style:{flex:1},onClick:()=>{R(!0),e({type:"ACTIVATE_SELECTOR"})},children:"Re-Select"}),s(k,{variant:"secondary",style:C?void 0:{borderWidth:"2px",borderColor:"#3b82f6",background:"rgba(59, 130, 246, 0.08)",color:"#1d4ed8"},onClick:()=>{R(!1),e({type:"CLEAR_SELECTION_CLICKED"})},children:"Hide Selector"}),q?.x_path&&s(k,{variant:"secondary",style:{flex:1,borderColor:"#ef4444",color:"#dc2626"},onClick:Ce,children:[s("iconify-icon",{icon:"mdi:undo",style:{marginRight:"0.25rem"}}),"Clear Selection"]})]}),s("div",{style:{...f.actionRow,marginTop:"1rem",borderTop:"none",paddingTop:0},children:s(k,{variant:"primary",style:{flex:1},onClick:he,disabled:Y.isPending,children:Y.isPending?"Updating":"Update"})})]}):q?.x_path?s(Q,{children:[s("div",{style:f.selectorBox,title:q.x_path,children:q.x_path.length>60?q.x_path.slice(0,60)+"":q.x_path}),s("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:[s(k,{variant:C?"primary":"secondary",style:{flex:1},onClick:()=>{R(!0),e({type:"ACTIVATE_SELECTOR"})},children:"Re-Select"}),s(k,{variant:"secondary",style:C?void 0:{borderWidth:"2px",borderColor:"#3b82f6",background:"rgba(59, 130, 246, 0.08)",color:"#1d4ed8"},onClick:()=>{R(!1),e({type:"CLEAR_SELECTION_CLICKED"})},children:"Hide Selector"})]}),s("div",{style:{...f.actionRow,marginTop:"1rem",borderTop:"none",paddingTop:0},children:s(k,{variant:"primary",style:{flex:1},onClick:he,disabled:Y.isPending,children:Y.isPending?"Updating":"Update"})})]}):s(k,{variant:C?"primary":"secondary",onClick:()=>{R(!0),e({type:"ACTIVATE_SELECTOR"})},children:[s("iconify-icon",{icon:"mdi:selection-marker"}),"Select element"]})]}),s("div",{style:{...f.actionRow,marginTop:"0.5rem"},children:s(k,{variant:"primary",onClick:()=>M(!0),children:"Next"})}),J&&_&&s("div",{style:f.errorBox,children:[s("iconify-icon",{icon:"mdi:alert-circle"}),_]})]}):null})]})}function He({type:e="text",value:t,onInput:i,placeholder:n,id:r,style:o,disabled:a,"aria-label":l}){const u=o?{...f.input,...o}:f.input;return s("input",{type:e,value:t,onInput:i,placeholder:n,id:r,style:u,disabled:a,"aria-label":l})}function on({value:e,onInput:t,placeholder:i,id:n,minHeight:r,style:o,disabled:a,"aria-label":l}){const u=o?{...f.textarea,...o,...r!=null&&{minHeight:typeof r=="number"?`${r}px`:r}}:r!=null?{...f.textarea,minHeight:typeof r=="number"?`${r}px`:r}:f.textarea;return s("textarea",{value:e,onInput:t,placeholder:i,id:n,style:u,disabled:a,"aria-label":l})}const zr=["pages","create"];async function Hr(e){return V.post("/pages",{name:e.name,slug:e.slug,description:e.description,status:"active"})}function Br(){return xe({mutationKey:zr,mutationFn:Hr})}const $r=["pages","update"];async function Nr({pageId:e,payload:t}){return V.put(`/pages/${e}`,{name:t.name,slug:t.slug,description:t.description,status:t.status??"active"})}function Wr(){return xe({mutationKey:$r,mutationFn:Nr})}const Gr=["pages","delete"];async function Kr(e){return V.delete(`/pages/${e}`)}function Qr(){return xe({mutationKey:Gr,mutationFn:Kr})}const jr=e=>["pages","check-slug",e];async function qr(e){return V.get(`/pages/check-slug?slug=${encodeURIComponent(e)}`)}function Vr(e){return Ze({queryKey:jr(e),queryFn:()=>qr(e),enabled:!!e,retry:0})}const Yr=["pages","list"];async function Xr(){return V.get("/pages")}function Jr(){return Ze({queryKey:Yr,queryFn:Xr,retry:0})}const Zr="designerTaggedPages",tt=["pages","check-slug"],Ut=["pages","list"];function it(){try{const t=(typeof window<"u"&&window.parent!==window?window.parent:window).location;return(t.host||t.hostname||"")+(t.pathname||"/")+(t.search||"")+(t.hash||"")}catch{return typeof window<"u"&&window.parent!==window?window.parent.location.href:window.location.href||""}}function nt(){try{const t=(typeof window<"u"&&window.parent!==window?window.parent:window).location,i=(t.pathname||"/").replace(/^\//,""),n=t.search||"",r=t.hash||"";return"//*/"+i+n+r}catch{return"//*/"}}function es({onMessage:e}){const[t,i]=x("overviewUntagged"),[n,r]=x(""),[o,a]=x(""),[l,u]=x(""),[c,h]=x(!1),[d,p]=x("create"),[m,_]=x(""),[y,S]=x(""),[b,v]=x("suggested"),[M,L]=x(""),[B,F]=x(!1),[A,C]=x(null),[R,G]=x(!1),D=ze(),w=Br(),$=Wr(),Y=Qr(),{data:q,isLoading:Ce,isError:he}=Vr(n),{data:Te,isLoading:re}=Jr(),J=!!n&&Ce,P=w.isPending||$.isPending,K=(n||"").trim().toLowerCase(),se=(Te?.data??[]).filter(I=>(I.slug||"").trim().toLowerCase()===K).filter(I=>(I.name||"").toLowerCase().includes(l.toLowerCase().trim())),O=te(()=>{i("overviewUntagged"),a(it()||"(current page)"),h(!1),D.invalidateQueries({queryKey:tt})},[D]),ee=te(()=>{i("taggedPagesDetailView"),u("")},[]),Oe=te(()=>{C(null),i("tagPageFormView"),h(!0),L(nt()),_(""),S(""),p("create"),v("suggested"),F(!1)},[]),Gt=te(I=>{C(I.page_id),i("tagPageFormView"),h(!0),L(I.slug||nt()),_(I.name||""),S(I.description||""),p("create"),v("suggested"),F(!1)},[]);N(()=>{e({type:"EDITOR_READY"})},[]),N(()=>{r(nt()),a(it()||"(current page)")},[]),N(()=>{if(!n){i("overviewUntagged");return}if(he){(t==="overviewTagged"||t==="overviewUntagged")&&i("overviewUntagged");return}q!==void 0&&(t==="overviewTagged"||t==="overviewUntagged")&&i(q.exists?"overviewTagged":"overviewUntagged")},[n,q,he,t]),N(()=>{let I=it();const fe=()=>{const me=it();me!==I&&(I=me,r(nt()),a(me||"(current page)"),i("overviewUntagged"))},pe=()=>fe(),Fe=()=>fe();window.addEventListener("hashchange",pe),window.addEventListener("popstate",Fe);const $e=setInterval(fe,1500);return()=>{window.removeEventListener("hashchange",pe),window.removeEventListener("popstate",Fe),clearInterval($e)}},[]);const rt=async()=>{const I=m.trim();if(!I){F(!0);return}F(!1);const fe=typeof window<"u"&&window.parent!==window?window.parent.location.pathname:window.location.pathname,pe=M.trim()||fe||"/";try{if(A)await $.mutateAsync({pageId:A,payload:{name:I,slug:pe,description:y.trim()||void 0,status:"active"}}),C(null),D.invalidateQueries({queryKey:tt}),D.invalidateQueries({queryKey:Ut}),O();else{const Fe=typeof window<"u"&&window.parent!==window?window.parent.location.href:window.location.href,$e=M.trim()||Fe;await w.mutateAsync({name:I,slug:pe,description:y.trim()||void 0});const me=Zr,Kt=localStorage.getItem(me)||"[]",g=JSON.parse(Kt);g.push({pageName:I,url:$e}),localStorage.setItem(me,JSON.stringify(g)),D.invalidateQueries({queryKey:tt}),D.invalidateQueries({queryKey:Ut}),i("overviewTagged"),h(!1)}}catch{}},de=async I=>{if(window.confirm("Delete this page?"))try{await Y.mutateAsync(I),D.invalidateQueries({queryKey:tt}),D.invalidateQueries({queryKey:Ut})}catch{}},Ie={display:"flex",flexDirection:"column",flex:1,gap:"1rem"};return R?s("div",{style:{...f.panel,padding:"0.5rem"},children:s("div",{style:f.panelHeader,children:[s("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:"Tag Page"}),s("div",{style:{display:"flex",gap:"0.25rem"},children:s(k,{variant:"icon",title:"Expand",onClick:()=>G(!1),children:s("iconify-icon",{icon:"mdi:plus",style:{fontSize:"1.25rem",color:"#64748b"}})})})]})}):s("div",{style:f.panel,children:[s("div",{style:f.panelHeader,children:[s("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:"Tag Page"}),s("div",{style:{display:"flex",gap:"0.25rem"},children:s(k,{variant:"icon",title:"Minimize",onClick:()=>G(!0),children:s("iconify-icon",{icon:"mdi:window-minimize",style:{fontSize:"1.125rem"}})})})]}),s("div",{style:f.panelBody,children:[J&&(t==="overviewTagged"||t==="overviewUntagged")&&s("div",{style:{...Ie,alignItems:"center",justifyContent:"center",padding:"2rem",color:"#64748b",fontSize:"0.875rem"},children:[s("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.5rem",marginBottom:"0.5rem"}}),s("span",{children:"Checking page"})]}),!J&&t==="overviewTagged"&&s("div",{style:Ie,children:[s("div",{style:f.sectionLabel,children:"PAGES OVERVIEW"}),s("div",{style:{...f.card,marginBottom:"1rem",cursor:"pointer"},onClick:ee,children:s("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,minWidth:0},children:[s("div",{style:{display:"flex",gap:"1rem",flex:1,minWidth:0},children:[s("span",{style:{...f.badge,background:"#10b981",color:"#fff"},children:"Tagged"}),s("div",{style:{minWidth:0},children:[s("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1e293b"},children:"Current URL"}),s("div",{style:{fontSize:"0.875rem",color:"#64748b",marginTop:"0.125rem",wordBreak:"break-all"},children:o})]})]}),s("iconify-icon",{icon:"mdi:chevron-right",style:{color:"#94a3b8",fontSize:"1.25rem",flexShrink:0}})]})}),s(k,{variant:"primary",style:{width:"100%"},onClick:Oe,children:"Tag Page"})]}),t==="taggedPagesDetailView"&&s("div",{style:Ie,children:[s("a",{href:"#",style:f.link,onClick:I=>{I.preventDefault(),O()},children:[s("iconify-icon",{icon:"mdi:arrow-left"})," Back to overview"]}),s("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[s("span",{style:{...f.badge,background:"#3b82f6",color:"#fff",minWidth:"1.5rem",height:"1.5rem"},children:re?"":se.length}),s("h3",{style:{fontSize:"1rem",fontWeight:700,color:"#1e293b"},children:"Current URL"})]}),s("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1rem"},children:"List of tagged Pages on this URL"}),s("div",{style:f.searchWrap,children:[s("iconify-icon",{icon:"mdi:magnify",style:f.searchIcon}),s(He,{type:"text",placeholder:"Search Pages",value:l,onInput:I=>u(I.target.value),style:f.searchInput}),l&&s(k,{variant:"ghost",style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)"},onClick:()=>u(""),children:"Clear"})]}),re?s("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1.5rem",color:"#64748b",fontSize:"0.875rem"},children:[s("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.25rem",marginRight:"0.5rem"}}),s("span",{children:"Loading pages"})]}):se.map(I=>s("div",{style:{...f.pageItem,marginBottom:"0.5rem",alignItems:"center"},children:[s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#1e293b",flex:1},children:I.name||"Unnamed"}),s("div",{style:{display:"flex",gap:"0.25rem"},children:[s(k,{variant:"iconSm",title:"Edit",onClick:()=>Gt(I),children:s("iconify-icon",{icon:"mdi:pencil"})}),s(k,{variant:"iconSm",title:"Delete",onClick:()=>de(I.page_id),children:s("iconify-icon",{icon:"mdi:delete-outline"})})]})]},I.page_id)),s(k,{variant:"primary",style:{width:"100%",marginTop:"1rem"},onClick:Oe,children:"Tag Page"})]}),!J&&t==="overviewUntagged"&&s("div",{style:{...Ie,textAlign:"center",padding:"2.5rem 1.5rem"},children:[s("div",{style:{...f.emptyStateIcon,width:"6rem",height:"6rem",marginBottom:"1.5rem",background:"linear-gradient(to bottom right, #dbeafe, #bfdbfe, #93c5fd)"},children:s("iconify-icon",{icon:"mdi:tag-plus",style:{fontSize:"3rem",color:"#3b82f6"}})}),s("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",marginBottom:"0.5rem"},children:"Let's start tagging!"}),s("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"2rem",lineHeight:1.625,maxWidth:"20rem",margin:"0 auto 2rem"},children:"Start by first tagging this page and then features to get going."}),s(k,{variant:"primary",style:{width:"100%",maxWidth:"20rem",margin:"0 auto"},onClick:Oe,children:"Tag Page"})]}),t==="tagPageFormView"&&s("div",{style:{...Ie,gap:"1.5rem"},children:[s("a",{href:"#",style:f.link,onClick:I=>{I.preventDefault(),C(null),O(),h(!1)},children:[s("iconify-icon",{icon:"mdi:arrow-left"})," Back"]}),s("div",{children:[s("div",{style:f.sectionLabel,children:A?"EDIT PAGE":"PAGE SETUP"}),!A&&s("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"pageSetup",value:"create",checked:d==="create",onChange:()=>p("create"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Create New Page"})]}),s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"pageSetup",value:"merge",checked:d==="merge",onChange:()=>p("merge"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Merge with Existing"})]})]}),s("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:[s("div",{children:[s("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:["Page Name ",s("span",{style:{color:"#ef4444"},children:"*"})]}),s(He,{type:"text",placeholder:"Enter page name",value:m,onInput:I=>_(I.target.value)}),B&&s("p",{style:{fontSize:"0.875rem",color:"#dc2626",marginTop:"0.375rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[s("iconify-icon",{icon:"mdi:alert-circle"})," Please enter a page name."]})]}),s("div",{children:[s("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:"Description"}),s(on,{placeholder:"Click to add description",value:y,onInput:I=>S(I.target.value),minHeight:"5rem"})]})]})]}),s("div",{children:[s("div",{style:{...f.sectionLabel,display:"flex",alignItems:"center",gap:"0.25rem"},children:["INCLUDE PAGE RULES",s("span",{style:{color:"#94a3b8"},title:"Define how this page is identified",children:s("iconify-icon",{icon:"mdi:information-outline"})})]}),s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[s("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"#334155"},children:"Include Rule 1"}),s(k,{variant:"iconSm",children:s("iconify-icon",{icon:"mdi:delete-outline"})})]}),s("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"ruleType",value:"suggested",checked:b==="suggested",onChange:()=>v("suggested"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Suggested Match"})]}),s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"ruleType",value:"exact",checked:b==="exact",onChange:()=>v("exact"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Exact Match"})]}),s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"ruleType",value:"builder",checked:b==="builder",onChange:()=>v("builder"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Rule Builder"})]})]}),s("div",{children:[s("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:"Selection URL"}),s(He,{type:"text",placeholder:"e.g. //*/path/to/page",value:M,onInput:I=>L(I.target.value)})]})]})]})]}),c&&s("div",{style:f.footer,children:[s(k,{variant:"secondary",onClick:()=>{C(null),O()},disabled:P,children:"Cancel"}),s(k,{variant:"primary",style:{flex:1},onClick:rt,disabled:P,children:P?s(Q,{children:[s("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.125rem",marginRight:"0.375rem"}}),A?"Updating":"Saving"]}):A?"Update":"Save"})]})]})}const ts=["features","create"];async function is(e){return V.post("/features",e)}function ns(){return xe({mutationKey:ts,mutationFn:is})}const rs=["features","update"];async function ss({featureId:e,payload:t}){return V.put(`/features/${e}`,t)}function os(){return xe({mutationKey:rs,mutationFn:ss})}const as=["features","delete"];async function ls(e){return V.delete(`/features/${e}`)}function cs(){return xe({mutationKey:as,mutationFn:ls})}const Be=["features","list"];async function ds(){const e=await V.get("/features");return Array.isArray(e)?{data:e}:e}function us(){return Ze({queryKey:Be,queryFn:ds,retry:0})}const an="designerHeatmapEnabled";function hs({onMessage:e,elementSelected:t}){const[i,n]=x("overview"),[r,o]=x(!1),[a,l]=x(""),[u,c]=x(null),[h,d]=x(""),[p,m]=x(!1),[_,y]=x(!1),[S,b]=x(!1),[v,M]=x(!1),[L,B]=x(!1),[F,A]=x("create"),[C,R]=x("suggested"),[G,D]=x(""),[w,$]=x(""),[Y,q]=x(null),[Ce,he]=x(null),[Te,re]=x(""),J=ze(),P=ns(),K=os(),ke=cs(),{data:se,isLoading:O}=us(),ee=P.isPending||K.isPending||ke.isPending,Oe=se?.data??[],Gt=Oe.length,rt=Oe.filter(g=>(g.name||"").toLowerCase().includes(Te.toLowerCase().trim())).sort((g,X)=>(g.name||"").localeCompare(X.name||"",void 0,{sensitivity:"base"})),de=te(()=>{n("overview"),o(!1),l(""),c(null),$(""),d(""),m(!1),q(null),re(""),J.invalidateQueries({queryKey:Be})},[J]),Ie=te(()=>{n("taggedList"),re("")},[]),I=te(g=>g.rules?.find(ge=>ge.selector_type==="xpath"&&(ge.selector_value??"").trim()!=="")?.selector_value??"",[]),fe=te(g=>{n("form"),o(!0),g?(q(g.feature_id),d(g.name||""),D(g.description||""),$(I(g)),R("exact")):(q(null),d(""),D(""),$(t?.xpath||""),l(t?.selector||""),c(t?.elementInfo||null)),m(!1)},[t,I]);N(()=>{e({type:"EDITOR_READY"})},[]),N(()=>{e({type:"FEATURES_FOR_HEATMAP",features:se?.data??[]})},[se,e]),N(()=>{const g=localStorage.getItem(an)==="true";y(g)},[]),N(()=>{t?(l(t.selector),c(t.elementInfo),$(t.xpath||""),o(!0),n("form"),d(""),m(!1),A("create"),D(""),R("exact")):de()},[t]);const pe=()=>{const g=!_;y(g);try{localStorage.setItem(an,String(g))}catch{}e({type:"HEATMAP_TOGGLE",enabled:g})},Fe=g=>g.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),$e=async()=>{const g=h.trim();if(!g){m(!0);return}m(!1);const X=w||t?.xpath||"";if(C==="exact"){if(!X)return;const ge={name:g,slug:Fe(g),description:G.trim()||"",status:"active",rules:[{selector_type:"xpath",selector_value:X,match_mode:"exact",priority:10,is_active:!0}]};try{Y?(await K.mutateAsync({featureId:Y,payload:ge}),J.invalidateQueries({queryKey:Be}),de()):(await P.mutateAsync(ge),J.invalidateQueries({queryKey:Be}),de())}catch{}return}},me=async g=>{if(window.confirm("Delete this feature?")){he(g);try{await ke.mutateAsync(g),J.invalidateQueries({queryKey:Be}),Y===g&&(q(null),de())}catch{}finally{he(null)}}},Kt=g=>{const X=[];g.tagName&&X.push(`Tag: ${g.tagName}`),g.id&&X.push(`ID: ${g.id}`),g.className&&X.push(`Class: ${g.className}`);const ge=(g.textContent||"").slice(0,80);return ge&&X.push(`Text: ${ge}`),X.join(" | ")};return S?s("div",{style:{...f.panel,padding:"0.5rem"},children:s("div",{style:f.panelHeader,children:[s("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:r?"Tag Feature":"Tag Features"}),s("div",{style:{display:"flex",gap:"0.25rem"},children:s(k,{variant:"icon",title:"Expand",onClick:()=>b(!1),children:s("iconify-icon",{icon:"mdi:plus",style:{fontSize:"1.25rem",color:"#64748b"}})})})]})}):s("div",{style:f.panel,children:[s("div",{style:f.panelHeader,children:[s("h2",{style:{...f.headerTitle,fontSize:"1.125rem"},children:"Tag Features"}),s("div",{style:{display:"flex",gap:"0.25rem"},children:s(k,{variant:"icon",title:"Minimize",onClick:()=>b(!0),children:s("iconify-icon",{icon:"mdi:window-minimize",style:{fontSize:"1.125rem"}})})})]}),s("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem",background:"linear-gradient(to bottom, rgba(248,250,252,0.8), #fff)"},children:r?s("div",{style:{display:"flex",flexDirection:"column",minHeight:"100%"},children:[s("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem"},children:s("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[s("a",{href:"#",style:f.link,onClick:g=>{g.preventDefault(),de()},children:[s("iconify-icon",{icon:"mdi:arrow-left"})," Back"]}),s("div",{children:[s("div",{style:f.sectionLabel,children:"FEATURE SETUP"}),s("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"featureSetup",checked:F==="create",onChange:()=>A("create"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Create new Feature"})]}),s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"featureSetup",checked:F==="merge",onChange:()=>A("merge"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Merge with existing"})]})]}),s("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:[s("div",{children:[s("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:["Feature name ",s("span",{style:{color:"#ef4444"},children:"*"})]}),s(He,{type:"text",placeholder:"e.g. report-designer-data-table-grid Link",value:h,onInput:g=>d(g.target.value)}),p&&s("p",{style:{fontSize:"0.875rem",color:"#dc2626",marginTop:"0.375rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[s("iconify-icon",{icon:"mdi:alert-circle"})," Please enter a feature name."]})]}),s("div",{children:[s("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:"Description"}),s(on,{placeholder:"Describe your Feature",value:G,onInput:g=>D(g.target.value),minHeight:"5rem"})]})]})]}),s("div",{children:[s("div",{style:{...f.sectionLabel,display:"flex",alignItems:"center",gap:"0.25rem"},children:["FEATURE ELEMENT MATCHING",s("span",{style:{color:"#94a3b8"},title:"Match the element for this feature",children:s("iconify-icon",{icon:"mdi:information-outline"})})]}),s("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.25rem"},children:[s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"featureMatch",checked:C==="suggested",onChange:()=>R("suggested"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Suggested match"})]}),s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"featureMatch",checked:C==="ruleBuilder",onChange:()=>R("ruleBuilder"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Rule builder"})]}),s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"featureMatch",checked:C==="customCss",onChange:()=>R("customCss"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Custom CSS"})]}),s("label",{style:f.radioLabel,children:[s("input",{type:"radio",name:"featureMatch",checked:C==="exact",onChange:()=>R("exact"),style:{accentColor:"#3b82f6"}}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Exact match"})]})]}),s("div",{children:[s("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"0.5rem"},children:C==="exact"?"XPath":"Selection"}),s("div",{style:f.selectorBox,children:C==="exact"?(t?.xpath??w)||"-":(t?.selector??a)||"-"})]}),u&&s("div",{style:{marginTop:"1rem"},children:[s("button",{type:"button",style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:0,border:"none",background:"none",cursor:"pointer",fontFamily:"inherit",textAlign:"left"},onClick:()=>B(g=>!g),"aria-expanded":L,children:[s("label",{style:{...f.label,marginBottom:0,cursor:"pointer"},children:"Element info"}),s("iconify-icon",{icon:L?"mdi:chevron-up":"mdi:chevron-down",style:{fontSize:"1.125rem",color:"#64748b",flexShrink:0}})]}),L&&s("div",{style:{...f.elementInfo,marginTop:"0.5rem"},children:s("div",{style:f.elementInfoText,children:Kt(u)})})]})]})]})}),s("div",{style:f.footer,children:[s(k,{variant:"secondary",onClick:de,children:"Cancel"}),s(k,{variant:"primary",style:{flex:1},onClick:$e,disabled:ee,children:ee?"Saving...":"Save"})]})]}):s("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:i==="taggedList"?s(Q,{children:[s("a",{href:"#",style:f.link,onClick:g=>{g.preventDefault(),de()},children:[s("iconify-icon",{icon:"mdi:arrow-left"})," Back to overview"]}),s("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[s("span",{style:{...f.badge,background:"#3b82f6",color:"#fff",minWidth:"1.75rem",height:"1.75rem"},children:O?"":rt.length}),s("h3",{style:{fontSize:"1rem",fontWeight:700,color:"#1e293b"},children:"Tagged Features"})]}),s("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1rem"},children:"List of tagged features"}),s("div",{style:f.searchWrap,children:[s("iconify-icon",{icon:"mdi:magnify",style:f.searchIcon}),s(He,{type:"text",placeholder:"Search features",value:Te,onInput:g=>re(g.target.value),style:f.searchInput}),Te&&s(k,{variant:"ghost",style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)"},onClick:()=>re(""),children:"Clear"})]}),O?s("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1.5rem",color:"#64748b",fontSize:"0.875rem"},children:[s("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.25rem",marginRight:"0.5rem"}}),s("span",{children:"Loading features"})]}):rt.map(g=>{const X=Ce===g.feature_id;return s("div",{style:{...f.pageItem,marginBottom:"0.5rem",alignItems:"center"},children:[s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#1e293b",flex:1},children:g.name||"Unnamed"}),s("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center"},children:[s(k,{variant:"iconSm",title:"Edit",onClick:()=>fe(g),disabled:X,children:s("iconify-icon",{icon:"mdi:pencil"})}),X?s("span",{style:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center"},children:s("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.25rem",color:"#64748b"}})}):s(k,{variant:"iconSm",title:"Delete",onClick:()=>me(g.feature_id),children:s("iconify-icon",{icon:"mdi:delete-outline"})})]})]},g.feature_id)}),s(k,{variant:"primary",style:{width:"100%",marginTop:"1rem"},onClick:()=>fe(),children:"Tag Feature"})]}):O?s("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",color:"#64748b",fontSize:"0.875rem"},children:[s("iconify-icon",{icon:"mdi:loading",className:"editor-spinner",style:{fontSize:"1.5rem",marginBottom:"0.75rem"}}),s("span",{children:"Loading features"})]}):s(Q,{children:[s("div",{style:f.sectionLabel,children:"FEATURES OVERVIEW"}),s("div",{style:{...f.card,marginBottom:"0.75rem"},children:s("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s("div",{style:{display:"flex",gap:"1rem",flex:1,minWidth:0},children:[s("span",{style:{...f.badge,background:"#14b8a6",color:"#fff",minWidth:"1.75rem",height:"1.75rem"},children:"0"}),s("div",{style:{flex:1,minWidth:0},children:[s("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1e293b",marginBottom:"0.125rem"},children:"Suggested Features"}),s("div",{style:{fontSize:"0.75rem",color:"#64748b",lineHeight:1.375},children:"List of untagged elements on this page"})]})]}),s("iconify-icon",{icon:"mdi:chevron-right",style:{color:"#94a3b8",fontSize:"1.25rem",flexShrink:0}})]})}),s("div",{style:{...f.card,marginBottom:"0.75rem",cursor:"pointer"},onClick:Ie,children:s("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s("div",{style:{display:"flex",gap:"1rem",flex:1,minWidth:0},children:[s("span",{style:{...f.badge,background:"#3b82f6",color:"#fff",minWidth:"1.75rem",height:"1.75rem"},children:Gt}),s("div",{style:{flex:1,minWidth:0},children:[s("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1e293b",marginBottom:"0.125rem"},children:"Tagged Features"}),s("div",{style:{fontSize:"0.75rem",color:"#64748b",lineHeight:1.375},children:"List of tagged Features on this page"})]})]}),s("iconify-icon",{icon:"mdi:chevron-right",style:{color:"#94a3b8",fontSize:"1.25rem",flexShrink:0}})]})}),s("div",{style:f.heatmapRow,children:[s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#334155"},children:"Heatmap"}),s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s("button",{role:"switch",tabIndex:0,style:f.toggle(_),onClick:pe,onKeyDown:g=>g.key==="Enter"&&pe(),children:s("span",{style:f.toggleThumb(_)})}),s(k,{variant:"icon",style:{border:"1px solid #e2e8f0",borderRadius:"0.75rem"},children:s("iconify-icon",{icon:"mdi:plus",style:{fontSize:"1.125rem"}})})]})]}),s("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:[s(k,{variant:v?"primary":"secondary",style:{flex:1},onClick:()=>{M(!0),e({type:"TAG_FEATURE_CLICKED"})},children:"Re-Select"}),s(k,{variant:"secondary",style:v?void 0:{borderWidth:"2px",borderColor:"#3b82f6",background:"rgba(59, 130, 246, 0.08)",color:"#1d4ed8"},onClick:()=>{M(!1),e({type:"CLEAR_SELECTION_CLICKED"})},children:"Hide Selector"})]})]})})})]})}const fs=new qn({defaultOptions:{mutations:{retry:0}}});class ps{iframe=null;dragHandle=null;gripButton=null;messageCallback=null;isReady=!1;mode=null;guideId=null;templateId=null;elementSelectedState=null;tagPageSavedAckCounter=0;isDragging=!1;dragStartX=0;dragStartY=0;dragThreshold=3;mouseDownX=0;mouseDownY=0;isMouseDown=!1;create(t,i,n){if(console.log("[Visual Designer] EditorFrame.create() called with mode:",i),this.iframe){console.warn("[Visual Designer] EditorFrame already created, skipping");return}this.mode=i||null,this.guideId=n?.guideId??null,this.templateId=n?.templateId??null,this.messageCallback=t,console.log("[Visual Designer] Creating editor iframe with mode:",this.mode),this.iframe=document.createElement("iframe"),this.iframe.id="designer-editor-frame",this.iframe.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 600px;
      height: 800px;
      max-height: 90vh;
      border: none;
      border-radius: 16px;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
      z-index: 999999;
      display: none;
      overflow: hidden;
    `,this.createDragHandle(),this.loadEditorHtml(),window.addEventListener("message",this.handleMessage);const r=()=>{document.body?(document.body.appendChild(this.iframe),this.dragHandle&&document.body.appendChild(this.dragHandle),this.iframe&&(this.iframe.onload=()=>{this.isReady=!0,this.renderEditorContent(),this.updateDragHandlePosition()})):document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):setTimeout(r,100)};r()}show(){console.log("[Visual Designer] EditorFrame.show() called"),this.iframe?(console.log("[Visual Designer] Showing iframe"),this.iframe.style.display="block",this.updateDragHandlePosition()):console.warn("[Visual Designer] Cannot show iframe - iframe is null"),this.dragHandle?(console.log("[Visual Designer] Showing drag handle"),this.dragHandle.style.display="block"):console.warn("[Visual Designer] Cannot show drag handle - dragHandle is null")}hide(){this.iframe&&(this.iframe.style.display="none"),this.dragHandle&&(this.dragHandle.style.display="none")}sendElementSelected(t){this.elementSelectedState={selector:t.selector,elementInfo:t.elementInfo,xpath:t.xpath},this.renderEditorContent(),this.show()}sendClearSelectionAck(){this.elementSelectedState=null,this.renderEditorContent()}sendTagPageSavedAck(){this.tagPageSavedAckCounter+=1,this.renderEditorContent()}destroy(){window.removeEventListener("message",this.handleMessage),document.removeEventListener("mousemove",this.handleMouseMove,!0),document.removeEventListener("mouseup",this.handleMouseUp,!0),window.removeEventListener("mousemove",this.handleMouseMove,!0),window.removeEventListener("mouseup",this.handleMouseUp,!0),this.iframe&&(this.iframe.remove(),this.iframe=null),this.dragHandle&&(this.dragHandle.remove(),this.dragHandle=null),this.gripButton=null,this.isReady=!1,this.messageCallback=null,this.isDragging=!1,this.isMouseDown=!1,document.body.style.cursor="",document.documentElement.style.cursor="",document.body.style.userSelect="",document.documentElement.style.userSelect=""}sendMessage(t){if(!this.iframe||!this.isReady){setTimeout(()=>this.sendMessage(t),100);return}const i=this.iframe.contentWindow;i&&i.postMessage(t,"*")}loadEditorHtml(){const t=this.getMinimalEditorHtml(),i=new Blob([t],{type:"text/html"}),n=URL.createObjectURL(i);this.iframe&&(this.iframe.src=n)}renderEditorContent(){if(!this.iframe||!this.isReady)return;const t=this.iframe.contentDocument,i=t?.getElementById("designer-editor-root");if(!t||!i)return;const n=o=>this.messageCallback?.(o),r=this.mode==="tag-page"?s(es,{onMessage:n}):this.mode==="tag-feature"?s(hs,{onMessage:n,elementSelected:this.elementSelectedState}):s(Ur,{onMessage:n,elementSelected:this.elementSelectedState,guideId:this.guideId,templateId:this.templateId});_e(s(ur,{client:fs,children:r}),i)}getMinimalEditorHtml(){return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Designer Editor</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://code.iconify.design/iconify-icon/3.0.2/iconify-icon.min.js"><\/script>
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Montserrat',-apple-system,BlinkMacSystemFont,sans-serif;padding:20px;color:#0f172a;line-height:1.6;height:100%;overflow-y:auto;-webkit-font-smoothing:antialiased}</style>
  <style>${xr}</style>
</head>
<body>
  <div id="designer-editor-root"></div>
</body>
</html>`}createDragHandle(){if(this.dragHandle)return;this.dragHandle=document.createElement("div"),this.dragHandle.id="designer-editor-drag-handle",this.dragHandle.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 400px;
      height: 70px;
      background: transparent;
      cursor: default;
      z-index: 1000000;
      display: none;
      pointer-events: none;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    `;const t=document.createElement("div");t.style.cssText=`
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: grab;
      pointer-events: auto;
      padding: 6px 8px;
      border-radius: 6px;
      background: transparent;
      border: none;
      z-index: 1;
      transition: background 0.2s, border-color 0.2s;
    `,t.onmouseenter=()=>{t.style.background="transparent",t.style.border="none"},t.onmouseleave=()=>{t.style.background="transparent",t.style.border="none"};const i=document.createElement("iconify-icon");i.setAttribute("icon","pepicons-print:dots-x"),i.style.cssText="font-size: 18px; color: #64748b; pointer-events: none;",t.appendChild(i),this.dragHandle.appendChild(t),this.gripButton=t,t.addEventListener("mousedown",this.handleMouseDown,!0),document.addEventListener("mousemove",this.handleMouseMove,!0),document.addEventListener("mouseup",this.handleMouseUp,!0),window.addEventListener("mousemove",this.handleMouseMove,!0),window.addEventListener("mouseup",this.handleMouseUp,!0)}updateDragHandlePosition(){if(!this.iframe||!this.dragHandle)return;const t=this.iframe.getBoundingClientRect();this.dragHandle.style.top=`${t.top}px`,this.dragHandle.style.left=`${t.left}px`,this.dragHandle.style.width=`${t.width}px`}handleMouseDown=t=>{if(!this.iframe||!this.dragHandle)return;this.mouseDownX=t.clientX,this.mouseDownY=t.clientY,this.isMouseDown=!0,this.isDragging=!1;const i=this.iframe.getBoundingClientRect();this.dragStartX=t.clientX-i.left,this.dragStartY=t.clientY-i.top,t.preventDefault(),t.stopPropagation()};handleMouseMove=t=>{if(!this.isMouseDown||!this.iframe||!this.dragHandle)return;if(!this.isDragging){const c=Math.abs(t.clientX-this.mouseDownX),h=Math.abs(t.clientY-this.mouseDownY);if(Math.sqrt(c*c+h*h)>this.dragThreshold)this.isDragging=!0,document.body.style.cursor="grabbing",document.documentElement.style.cursor="grabbing",document.body.style.userSelect="none",document.documentElement.style.userSelect="none",this.iframe&&(this.iframe.style.pointerEvents="none"),this.gripButton&&(this.gripButton.style.cursor="grabbing");else return}t.preventDefault(),t.stopPropagation();const i=t.clientX-this.dragStartX,n=t.clientY-this.dragStartY,r=window.innerWidth,o=window.innerHeight,a=this.iframe.offsetWidth,l=Math.max(-a+50,Math.min(i,r-50)),u=Math.max(0,Math.min(n,o-100));this.iframe.style.left=`${l}px`,this.iframe.style.top=`${u}px`,this.iframe.style.right="auto",this.iframe.style.bottom="auto",this.dragHandle.style.left=`${l}px`,this.dragHandle.style.top=`${u}px`};handleMouseUp=t=>{this.isMouseDown&&(this.isDragging=!1,this.isMouseDown=!1,document.body.style.cursor="",document.documentElement.style.cursor="",document.body.style.userSelect="",document.documentElement.style.userSelect="",this.iframe&&(this.iframe.style.pointerEvents=""),this.gripButton&&(this.gripButton.style.cursor="grab"),t.preventDefault(),t.stopPropagation())};handleMessage=t=>{const i=t.data;!i||!i.type||(this.messageCallback&&this.messageCallback(i),(i.type==="CANCEL"||i.type==="GUIDE_SAVED")&&this.hide())}}const ms="visual-designer-guides",ln="1.0.0";class gs{storageKey;constructor(t=ms){this.storageKey=t}getGuides(){try{const t=localStorage.getItem(this.storageKey);if(!t)return[];const i=JSON.parse(t);return i.version!==ln?(this.clear(),[]):i.guides||[]}catch{return[]}}getGuidesByPage(t){return this.getGuides().filter(n=>n.page===t&&n.status==="active")}saveGuide(t){const i=this.getGuides(),n=i.findIndex(o=>o.id===t.id),r={...t,updatedAt:new Date().toISOString(),createdAt:t.createdAt||new Date().toISOString()};n>=0?i[n]=r:i.push(r),this.saveGuides(i)}deleteGuide(t){const i=this.getGuides().filter(n=>n.id!==t);this.saveGuides(i)}saveGuides(t){const i={guides:t,version:ln};localStorage.setItem(this.storageKey,JSON.stringify(i))}clear(){localStorage.removeItem(this.storageKey)}getGuide(t){return this.getGuides().find(i=>i.id===t)||null}}function ys({onExit:e}){const t={position:"fixed",top:"20px",right:"20px",padding:"10px 20px",background:T.bg,border:`2px solid ${T.primary}`,borderRadius:T.borderRadius,color:T.primary,fontSize:"14px",fontWeight:"600",fontFamily:T.fontFamily,cursor:"pointer",zIndex:String(T.zIndex.controls),boxShadow:T.shadow,transition:"all 0.2s ease",pointerEvents:"auto"};return s("button",{id:"designer-exit-editor-btn",style:t,onClick:e,onMouseEnter:i=>{i.currentTarget.style.background=T.primary,i.currentTarget.style.color=T.bg,i.currentTarget.style.transform="translateY(-2px)",i.currentTarget.style.boxShadow=T.shadowHover},onMouseLeave:i=>{i.currentTarget.style.background=T.bg,i.currentTarget.style.color=T.primary,i.currentTarget.style.transform="translateY(0)",i.currentTarget.style.boxShadow=T.shadow},children:[s("iconify-icon",{icon:"mdi:exit-to-app",style:{verticalAlign:"-0.2em",marginRight:"6px"}}),"Exit Editor"]})}function _s(){return s("div",{id:"designer-red-border-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,border:`5px solid ${T.primary}`,pointerEvents:"none",zIndex:T.zIndex.highlight-1,boxSizing:"border-box"}})}function vs(){return s("div",{id:"designer-studio-badge",style:{position:"fixed",top:"4px",left:"50%",transform:"translateX(-50%)",padding:"0px 10px 3px",background:T.primary,color:T.bg,fontSize:"14px",fontWeight:"600",fontFamily:T.fontFamily,borderRadius:"0 0 6px 6px",border:`5px solid ${T.primary}`,borderTop:"none",zIndex:T.zIndex.badge,boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)",pointerEvents:"none",whiteSpace:"nowrap"},children:"Revgain Visual Design Studio"})}function bs(){return s("div",{id:"designer-loading-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(248, 250, 252, 0.97)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",zIndex:T.zIndex.loading,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:T.fontFamily},children:[s("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2.5rem 3rem",background:"#ffffff",borderRadius:"16px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.04)",minWidth:"220px"},children:[s("div",{style:{width:56,height:56,border:"3px solid #e2e8f0",borderTopColor:T.primary,borderRadius:"50%",animation:"vd-spin 0.8s linear infinite",marginBottom:"1.5rem"}}),s("div",{style:{fontSize:"1rem",fontWeight:600,color:"#1e293b",letterSpacing:"-0.02em",marginBottom:"0.25rem"},children:"Loading editor"}),s("div",{style:{fontSize:"0.8125rem",color:"#64748b",fontWeight:500},children:[s("span",{style:{animation:"vd-dot1 1.4s ease-in-out infinite"},children:"."}),s("span",{style:{animation:"vd-dot2 1.4s ease-in-out infinite"},children:"."}),s("span",{style:{animation:"vd-dot3 1.4s ease-in-out infinite"},children:"."})]})]}),s("style",{children:`
        @keyframes vd-spin {
          to { transform: rotate(360deg); }
        }
        @keyframes vd-dot1 {
          0%, 20% { opacity: 0.2; }
          40%, 100% { opacity: 1; }
        }
        @keyframes vd-dot2 {
          0%, 20%, 40% { opacity: 0.2; }
          60%, 100% { opacity: 1; }
        }
        @keyframes vd-dot3 {
          0%, 20%, 40%, 60% { opacity: 0.2; }
          80%, 100% { opacity: 1; }
        }
      `})]})}function ws(e){return s(Q,{children:[e.showExitButton&&s(ys,{onExit:e.onExitEditor}),e.showRedBorder&&s(_s,{}),e.showBadge&&s(vs,{}),e.showLoading&&s(bs,{})]})}function Ss(e,t){_e(s(ws,{...t}),e)}class zt{config;storage;editorMode;guideRenderer;featureHeatmapRenderer;editorFrame;heatmapEnabled=!1;isInitialized=!1;isEditorMode=!1;sdkRoot=null;showLoading=!1;loadingFallbackTimer=null;featuresForHeatmap=[];guideId=null;templateId=null;constructor(t={}){this.config=t,this.guideId=t.guideId??null,this.templateId=t.templateId??null,this.storage=new gs(t.storageKey),this.editorMode=new fn,this.guideRenderer=new Sn,this.featureHeatmapRenderer=new En,this.editorFrame=new ps}init(){if(this.isInitialized)return;this.isInitialized=!0,this.injectMontserratFont(),this.injectIconifyScript(),this.guideRenderer.setOnDismiss(i=>this.config.onGuideDismissed?.(i)),this.shouldEnableEditorMode()?(this.showLoading=!0,this.renderOverlays(),this.enableEditor()):this.loadGuides(),this.heatmapEnabled=localStorage.getItem("designerHeatmapEnabled")==="true",this.renderFeatureHeatmap(),this.setupEventListeners()}enableEditor(){if(this.isEditorMode)return;this.isEditorMode=!0;let t=typeof window<"u"&&window.__visualDesignerMode||null;t||(t=localStorage.getItem("designerModeType")||null),this.editorFrame.create(n=>this.handleEditorMessage(n),t,{guideId:this.guideId,templateId:this.templateId});const i=t==="tag-page"||t==="tag-feature";this.ensureSDKRoot(),this.renderOverlays(),localStorage.setItem("designerMode","true"),t&&localStorage.setItem("designerModeType",t),setTimeout(()=>{this.editorFrame.show(),this.renderOverlays()},i?100:300),this.loadingFallbackTimer=setTimeout(()=>{this.loadingFallbackTimer=null,this.showLoading&&(this.showLoading=!1,this.renderOverlays())},5e3)}disableEditor(){if(this.isEditorMode){try{window.close()}catch{}this.isEditorMode=!1,this.editorMode.deactivate(),this.editorFrame.destroy(),this.featureHeatmapRenderer.destroy(),this.loadingFallbackTimer&&(clearTimeout(this.loadingFallbackTimer),this.loadingFallbackTimer=null),this.showLoading=!1,localStorage.removeItem("designerMode"),localStorage.removeItem("designerModeType"),this.renderOverlays(),this.loadGuides()}}getGuides(){return this.storage.getGuides()}getGuidesForCurrentPage(){return this.storage.getGuidesByPage(De())}saveGuide(t){const i={...t,id:un(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.storage.saveGuide(i),this.isEditorMode||this.loadGuides(),this.config.onGuideSaved?.(i),i}deleteGuide(t){this.storage.deleteGuide(t),this.guideRenderer.dismissGuide(t)}loadGuides(){this.guideRenderer.renderGuides(this.storage.getGuides())}async fetchGuides(){try{const i=(await(await Promise.resolve().then(()=>Tr)).apiClient.get("/guides")).data.map(n=>({id:n.guide_id,page:n.target_page||"",selector:n.target_segment||"",content:n.description||"",placement:n.placement||"right",status:n.status,target_page:n.target_page,target_segment:n.target_segment,templates:n.templates||[],steps:n.steps||[]}));i.forEach(n=>this.storage.saveGuide(n)),this.loadGuides(),console.log(`[Visual Designer] Successfully fetched and rendered ${i.length} guides.`)}catch(t){console.error("[Visual Designer] Failed to fetch guides:",t)}}isEditorModeActive(){return this.isEditorMode}getGuideId(){return this.guideId}getTemplateId(){return this.templateId}shouldEnableEditorMode(){return this.config.editorMode!==void 0?this.config.editorMode:typeof window<"u"&&window.__visualDesignerWasLaunched?!0:localStorage.getItem("designerMode")==="true"}handleEditorMessage(t){switch(t.type){case"ELEMENT_SELECTED":this.handleElementSelected(t);break;case"SAVE_GUIDE":this.handleSaveGuide(t);break;case"TAG_FEATURE_CLICKED":this.editorMode.activate(i=>this.handleEditorMessage(i));break;case"ACTIVATE_SELECTOR":this.editorMode.activate(i=>this.handleEditorMessage(i));break;case"CLEAR_SELECTION_CLICKED":this.editorMode.deactivate(),this.editorFrame.sendClearSelectionAck();break;case"HEATMAP_TOGGLE":this.handleHeatmapToggle(t.enabled);break;case"FEATURES_FOR_HEATMAP":this.handleFeaturesForHeatmap(t.features);break;case"CANCEL":this.editorFrame.hide();break;case"EXIT_EDITOR_MODE":this.disableEditor();break;case"EDITOR_READY":this.loadingFallbackTimer&&(clearTimeout(this.loadingFallbackTimer),this.loadingFallbackTimer=null),this.showLoading=!1,this.renderOverlays();break}}handleElementSelected(t){this.editorFrame.sendElementSelected(t)}handleSaveGuide(t){this.saveGuide({...t.guide,page:De()})}handleHeatmapToggle(t){this.heatmapEnabled=t;try{localStorage.setItem("designerHeatmapEnabled",String(t))}catch{}this.renderFeatureHeatmap()}handleFeaturesForHeatmap(t){this.featuresForHeatmap=t.map(i=>{let r=(i.rules?.find(o=>o.selector_type==="xpath"&&(o.selector_value??"").trim()!=="")?.selector_value??"").trim();return r&&r.startsWith("/body")&&(r="/html[1]"+r),{id:i.feature_id,featureName:i.name,selector:r,url:""}}),this.renderFeatureHeatmap()}getTaggedFeatures(){return this.featuresForHeatmap}renderFeatureHeatmap(){this.featureHeatmapRenderer.render(this.getTaggedFeatures(),this.heatmapEnabled)}setupEventListeners(){let t,i;const n=()=>{this.guideRenderer.updatePositions(this.storage.getGuides())},r=()=>{this.featureHeatmapRenderer.updatePositions(this.getTaggedFeatures())};window.addEventListener("resize",()=>{clearTimeout(t),t=window.setTimeout(()=>{n(),r()},100)}),window.addEventListener("scroll",()=>{clearTimeout(i),i=window.setTimeout(()=>{n(),r()},50)},!0)}ensureSDKRoot(){if(!this.sdkRoot){if(!document.body){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>this.ensureSDKRoot());return}setTimeout(()=>this.ensureSDKRoot(),100);return}this.sdkRoot=document.createElement("div"),this.sdkRoot.id="designer-sdk-root",document.body.appendChild(this.sdkRoot)}}renderOverlays(){this.ensureSDKRoot(),this.sdkRoot&&Ss(this.sdkRoot,{showExitButton:this.isEditorMode,showRedBorder:this.isEditorMode,showBadge:this.isEditorMode,showLoading:this.showLoading,onExitEditor:()=>this.disableEditor()})}injectMontserratFont(){if(typeof document>"u"||!document.head||document.getElementById("designer-montserrat-font"))return;const t=document.createElement("link");t.id="designer-montserrat-font",t.rel="stylesheet",t.href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap",document.head.appendChild(t)}injectIconifyScript(){if(typeof document>"u"||!document.head||document.getElementById("designer-iconify-script"))return;const t=document.createElement("script");t.id="designer-iconify-script",t.src="https://code.iconify.design/iconify-icon/3.0.2/iconify-icon.min.js",t.async=!0,document.head.appendChild(t)}}let W=null,cn=!1;const Ht="designerGuideId",Bt="designerTemplateId";let $t=null,Nt=null;function xs(){try{return typeof localStorage<"u"?localStorage.getItem(Ht):null}catch{return null}}function Es(){try{return typeof localStorage<"u"?localStorage.getItem(Bt):null}catch{return null}}function ce(e){return W||(W=new zt({...e,guideId:$t??e?.guideId??xs()??null,templateId:Nt??e?.templateId??Es()??null}),W.init(),W)}function Ee(){return W}function Wt(e){!e||!Array.isArray(e)||e.forEach(t=>{if(!t||!Array.isArray(t)||t.length===0)return;const i=t[0],n=t.slice(1);try{switch(i){case"initialize":ce(n[0]);break;case"identify":n[0]&&console.log("[Visual Designer] identify (snippet) called with:",n[0]);break;case"enableEditor":(W??ce()).enableEditor();break;case"disableEditor":W?.disableEditor();break;case"loadGuides":W?.loadGuides();break;case"getGuides":return W?.getGuides();default:console.warn("[Visual Designer] Unknown snippet method:",i)}}catch(r){console.error("[Visual Designer] Error processing queued call:",i,r)}})}if(typeof window<"u"){const e=window.visualDesigner;e&&Array.isArray(e._q)&&(cn=!0,e.initialize=t=>ce(t),e.identify=t=>{t&&console.log("[Visual Designer] identify (snippet) called with:",t)},e.enableEditor=()=>(W??ce()).enableEditor(),e.disableEditor=()=>W?.disableEditor(),e.loadGuides=()=>W?.loadGuides(),e.getGuides=()=>W?.getGuides(),e.getInstance=Ee,e.init=ce,Wt(e._q));try{const t=new URL(window.location.href),i=t.searchParams.get("designer"),n=t.searchParams.get("mode"),r=t.searchParams.get("iud"),o=t.searchParams.get("guide_id"),a=t.searchParams.get("template_id"),l={designer:i,designerModeType:n,iud:r,guide_id:o,template_id:a};(i==="true"||o!=null||a!=null)&&console.log("[Visual Designer] URL params:",l),i==="true"?(n&&(window.__visualDesignerMode=n,localStorage.setItem("designerModeType",n)),localStorage.setItem("designerMode","true"),r&&localStorage.setItem(Dt,r),o!=null&&($t=o,localStorage.setItem(Ht,o)),a!=null&&(Nt=a,localStorage.setItem(Bt,a)),t.searchParams.delete("designer"),t.searchParams.delete("mode"),t.searchParams.delete("iud"),t.searchParams.delete("guide_id"),t.searchParams.delete("template_id"),window.history.replaceState({},"",t.toString()),window.__visualDesignerWasLaunched=!0):(o!=null||a!=null)&&(o!=null&&($t=o,localStorage.setItem(Ht,o)),a!=null&&(Nt=a,localStorage.setItem(Bt,a)),t.searchParams.delete("guide_id"),t.searchParams.delete("template_id"),window.history.replaceState({},"",t.toString()))}catch{}}if(typeof window<"u"&&!W&&!cn){const e=()=>{W||ce()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}typeof window<"u"&&(window.VisualDesigner={init:ce,initialize:ce,getInstance:Ee,DesignerSDK:zt,apiClient:V,_processQueue:Wt,loadGuides:()=>Ee()?.loadGuides(),fetchGuides:()=>Ee()?.fetchGuides(),getGuideId:()=>Ee()?.getGuideId()??null,getTemplateId:()=>Ee()?.getTemplateId()??null}),ie.DesignerSDK=zt,ie._processQueue=Wt,ie.apiClient=V,ie.getInstance=Ee,ie.init=ce,Object.defineProperty(ie,Symbol.toStringTag,{value:"Module"})}));
